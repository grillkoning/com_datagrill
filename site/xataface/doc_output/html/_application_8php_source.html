<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Xataface: Dataface/Application.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xataface-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xataface
   &#160;<span id="projectnumber">2.0alpha2</span>
   </div>
   <div id="projectbrief">Xataface Application Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_271d545d1c280e09f46c9ec0c891c76f.html">Dataface</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Application.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_application_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Xataface Web Application Framework</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2005-2008 Web Lite Solutions Corp (shannah@sfu.ca)</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * modify it under the terms of the GNU General Public License</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * as published by the Free Software Foundation; either version 2</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="_application_8php.html#ad8c799309d14333f21aa48a675931353">   23</a></span>&#160;<span class="keywordflow">if</span> ( !function_exists(<span class="stringliteral">&#39;sys_get_temp_dir&#39;</span>) )</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; <span class="comment">// Based on http://www.phpit.net/</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; <span class="comment">// article/creating-zip-tar-archives-dynamically-php/2/</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; <span class="keyword">function</span> sys_get_temp_dir()</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;   <span class="comment">// Try to get from environment variable</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;   <span class="keywordflow">if</span> ( !empty($_ENV[<span class="stringliteral">&#39;TMP&#39;</span>]) )</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;   {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;     <span class="keywordflow">return</span> realpath( $_ENV[<span class="stringliteral">&#39;TMP&#39;</span>] );</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !empty($_ENV[<span class="stringliteral">&#39;TMPDIR&#39;</span>]) )</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;     <span class="keywordflow">return</span> realpath( $_ENV[<span class="stringliteral">&#39;TMPDIR&#39;</span>] );</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !empty($_ENV[<span class="stringliteral">&#39;TEMP&#39;</span>]) )</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;   {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;     <span class="keywordflow">return</span> realpath( $_ENV[<span class="stringliteral">&#39;TEMP&#39;</span>] );</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;   <span class="comment">// Detect by creating a temporary file</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;     <span class="comment">// Try to use system&#39;s temporary directory</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;     <span class="comment">// as random name shouldn&#39;t exist</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;     $temp_file = tempnam( md5(uniqid(rand(), TRUE)), <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;     <span class="keywordflow">if</span> ( $temp_file )</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;     {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;       $temp_dir = realpath( dirname($temp_file) );</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;       unlink( $temp_file );</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;       <span class="keywordflow">return</span> $temp_dir;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;     }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;     {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;       <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;     }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;require_once dirname(__FILE__).<span class="stringliteral">&quot;/../config.inc.php&quot;</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/PermissionsTool.php&#39;</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/LanguageTool.php&#39;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="_application_8php.html#a590b0ab1ed8ac1e554b1a461e225a464">   66</a></span>&#160;define(<span class="stringliteral">&#39;DATAFACE_STRICT_PERMISSIONS&#39;</span>, 100);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">// the minimum security level that is deemed as strict permissions.  </span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// strict permissions mean that permissions must be explicitly granted to a </span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">// table, record, or action or they will not be accessible</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="code" href="class_dataface___application.html">  135</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_dataface___application.html" title="The main Application object that handles requests and response.">Dataface_Application</a> {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2dba41f1c0474bf71d6fe2b6466f353c">  137</a></span>&#160;        <span class="keyword">const</span> <a class="code" href="class_dataface___application.html#a2dba41f1c0474bf71d6fe2b6466f353c">EX_FAILED_TO_CREATE_SESSION_DIR</a> = 5500;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        </div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="code" href="class_dataface___application.html#adc3bc79cb2fa73b88da544d5bcdc61f2">  165</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_dataface___application.html#adc3bc79cb2fa73b88da544d5bcdc61f2" title="An object that implements a method named &#39;redirect&#39; that is supposed to handle requests to redirect t...">$redirectHandler</a> = null;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keyword">private</span> $pageTitle = null;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        var $sessionCookieKey;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        var $autoSession = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        var $_url_filters = array();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        var $_tables = array();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        var $tableIndex = array();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        var $_baseUrl;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        var $_currentTable;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        var $memcache;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        var $_db;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        var $_query;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        </div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a3574826da1aafa7016f48cb3cd63a866">  232</a></span>&#160;        var <a class="code" href="class_dataface___application.html#a3574826da1aafa7016f48cb3cd63a866">$rawQuery</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        var $queryTool = null;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        var $currentRecord = null;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        var $recordContext = null;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        var $_customPages;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        var $locations = null;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        var $eventListeners = array();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a7cc384bf28dfd4e1a66e6955c839f624">  274</a></span>&#160;        var <a class="code" href="class_dataface___application.html#a7cc384bf28dfd4e1a66e6955c839f624" title="User preferences matrix.">$prefs</a> = array(</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="stringliteral">&#39;show_result_stats&#39;</span>=&gt;1, <span class="comment">// The result statistics (e.g. found x of y records in table z)</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="stringliteral">&#39;show_jump_menu&#39;</span>=&gt;1,    <span class="comment">// The drop-down menu that allows you to &quot;jump&quot; to any record in the found set.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <span class="stringliteral">&#39;show_result_controller&#39;</span>=&gt;1,    <span class="comment">// Next, previous, page number .. links...</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="stringliteral">&#39;show_table_tabs&#39;</span>=&gt;1,                   <span class="comment">// Details, List, Find, etc...</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="stringliteral">&#39;show_actions_menu&#39;</span>=&gt;1,                 <span class="comment">// New record, Show all, delete, etc...</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="stringliteral">&#39;show_logo&#39;</span>=&gt;1,                                 <span class="comment">// Show logo at top right of app</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="stringliteral">&#39;show_tables_menu&#39;</span>=&gt;1,                  <span class="comment">// The tabs to select a table.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="stringliteral">&#39;show_search&#39;</span>=&gt;1,                               <span class="comment">// Show search field in upper right.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="stringliteral">&#39;show_record_actions&#39;</span>=&gt;1,               <span class="comment">// Show actions related to particular record</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="stringliteral">&#39;show_recent_records_menu&#39;</span>=&gt;1,  <span class="comment">// Menu to jump to recently visited record (deprecated)</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="stringliteral">&#39;show_bread_crumbs&#39;</span> =&gt; 1,               <span class="comment">// Bread crumbs at top of page to show where you are</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="stringliteral">&#39;show_record_tabs&#39;</span> =&gt; 1,                <span class="comment">// View, Edit, Translate, History, etc...</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="stringliteral">&#39;show_record_tree&#39;</span> =&gt; 1,                <span class="comment">// Tree to navigate the relationships of this record.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="stringliteral">&#39;list_view_scroll_horizontal&#39;</span>=&gt;1, <span class="comment">// Whether to scroll list horizontal if it exceeds page width</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="stringliteral">&#39;list_view_scroll_vertical&#39;</span>=&gt;1  <span class="comment">// Whether to scroll list vertical if it exceeds page height.</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        );</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        var $tableNamesUsed = array();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        </div>
<div class="line"><a name="l00304"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a625f9a92948b3f5d84c2b2d8d591e6f1">  304</a></span>&#160;        var <a class="code" href="class_dataface___application.html#a625f9a92948b3f5d84c2b2d8d591e6f1" title="Keeps track of files used in the current request – jus so we know the breadth of the request...">$filesUsed</a> = array();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        var $main_content_only = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <span class="comment">// IF true then output only includes main content - not the </span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="comment">// surrounding frame.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        var $delegate = -1;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        var $errors=array();</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        var $messages = array();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        var $debugLog = array();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        var $authenticationTool = null;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        var $headContent=array();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        var $mysqlVersion = null;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"></span>         var $_locales = array(</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                <span class="stringliteral">&#39;zh_CN&#39;</span>=&gt;<span class="stringliteral">&#39;zh&#39;</span>,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <span class="stringliteral">&#39;zh_TW&#39;</span>=&gt;<span class="stringliteral">&#39;zt&#39;</span>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="stringliteral">&#39;zh_HK&#39;</span>=&gt;<span class="stringliteral">&#39;zt&#39;</span>,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="stringliteral">&#39;en_US&#39;</span>=&gt;<span class="stringliteral">&#39;en&#39;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        );</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        var $_languages = array(</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="stringliteral">&#39;zt&#39;</span>=&gt;<span class="stringliteral">&#39;zh&#39;</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        );</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        </div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a6e4019a311faf59a50d419765febf29f">  429</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a6e4019a311faf59a50d419765febf29f" title="Returns the language associated with a given language code.">getLanguage</a>($langCode){</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_languages[$langCode]) ){</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_languages[$langCode];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        <span class="keywordflow">return</span> $langCode;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        </div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aa8feec97da89aef00546e5d282df4dbf">  455</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aa8feec97da89aef00546e5d282df4dbf" title="Returns the Xataface language code for a particular locale. E.g. zh_CN would return zh...">getLanguageCode</a>($locale){</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_locales[$locale]) ) <span class="keywordflow">return</span> $this-&gt;_locales[$locale];</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                        list($langCode) = explode(<span class="charliteral">&#39;_&#39;</span>, $locale);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                        <span class="keywordflow">return</span> $langCode;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        </div>
<div class="line"><a name="l00492"></a><span class="lineno"><a class="code" href="class_dataface___application.html#afd8f290775a9845e565b9b6caa177818">  492</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#afd8f290775a9845e565b9b6caa177818" title="Returns an array of all available languages in the application. This is derived from all languages li...">getAvailableLanguages</a>(){</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                $langs = array_keys($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>] ) $langs[] = $this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>];</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <span class="keywordflow">else</span> $langs[] = <span class="stringliteral">&#39;en&#39;</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = array();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keywordflow">foreach</span> ($langs as $lang){</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>[$this-&gt;<a class="code" href="class_dataface___application.html#a6e4019a311faf59a50d419765febf29f" title="Returns the language associated with a given language code.">getLanguage</a>($lang)] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keywordflow">return</span> array_keys(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">// END LANGUAGES</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l00522"></a><span class="lineno"><a class="code" href="class_dataface___application.html#abf2dfcff06cad1e6c249ddc4df4d0866">  522</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#abf2dfcff06cad1e6c249ddc4df4d0866" title="Returns MySQL connection resource.">db</a>(){ <span class="keywordflow">return</span> $this-&gt;_db;}</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        </div>
<div class="line"><a name="l00527"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a900d0c6b890188cec7661fcf785a3871">  527</a></span>&#160;        var <a class="code" href="class_dataface___application.html#a900d0c6b890188cec7661fcf785a3871" title="A configuration array to store configuration information.">$_conf</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        </div>
<div class="line"><a name="l00532"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2f50261109a6ed11b2072bd9e49cc574">  532</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2f50261109a6ed11b2072bd9e49cc574" title="Constructor. Do not use this. getInstance() instead.">Dataface_Application</a>($conf = null){</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;sessionCookieKey) ){</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                    $this-&gt;sessionCookieKey = md5(DATAFACE_SITE_URL.<span class="charliteral">&#39;#&#39;</span>.__FILE__);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                $this-&gt;_baseUrl  = <a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&#39;PHP_SELF&#39;</span>];</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="keywordflow">if</span> ( !is_array($conf) ) $conf = array();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="keywordflow">if</span> ( is_readable(DATAFACE_SITE_PATH.<span class="stringliteral">&#39;/conf.ini&#39;</span>) ){</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                        $conf = array_merge(parse_ini_file(DATAFACE_SITE_PATH.<span class="stringliteral">&#39;/conf.ini&#39;</span>, <span class="keyword">true</span>), $conf);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        <span class="keywordflow">if</span> ( @$conf[<span class="stringliteral">&#39;__include__&#39;</span>] ){</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                $includes = array_map(<span class="stringliteral">&#39;trim&#39;</span>,explode(<span class="charliteral">&#39;,&#39;</span>, $conf[<span class="stringliteral">&#39;__include__&#39;</span>]));</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                <span class="keywordflow">foreach</span> ($includes as $i){</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                        <span class="keywordflow">if</span> ( is_readable($i) ){</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                                $conf = array_merge($conf, parse_ini_file($i, <span class="keyword">true</span>));</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                <span class="keywordflow">if</span> ( !isset( $conf[<span class="stringliteral">&#39;_tables&#39;</span>] ) ){</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Error loading config file.  No tables specified.&#39;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="keywordflow">if</span> ( isset( $conf[<span class="stringliteral">&#39;db&#39;</span>] ) and is_resource($conf[<span class="stringliteral">&#39;db&#39;</span>]) ){</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                        $this-&gt;_db = $conf[<span class="stringliteral">&#39;db&#39;</span>];</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $conf[<span class="stringliteral">&#39;_database&#39;</span>] ) ){</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Error loading config file. No database specified.&#39;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        $dbinfo =&amp; $conf[<span class="stringliteral">&#39;_database&#39;</span>];</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                        <span class="keywordflow">if</span> ( !is_array( $dbinfo ) || !isset($dbinfo[<span class="stringliteral">&#39;host&#39;</span>]) || !isset( $dbinfo[<span class="stringliteral">&#39;user&#39;</span>] ) || !isset( $dbinfo[<span class="stringliteral">&#39;password&#39;</span>] ) || !isset( $dbinfo[<span class="stringliteral">&#39;name&#39;</span>] ) ){</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Error loading config file.  The database information was not entered correctly.&lt;br&gt;</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">                                         Please enter the database information int its own section of the config file as follows:&lt;br&gt;</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral">                                         &lt;pre&gt;</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">                                         [_database]</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral">                                         host = localhost</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral">                                         user = foo</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral">                                         password = bar</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">                                         name = database_name</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="stringliteral">                                         &lt;/pre&gt;&#39;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        <span class="keywordflow">if</span> ( @$dbinfo[<span class="stringliteral">&#39;persistent&#39;</span>] ){</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                $this-&gt;_db = mysql_pconnect( $dbinfo[<span class="stringliteral">&#39;host&#39;</span>], $dbinfo[<span class="stringliteral">&#39;user&#39;</span>], $dbinfo[<span class="stringliteral">&#39;password&#39;</span>] );</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                $this-&gt;_db = mysql_connect( $dbinfo[<span class="stringliteral">&#39;host&#39;</span>], $dbinfo[<span class="stringliteral">&#39;user&#39;</span>], $dbinfo[<span class="stringliteral">&#39;password&#39;</span>] );</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        <span class="keywordflow">if</span> ( !$this-&gt;_db ){</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Error connecting to the database: &#39;</span>.mysql_error());</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                        $this-&gt;mysqlVersion = mysql_get_server_info($this-&gt;_db);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        mysql_select_db( $dbinfo[<span class="stringliteral">&#39;name&#39;</span>] ) or die(<span class="stringliteral">&quot;Could not select DB: &quot;</span>.mysql_error($this-&gt;_db));</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="comment">//if ( !defined( &#39;DATAFACE_DB_HANDLE&#39;) ) define(&#39;DATAFACE_DB_HANDLE&#39;, $this-&gt;_db);</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <span class="keywordflow">if</span> ( !is_array( $conf[<span class="stringliteral">&#39;_tables&#39;</span>] ) ){</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;&lt;pre&gt;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">                                Error reading table information from the config file.  Please enter the table information in its own section</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="stringliteral">                                of the ini file as follows:</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="stringliteral">                                [_tables]</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="stringliteral">                                table1 = Table 1 Label</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="stringliteral">                                table2 = Table 2 Label</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="stringliteral">                                &lt;/pre&gt;&quot;</span>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                $this-&gt;_tables = $conf[<span class="stringliteral">&#39;_tables&#39;</span>];</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <span class="keywordflow">if</span> ( count($this-&gt;_tables) &lt;= 10 ){</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;horizontal_tables_menu&#39;</span>] = 1;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="comment">// We will register a _cleanup method to run after code execution is complete.</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                register_shutdown_function(array(&amp;$this, <span class="stringliteral">&#39;_cleanup&#39;</span>));</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="comment">// Set up memcache if it is installed.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">if</span> ( DATAFACE_EXTENSION_LOADED_MEMCACHE ){</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        <span class="keywordflow">if</span> ( isset($conf[<span class="stringliteral">&#39;_memcache&#39;</span>]) ){</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                <span class="keywordflow">if</span> ( !isset($conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;host&#39;</span>]) ){</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                        $conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;host&#39;</span>] = <span class="stringliteral">&#39;localhost&#39;</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                <span class="keywordflow">if</span> ( !isset($conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;port&#39;</span>]) ){</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                        $conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;port&#39;</span>] = 11211;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                $this-&gt;memcache = <span class="keyword">new</span> Memcache;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                $this-&gt;memcache-&gt;connect($conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;host&#39;</span>], $conf[<span class="stringliteral">&#39;_memcache&#39;</span>][<span class="stringliteral">&#39;port&#39;</span>]) or die (<span class="stringliteral">&quot;Could not connect to memcache on port 11211&quot;</span>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="comment">// -------- Set up the CONF array ------------------------</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                $this-&gt;_conf = $conf;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>]) ){</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>] = array();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>][<span class="stringliteral">&#39;history&#39;</span>] = <span class="stringliteral">&#39;/__history$/&#39;</span>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>][<span class="stringliteral">&#39;cache&#39;</span>] = <span class="stringliteral">&#39;__output_cache&#39;</span>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>][<span class="stringliteral">&#39;dataface&#39;</span>] = <span class="stringliteral">&#39;/^dataface__/&#39;</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>][<span class="stringliteral">&#39;xataface&#39;</span>] = <span class="stringliteral">&#39;/^xataface__/&#39;</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                <span class="keywordflow">if</span> ( !@$this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] or !is_array($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) ){</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] = array();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="comment">// Include XataJax module always.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                $mods = array(<span class="stringliteral">&#39;modules_XataJax&#39;</span>=&gt;<span class="stringliteral">&#39;modules/XataJax/XataJax.php&#39;</span>);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] as $k=&gt;$v){</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        $mods[$k] = $v;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] = $mods;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>])  and count($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>])&gt;0 ){</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                        <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/ModuleTool.php&#39;</span>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]) ){</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;language_labels&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>];</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                        <span class="keywordflow">foreach</span> ( array_keys($this-&gt;_conf[<span class="stringliteral">&#39;language_labels&#39;</span>]) as $lang_code){</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>][$lang_code] = $lang_code;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                        }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;support_transactions&#39;</span>] ){</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        <span class="comment">// We will support transactions</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                        @mysql_query(<span class="stringliteral">&#39;SET AUTOCOMMIT=0&#39;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        @mysql_query(<span class="stringliteral">&#39;START TRANSACTION&#39;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_ie&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;default_ie&#39;</span>] = <span class="stringliteral">&#39;UTF-8&#39;</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_oe&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;default_oe&#39;</span>] = <span class="stringliteral">&#39;UTF-8&#39;</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">if</span> ( isset( $this-&gt;_conf[<span class="stringliteral">&#39;multilingual_content&#39;</span>]) || isset($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]) ){</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;oe&#39;</span>] = <span class="stringliteral">&#39;UTF-8&#39;</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;ie&#39;</span>] = <span class="stringliteral">&#39;UTF-8&#39;</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                        </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                        <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;mb_substr&#39;</span>) ){</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                <span class="comment">// The mbstring extension is loaded</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                ini_set(<span class="stringliteral">&#39;mbstring.internal_encoding&#39;</span>, <span class="stringliteral">&#39;UTF-8&#39;</span>);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                <span class="comment">//ini_set(&#39;mbstring.encoding_translation&#39;, &#39;On&#39;);</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                ini_set(<span class="stringliteral">&#39;mbstring.func_overload&#39;</span>, 7);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                        }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]) ){</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>] = array(<span class="stringliteral">&#39;en&#39;</span>=&gt;<span class="stringliteral">&#39;English&#39;</span>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                        }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>]) ){</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                <span class="keywordflow">if</span> ( count($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]) &gt; 0 )</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                                        $this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>] = reset($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                        </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                        $this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>] = <span class="stringliteral">&#39;en&#39;</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                        </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                        }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                        </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;oe&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_oe&#39;</span>];</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;ie&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_ie&#39;</span>];</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                define(<span class="stringliteral">&#39;XF_OUTPUT_ENCODING&#39;</span>, $this-&gt;_conf[<span class="stringliteral">&#39;oe&#39;</span>]);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;oe&#39;</span>] == <span class="stringliteral">&#39;UTF-8&#39;</span> ){</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        $res = mysql_query(<span class="stringliteral">&#39;set character_set_results = \&#39;utf8\&#39;&#39;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                        mysql_query(<span class="stringliteral">&quot;SET NAMES utf8&quot;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;ie&#39;</span>] == <span class="stringliteral">&#39;UTF-8&#39;</span> ){</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        $res = mysql_query(<span class="stringliteral">&#39;set character_set_client = \&#39;utf8\&#39;&#39;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                        </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;use_cache&#39;</span>]) and $this-&gt;_conf[<span class="stringliteral">&#39;use_cache&#39;</span>] and !defined(<span class="stringliteral">&#39;DATAFACE_USE_CACHE&#39;</span>) ){</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                        define(<span class="stringliteral">&#39;DATAFACE_USE_CACHE&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>]) and $this-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>] and !defined(<span class="stringliteral">&#39;DATAFACE_DEBUG&#39;</span>) ){</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                        define(<span class="stringliteral">&#39;DATAFACE_DEBUG&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;DATAFACE_DEBUG&#39;</span>) ){</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                        define(<span class="stringliteral">&#39;DATAFACE_DEBUG&#39;</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <span class="keywordflow">if</span> ( !@$this-&gt;_conf[<span class="stringliteral">&#39;config_storage&#39;</span>] ) $this-&gt;_conf[<span class="stringliteral">&#39;config_storage&#39;</span>] = DATAFACE_DEFAULT_CONFIG_STORAGE;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                        <span class="comment">// Set the storage type for config information.  It can either be stored in ini files or</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        <span class="comment">// in the database.  Database will give better performance, but INI files may be simpler</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        <span class="comment">// to manage for simple applications.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;garbage_collector_threshold&#39;</span>]) ){</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;garbage_collector_threshold&#39;</span>] = 10*60;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;multilingual_content&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;multilingual_content&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        <span class="comment">// whether or not the application will use multilingual content.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <span class="comment">// multilingual content enables translated versions of content to be stored in</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        <span class="comment">// tables using naming conventions.</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                        <span class="comment">// Default to false because this takes a performance hit (sql queries take roughly twice</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                        <span class="comment">// as long because they have to be parsed first.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;cookie_prefix&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;cookie_prefix&#39;</span>] = <span class="stringliteral">&#39;dataface__&#39;</span>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>]) ){</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                        <span class="comment">// Default security is strict if security is not specified.  This change is effectivce</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        <span class="comment">// for Dataface 0.6 .. 0.5.3 and earlier had a loose permissions model by default that </span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                        <span class="comment">// could be tightened using delegate classes.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>] = 0; <span class="comment">//DATAFACE_STRICT_PERMISSIONS;</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_action&#39;</span>]) ){</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        <span class="comment">// The default action defines the action that should be set if no</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        <span class="comment">// other action is specified.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;default_action&#39;</span>] = <span class="stringliteral">&#39;list&#39;</span>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_browse_action&#39;</span>]) ){</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;default_browse_action&#39;</span>] = <span class="stringliteral">&#39;view&#39;</span>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_mode&#39;</span>] ) ) $this-&gt;_conf[<span class="stringliteral">&#39;default_mode&#39;</span>] = <span class="stringliteral">&#39;list&#39;</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_limit&#39;</span>]) ){</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;default_limit&#39;</span>] = 30;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;default_table&#39;</span>] ) ){</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                        <span class="comment">// The default table is the table that is used if no other table is specified.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                        <span class="keywordflow">foreach</span> ($this-&gt;_tables as $key=&gt;$value){</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_table&#39;</span>] = $key;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                        }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;auto_load_results&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;auto_load_results&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;cache_dir&#39;</span>] ) ){</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                        <span class="keywordflow">if</span> ( ini_get(<span class="stringliteral">&#39;upload_tmp_dir&#39;</span>) ) $this-&gt;_conf[<span class="stringliteral">&#39;cache_dir&#39;</span>] = ini_get(<span class="stringliteral">&#39;upload_tmp_dir&#39;</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                        <span class="keywordflow">else</span> $this-&gt;_conf[<span class="stringliteral">&#39;cache_dir&#39;</span>] = <span class="stringliteral">&#39;/tmp&#39;</span>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;default_table_role&#39;</span>] ) ){</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                        </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>] &gt;= <a class="code" href="_application_8php.html#a590b0ab1ed8ac1e554b1a461e225a464">DATAFACE_STRICT_PERMISSIONS</a> ){</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_table_role&#39;</span>] = <span class="stringliteral">&#39;NO ACCESS&#39;</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_table_role&#39;</span>] = <span class="stringliteral">&#39;ADMIN&#39;</span>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                        }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                        </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;default_field_role&#39;</span>] ) ){</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>] &gt;= <a class="code" href="_application_8php.html#a590b0ab1ed8ac1e554b1a461e225a464">DATAFACE_STRICT_PERMISSIONS</a> ){</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_field_role&#39;</span>] = <span class="stringliteral">&#39;NO ACCESS&#39;</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_field_role&#39;</span>] = <span class="stringliteral">&#39;ADMIN&#39;</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                        }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;default_relationship_role&#39;</span>] ) ){</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>] &gt;= <a class="code" href="_application_8php.html#a590b0ab1ed8ac1e554b1a461e225a464">DATAFACE_STRICT_PERMISSIONS</a> ){</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_relationship_role&#39;</span>] = <span class="stringliteral">&#39;READ ONLY&#39;</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                $this-&gt;_conf[<span class="stringliteral">&#39;default_relationship_role&#39;</span>] = <span class="stringliteral">&#39;ADMIN&#39;</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                        }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>] ) ) $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>] = array(<span class="stringliteral">&#39;en&#39;</span>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !is_array($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>] = array($this-&gt;_conf[<span class="stringliteral">&#39;languages&#39;</span>]);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_language_codes&#39;</span>]) ){</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                        $this-&gt;_languages = array_merge($this-&gt;_languages, $this-&gt;_conf[<span class="stringliteral">&#39;_language_codes&#39;</span>]);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_locales&#39;</span>]) ){</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                        $this-&gt;_locales = array_merge($this-&gt;_locales, $this-&gt;_conf[<span class="stringliteral">&#39;_locales&#39;</span>]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <span class="comment">// Set the language.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                <span class="comment">// Language is stored in a cookie.  It can be changed by passing the -lang GET var with the value</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                <span class="comment">// of a language.  e.g. fr, en, cn</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>] ) ) $this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>] = <span class="stringliteral">&#39;en&#39;</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                $prefix = $this-&gt;_conf[<span class="stringliteral">&#39;cookie_prefix&#39;</span>];</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                <span class="comment">//print_r($_COOKIE);</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;--lang&#39;</span>]) ){</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                        $_REQUEST[<span class="stringliteral">&#39;--lang&#39;</span>] = basename($_REQUEST[<span class="stringliteral">&#39;--lang&#39;</span>]);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>] = $_REQUEST[<span class="stringliteral">&#39;--lang&#39;</span>];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>] ) ){</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                        $_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>] = basename($_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>]);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>] = $_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>];</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                        <span class="keywordflow">if</span> ( @$_COOKIE[$prefix.<span class="stringliteral">&#39;lang&#39;</span>] !== $_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>] ){</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                                setcookie($prefix.<span class="stringliteral">&#39;lang&#39;</span>, $_REQUEST[<span class="stringliteral">&#39;-lang&#39;</span>], null, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                        }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset( $_COOKIE[$prefix.<span class="stringliteral">&#39;lang&#39;</span>]) ){</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>] = $_COOKIE[$prefix.<span class="stringliteral">&#39;lang&#39;</span>];</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                        <span class="keyword">import</span>(<span class="stringliteral">&#39;I18Nv2/I18Nv2.php&#39;</span>);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                        $negotiator = I18Nv2::createNegotiator($this-&gt;_conf[<span class="stringliteral">&#39;default_language&#39;</span>], <span class="stringliteral">&#39;UTF-8&#39;</span>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>] = $this-&gt;<a class="code" href="class_dataface___application.html#aa8feec97da89aef00546e5d282df4dbf" title="Returns the Xataface language code for a particular locale. E.g. zh_CN would return zh...">getLanguageCode</a>(</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                $negotiator-&gt;getLocaleMatch(</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                        $this-&gt;getAvailableLanguages()</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                )</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                        );</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        setcookie($prefix.<span class="stringliteral">&#39;lang&#39;</span>, $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>], null, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                $this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>] = basename($this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                $this-&gt;<a class="code" href="class_dataface___application.html#a8922a305e2a3e1cc73a2505046c375b1" title="Adds some content meant to be inserted in the head of the application.">addHeadContent</a>(<span class="stringliteral">&#39;&lt;script&gt;XF_LANG=&quot;&#39;</span>.htmlspecialchars($this-&gt;_conf[<span class="stringliteral">&#39;lang&#39;</span>]).<span class="stringliteral">&#39;&quot;;&lt;/script&gt;&#39;</span>);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;-template&#39;</span>]) ){</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                    $_REQUEST[<span class="stringliteral">&#39;-template&#39;</span>] = basename($_REQUEST[<span class="stringliteral">&#39;-template&#39;</span>]);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                <span class="keywordflow">if</span> ( isset($_GET[<span class="stringliteral">&#39;-template&#39;</span>]) ){</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                    $_GET[<span class="stringliteral">&#39;-template&#39;</span>] = basename($_GET[<span class="stringliteral">&#39;-template&#39;</span>]);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                <span class="keywordflow">if</span> ( isset($_POST[<span class="stringliteral">&#39;-template&#39;</span>]) ){</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                    $_POST[<span class="stringliteral">&#39;-template&#39;</span>] = basename($_POST[<span class="stringliteral">&#39;-template&#39;</span>]);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <span class="comment">// Set the mode (edit or view)</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;-usage_mode&#39;</span>] )){</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;usage_mode&#39;</span>] = $_REQUEST[<span class="stringliteral">&#39;-usage_mode&#39;</span>];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                        <span class="keywordflow">if</span> (@$_COOKIE[$prefix.<span class="stringliteral">&#39;usage_mode&#39;</span>] !== $_REQUEST[<span class="stringliteral">&#39;-usage_mode&#39;</span>]){</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                setcookie($prefix.<span class="stringliteral">&#39;usage_mode&#39;</span>, $_REQUEST[<span class="stringliteral">&#39;-usage_mode&#39;</span>], null, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                        }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $_COOKIE[$prefix.<span class="stringliteral">&#39;usage_mode&#39;</span>] ) ){</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;usage_mode&#39;</span>] = $_COOKIE[$prefix.<span class="stringliteral">&#39;usage_mode&#39;</span>];</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;usage_mode&#39;</span>]) ){</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;usage_mode&#39;</span>] = <span class="stringliteral">&#39;view&#39;</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                define(<span class="stringliteral">&#39;DATAFACE_USAGE_MODE&#39;</span>, $this-&gt;_conf[<span class="stringliteral">&#39;usage_mode&#39;</span>]);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;enable_workflow&#39;</span>] ){</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                        <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/WorkflowTool.php&#39;</span>);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                <span class="comment">// ------- Set up the current query ---------------------------------</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>]) and is_array($_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>]) ){</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                        $query = $_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>];</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                        <span class="keywordflow">foreach</span> ( array_keys($_REQUEST) as $key ){</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                <span class="keywordflow">if</span> ( $key{0} == <span class="charliteral">&#39;-&#39;</span> and !in_array($key, array(<span class="stringliteral">&#39;-search&#39;</span>,<span class="stringliteral">&#39;-cursor&#39;</span>,<span class="stringliteral">&#39;-skip&#39;</span>,<span class="stringliteral">&#39;-limit&#39;</span>))){</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                        $query[$key] = $_REQUEST[$key];</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                        }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                        $query = array_merge($_GET, $_POST);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-action&#39;</span>] ){</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                        $query[<span class="stringliteral">&#39;-action&#39;</span>] = trim($query[<span class="stringliteral">&#39;-action&#39;</span>]);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9_]+$/&#39;</span>, $query[<span class="stringliteral">&#39;-action&#39;</span>]) ){</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal action name.&quot;</span>);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                        }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                        $query[<span class="stringliteral">&#39;-action&#39;</span>] = basename($query[<span class="stringliteral">&#39;-action&#39;</span>]);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-table&#39;</span>] ){</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                        $query[<span class="stringliteral">&#39;-table&#39;</span>] = trim($query[<span class="stringliteral">&#39;-table&#39;</span>]);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9_]+$/&#39;</span>, $query[<span class="stringliteral">&#39;-table&#39;</span>]) ){</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal table name.&quot;</span>);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                        }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                        $query[<span class="stringliteral">&#39;-table&#39;</span>] = basename($query[<span class="stringliteral">&#39;-table&#39;</span>]);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-lang&#39;</span>] ){</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                        $query[<span class="stringliteral">&#39;-lang&#39;</span>] = trim($query[<span class="stringliteral">&#39;-lang&#39;</span>]);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9]{2}$/&#39;</span>, $query[<span class="stringliteral">&#39;-lang&#39;</span>]) ){</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal language code: &quot;</span>.$query[<span class="stringliteral">&#39;-lang&#39;</span>]);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                        }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                        $query[<span class="stringliteral">&#39;-lang&#39;</span>] = basename($query[<span class="stringliteral">&#39;-lang&#39;</span>]);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;--lang&#39;</span>] ){</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                        $query[<span class="stringliteral">&#39;--lang&#39;</span>] = trim($query[<span class="stringliteral">&#39;--lang&#39;</span>]);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9]{2}$/&#39;</span>, $query[<span class="stringliteral">&#39;--lang&#39;</span>]) ){</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal language code: &quot;</span>.$query[<span class="stringliteral">&#39;--lang&#39;</span>]);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                        }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                        $query[<span class="stringliteral">&#39;--lang&#39;</span>] = basename($query[<span class="stringliteral">&#39;--lang&#39;</span>]);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-theme&#39;</span>] ){</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                        $query[<span class="stringliteral">&#39;-theme&#39;</span>] = trim($query[<span class="stringliteral">&#39;-theme&#39;</span>]);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9_]+$/&#39;</span>, $query[<span class="stringliteral">&#39;-theme&#39;</span>]) ){</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal theme name.&quot;</span>);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                        }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                        $query[<span class="stringliteral">&#39;-theme&#39;</span>] = basename($query[<span class="stringliteral">&#39;-theme&#39;</span>]);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-cursor&#39;</span>]){</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                        $query[<span class="stringliteral">&#39;-cursor&#39;</span>] = intval($query[<span class="stringliteral">&#39;-cursor&#39;</span>]);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-limit&#39;</span>] ){</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                        $query[<span class="stringliteral">&#39;-limit&#39;</span>] = intval($query[<span class="stringliteral">&#39;-limit&#39;</span>]);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-skip&#39;</span>] ){</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                        $query[<span class="stringliteral">&#39;-skip&#39;</span>] = intval($query[<span class="stringliteral">&#39;-skip&#39;</span>]);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-related-limit&#39;</span>] ){</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                        $query[<span class="stringliteral">&#39;-related-limit&#39;</span>] = intval($query[<span class="stringliteral">&#39;-related-limit&#39;</span>]);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-relationship&#39;</span>] ){</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/^[a-zA-Z0-9_]+$/&#39;</span>, $query[<span class="stringliteral">&#39;-relationship&#39;</span>]) ){</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Illegal relationship name.&quot;</span>);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                        }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                $this-&gt;rawQuery = $query;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="keywordflow">if</span> ( !isset( $query[<span class="stringliteral">&#39;-table&#39;</span>] ) ) $query[<span class="stringliteral">&#39;-table&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_table&#39;</span>];</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                $this-&gt;_currentTable = $query[<span class="stringliteral">&#39;-table&#39;</span>];</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                <span class="keywordflow">if</span> ( !@$query[<span class="stringliteral">&#39;-action&#39;</span>] ) {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                        $query[<span class="stringliteral">&#39;-action&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_action&#39;</span>];</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;using_default_action&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                $query[<span class="stringliteral">&#39;--original_action&#39;</span>] = $query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <span class="keywordflow">if</span> ( $query[<span class="stringliteral">&#39;-action&#39;</span>] == <span class="stringliteral">&#39;browse&#39;</span>) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                        <span class="keywordflow">if</span> ( isset($query[<span class="stringliteral">&#39;-relationship&#39;</span>]) ){</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                $query[<span class="stringliteral">&#39;-action&#39;</span>] = <span class="stringliteral">&#39;related_records_list&#39;</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($query[<span class="stringliteral">&#39;-new&#39;</span>]) and $query[<span class="stringliteral">&#39;-new&#39;</span>]) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                $query[<span class="stringliteral">&#39;-action&#39;</span>] = <span class="stringliteral">&#39;new&#39;</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                $query[<span class="stringliteral">&#39;-action&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_browse_action&#39;</span>]; <span class="comment">// for backwards compatibility to 0.5.x</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $query[<span class="stringliteral">&#39;-action&#39;</span>] == <span class="stringliteral">&#39;find_list&#39;</span> ){</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                        $query[<span class="stringliteral">&#39;-action&#39;</span>] = <span class="stringliteral">&#39;list&#39;</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                <span class="keywordflow">if</span> ( !isset( $query[<span class="stringliteral">&#39;-cursor&#39;</span>] ) ) $query[<span class="stringliteral">&#39;-cursor&#39;</span>] = 0;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                <span class="keywordflow">if</span> ( !isset( $query[<span class="stringliteral">&#39;-skip&#39;</span>] ) ) $query[<span class="stringliteral">&#39;-skip&#39;</span>] = 0;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                <span class="keywordflow">if</span> ( !isset( $query[<span class="stringliteral">&#39;-limit&#39;</span>] ) ) $query[<span class="stringliteral">&#39;-limit&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_limit&#39;</span>];</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                <span class="keywordflow">if</span> ( !isset( $query[<span class="stringliteral">&#39;-mode&#39;</span>] ) ) $query[<span class="stringliteral">&#39;-mode&#39;</span>] = $this-&gt;_conf[<span class="stringliteral">&#39;default_mode&#39;</span>];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                $this-&gt;_query =&amp; $query;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                <span class="keywordflow">if</span> ( isset( $query[<span class="stringliteral">&#39;--msg&#39;</span>] ) ) {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                        $query[<span class="stringliteral">&#39;--msg&#39;</span>] = preg_replace(<span class="stringliteral">&#39;#&lt;[^&gt;]*&gt;#&#39;</span>,<span class="stringliteral">&#39;&#39;</span>, $query[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^@@$/&#39;</span>, $query[<span class="stringliteral">&#39;--msg&#39;</span>]) ){</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                                </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                <span class="keywordflow">if</span> ( @$_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>] ){</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                        $this-&gt;<a class="code" href="class_dataface___application.html#aed1bea50951ae75cbc78ecc7ba241870" title="Adds a message to be displayed in the messages block.">addMessage</a>(@$_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                                        unset($_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                                }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                                </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                                $this-&gt;<a class="code" href="class_dataface___application.html#aed1bea50951ae75cbc78ecc7ba241870" title="Adds a message to be displayed in the messages block.">addMessage</a>($query[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                        }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                <span class="keywordflow">if</span> ( isset($query[<span class="stringliteral">&#39;--error&#39;</span>]) and trim($query[<span class="stringliteral">&#39;--error&#39;</span>]) ){</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                        $query[<span class="stringliteral">&#39;--error&#39;</span>] = preg_replace(<span class="stringliteral">&#39;#&lt;[^&gt;]*&gt;#&#39;</span>,<span class="stringliteral">&#39;&#39;</span>, $query[<span class="stringliteral">&#39;--error&#39;</span>]);</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                        $this-&gt;<a class="code" href="class_dataface___application.html#af94b7f8d7868cb953ec7facb7bbb5597" title="Adds an error to be displayed in the UI in the messages block.">addError</a>(<a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>($query[<span class="stringliteral">&#39;--error&#39;</span>]));</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                }</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <span class="comment">// Now allow custom setting of theme</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                <span class="keywordflow">if</span> ( isset($query[<span class="stringliteral">&#39;-theme&#39;</span>]) ){</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_conf[<span class="stringliteral">&#39;_themes&#39;</span>]) ) $this-&gt;_conf[<span class="stringliteral">&#39;_themes&#39;</span>] = array();</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                        $this-&gt;_conf[<span class="stringliteral">&#39;_themes&#39;</span>][basename($query[<span class="stringliteral">&#39;-theme&#39;</span>])] = <span class="stringliteral">&#39;themes/&#39;</span>.basename($query[<span class="stringliteral">&#39;-theme&#39;</span>]);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="comment">// Check to see if we should set a custom default preview length</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="keywordflow">if</span> ( isset($query[<span class="stringliteral">&#39;--default-preview-length&#39;</span>]) ){</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                        $len = intval($query[<span class="stringliteral">&#39;--default-preview-length&#39;</span>]);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                        <span class="keywordflow">if</span> ( $len &gt; 0 &amp;&amp; !defined(<span class="stringliteral">&#39;XATAFACE_DEFAULT_PREVIEW_LENGTH&#39;</span>) ){</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                define(<span class="stringliteral">&#39;XATAFACE_DEFAULT_PREVIEW_LENGTH&#39;</span>, $len);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                        }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                }</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        </div>
<div class="line"><a name="l01051"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972"> 1051</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">getInstance</a>($conf=null){</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                <span class="keyword">static</span> $instance = array();</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                <span class="comment">//static $blobRequestCount = 0;</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <span class="keywordflow">if</span> ( !isset( $instance[0] ) ){</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                        $instance[0] = <span class="keyword">new</span> <a class="code" href="class_dataface___application.html#a2f50261109a6ed11b2072bd9e49cc574" title="Constructor. Do not use this. getInstance() instead.">Dataface_Application</a>($conf);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                        <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;DATAFACE_APPLICATION_LOADED&#39;</span>) ){</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                                define(<span class="stringliteral">&#39;DATAFACE_APPLICATION_LOADED&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                        }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keywordflow">return</span> $instance[0];</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        </div>
<div class="line"><a name="l01077"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aa5501e68627f135e85d6a9753a968bc5"> 1077</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#aa5501e68627f135e85d6a9753a968bc5" title="Returns the config array as loaded from the conf.ini file, except that it opens up the opportunity fo...">conf</a>(){       </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                <span class="keyword">static</span> $loaded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                <span class="keywordflow">if</span> ( !$loaded ){</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                        $loaded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                        $del = $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                        <span class="keywordflow">if</span> ( isset($del) and method_exists($del,<span class="stringliteral">&#39;conf&#39;</span>) ){</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                                $conf = $del-&gt;conf();</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                                <span class="keywordflow">if</span> ( !is_array($conf) ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;The Application Delegate class defined a method &#39;conf&#39; that must return an array, but returns something else.&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                                <span class="keywordflow">foreach</span> ( $conf as $key=&gt;$val){</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                                        <span class="keywordflow">if</span> ( isset($this-&gt;_conf[$key]) ){</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                                                <span class="keywordflow">if</span> ( is_array($this-&gt;_conf[$key]) and is_array($val) ){</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                                        $this-&gt;_conf[$key] = array_merge($this-&gt;_conf[$key], $val);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                                                        $this-&gt;_conf[$key] = $val;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                                }</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                                $this-&gt;_conf[$key] = $val;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                                        }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                                </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                        </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface___application.html#a900d0c6b890188cec7661fcf785a3871" title="A configuration array to store configuration information.">$this-&gt;_conf</a>;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        </div>
<div class="line"><a name="l01109"></a><span class="lineno"><a class="code" href="class_dataface___application.html#ae3ef1f90bf715b0df484faec2ac018ef"> 1109</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#ae3ef1f90bf715b0df484faec2ac018ef" title="Get the mysql major version number of MySQL. returns int.">getMySQLMajorVersion</a>(){</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;mysqlVersion) ){</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                        $this-&gt;mysqlVersion = mysql_get_server_info($this-&gt;_db);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                list($mv) = explode(<span class="charliteral">&#39;.&#39;</span>,$this-&gt;mysqlVersion);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                <span class="keywordflow">return</span> intval($mv);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        </div>
<div class="line"><a name="l01117"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a72e71f0cd569e7975f7e6625c972f37a"> 1117</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a72e71f0cd569e7975f7e6625c972f37a">getPageTitle</a>(){</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;pageTitle) ){</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;pageTitle;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                        $title = $this-&gt;<a class="code" href="class_dataface___application.html#a71054f5ea5e2793cb63623eeb4d3290b" title="Gets the site title.">getSiteTitle</a>();</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                        $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                        <span class="keywordflow">if</span> ( ($record = $this-&gt;<a class="code" href="class_dataface___application.html#af296b1b4fc05d00411862370131e4d34" title="Gets the current record based on the current query.">getRecord</a>()) &amp;&amp; $query[<span class="stringliteral">&#39;-mode&#39;</span>] == <span class="stringliteral">&#39;browse&#39;</span>  ){</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                <span class="keywordflow">return</span> $record-&gt;getTitle().<span class="stringliteral">&#39; - &#39;</span>.$title;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                $tableLabel = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>($query[<span class="stringliteral">&#39;-table&#39;</span>])-&gt;getLabel();</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                <span class="keywordflow">return</span> $tableLabel.<span class="stringliteral">&#39; - &#39;</span>.$title;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        </div>
<div class="line"><a name="l01133"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a1c0b5e1f1c1a56a9dd657671d3fcfb81"> 1133</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a1c0b5e1f1c1a56a9dd657671d3fcfb81">setPageTitle</a>($title){</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                $this-&gt;pageTitle = $title;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        </div>
<div class="line"><a name="l01147"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a71054f5ea5e2793cb63623eeb4d3290b"> 1147</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a71054f5ea5e2793cb63623eeb4d3290b" title="Gets the site title.">getSiteTitle</a>(){</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                $title = <span class="stringliteral">&#39;Dataface Application&#39;</span>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                 </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;title&#39;</span>]) ) {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                                $title = $this-&gt;<a class="code" href="class_dataface___application.html#a2b1206b3591e1ecd8c5ea04c9fa18ea7" title="Evaluates a string expression replacing PHP variables with appropriate values in the current record...">parseString</a>($this-&gt;_conf[<span class="stringliteral">&#39;title&#39;</span>]);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                        } <span class="keywordflow">catch</span> (Exception $ex){</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                $title = $this-&gt;_conf[<span class="stringliteral">&#39;title&#39;</span>];</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                        }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                <span class="keywordflow">return</span> $title;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="comment">// END CONFIGURATION</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc"> 1191</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>(){</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_query;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        </div>
<div class="line"><a name="l01218"></a><span class="lineno"><a class="code" href="class_dataface___application.html#af72f75e0f3fc06f2c8ef0fcb530ecece"> 1218</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#af72f75e0f3fc06f2c8ef0fcb530ecece" title="Returns a query parameter.">getQueryParam</a>($key){</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                <span class="keywordflow">if</span> ( isset( $this-&gt;_query[<span class="charliteral">&#39;-&#39;</span>.$key] ) ){</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_query[<span class="charliteral">&#39;-&#39;</span>.$key];</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                        $null = null;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                        <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        </div>
<div class="line"><a name="l01231"></a><span class="lineno"><a class="code" href="class_dataface___application.html#ab4ab662721ab7378baea2130a1298271"> 1231</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#ab4ab662721ab7378baea2130a1298271" title="Loads the current result set.">getResultSet</a>(){</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;queryTool === null ){</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                        <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/QueryTool.php&#39;</span>);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                        $this-&gt;queryTool = <a class="code" href="class_dataface___query_tool.html#afba23c1b6fcf0146ba929cba978cbc23">Dataface_QueryTool::loadResult</a>($this-&gt;_query[<span class="stringliteral">&#39;-table&#39;</span>], $this-&gt;<a class="code" href="class_dataface___application.html#abf2dfcff06cad1e6c249ddc4df4d0866" title="Returns MySQL connection resource.">db</a>(), $this-&gt;_query);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                }</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                <span class="keywordflow">return</span> $this-&gt;queryTool;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        </div>
<div class="line"><a name="l01284"></a><span class="lineno"><a class="code" href="class_dataface___application.html#af296b1b4fc05d00411862370131e4d34"> 1284</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#af296b1b4fc05d00411862370131e4d34" title="Gets the current record based on the current query.">getRecord</a>(){</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                $null = null;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;currentRecord === null ){</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                        $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                        <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;--no-query&#39;</span>] ){</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                                $null = null;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                                <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                        }</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                        $q=array();</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                        <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>]) and is_array($_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>]) ){</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                                <span class="keywordflow">foreach</span> ($_REQUEST[<span class="stringliteral">&#39;__keys__&#39;</span>] as $key=&gt;$val) $q[$key] = <span class="charliteral">&#39;=&#39;</span>.$val;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                                $this-&gt;currentRecord = df_get_record($query[<span class="stringliteral">&#39;-table&#39;</span>], $q);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;-__keys__&#39;</span>]) and is_array($_REQUEST[<span class="stringliteral">&#39;-__keys__&#39;</span>]) ){</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                                <span class="keywordflow">foreach</span> ($_REQUEST[<span class="stringliteral">&#39;-__keys__&#39;</span>] as $key=&gt;$val) $q[$key] = <span class="charliteral">&#39;=&#39;</span>.$val;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                                $this-&gt;currentRecord = df_get_record($query[<span class="stringliteral">&#39;-table&#39;</span>], $q);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;--__keys__&#39;</span>]) and is_array($_REQUEST[<span class="stringliteral">&#39;--__keys__&#39;</span>]) ){</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                                <span class="keywordflow">foreach</span> ($_REQUEST[<span class="stringliteral">&#39;--__keys__&#39;</span>] as $key=&gt;$val) $q[$key] = <span class="charliteral">&#39;=&#39;</span>.$val;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                                $this-&gt;currentRecord = df_get_record($query[<span class="stringliteral">&#39;-table&#39;</span>], $q);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;--recordid&#39;</span>]) ){</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                                $this-&gt;currentRecord = df_get_record_by_id($_REQUEST[<span class="stringliteral">&#39;--recordid&#39;</span>]);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($_REQUEST[<span class="stringliteral">&#39;-recordid&#39;</span>]) ){</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                                $this-&gt;currentRecord = df_get_record_by_id($_REQUEST[<span class="stringliteral">&#39;-recordid&#39;</span>]);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                                $rs = $this-&gt;<a class="code" href="class_dataface___application.html#ab4ab662721ab7378baea2130a1298271" title="Loads the current result set.">getResultSet</a>();</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                                $this-&gt;currentRecord = $rs-&gt;loadCurrent();</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                        }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;currentRecord === null ) $this-&gt;currentRecord = -1;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;currentRecord === -1 || !$this-&gt;currentRecord ) <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                <span class="keywordflow">return</span> $this-&gt;currentRecord;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        </div>
<div class="line"><a name="l01327"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2f867daaafda84a85ff23de13a49552b"> 1327</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2f867daaafda84a85ff23de13a49552b" title="Returns the related record that forms a context for the specified record id. A context is provided so...">getRecordContext</a>($id=null){</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;recordContext) ){</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                        $this-&gt;recordContext = array();</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                        $query = $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                        <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-portal-context&#39;</span>] ){</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                                $rrec = df_get_record_by_id($query[<span class="stringliteral">&#39;-portal-context&#39;</span>]);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($rrec) ){</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                                        $rrec = null;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                                }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                                <span class="keywordflow">if</span> ( is_a($rrec, <span class="stringliteral">&#39;Dataface_RelatedRecord&#39;</span>) ){</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                        $destRecords = $rrec-&gt;toRecords();</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                        <span class="keywordflow">foreach</span> ($destRecords as $destRec){</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                                                $this-&gt;recordContext[$destRec-&gt;getId()] = $rrec;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                        }</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                                </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                        }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                <span class="keywordflow">if</span> ( !isset($id) ){</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                        <span class="keywordflow">foreach</span> ($this-&gt;recordContext as $rrec) <span class="keywordflow">return</span> $rrec;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                        <span class="keywordflow">return</span> @$this-&gt;recordContext[$id];</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        </div>
<div class="line"><a name="l01364"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2e169477fb1126fdca683d5ac763d28b"> 1364</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2e169477fb1126fdca683d5ac763d28b" title="Adds a related record to the current context. This provides a lense through which to view the destina...">addRecordContext</a>(<a class="code" href="class_dataface___related_record.html" title="Encapsulates a row in a relationship. This may contain fields that span across multiple tables...">Dataface_RelatedRecord</a> $rec){</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                $this-&gt;<a class="code" href="class_dataface___application.html#a2f867daaafda84a85ff23de13a49552b" title="Returns the related record that forms a context for the specified record id. A context is provided so...">getRecordContext</a>();</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                $destRecords = $rec-&gt;<a class="code" href="class_dataface___related_record.html#aa106740a70079d1f15a88a7bc0f8a00b" title="Returns an array of Dataface_Record objects that represent collectively this related record...">toRecords</a>();</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                <span class="keywordflow">foreach</span> ($destRecords as $destRec){</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                        $this-&gt;recordContext[$destRec-&gt;getId()] = $rec;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                <a class="code" href="class_dataface___permissions_tool.html#a0ad7684f4a768fb4dfed1f3aa046f194">Dataface_PermissionsTool::addContextMask</a>($rec);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        </div>
<div class="line"><a name="l01384"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a62444f054c0413110e14df56fc66ccba"> 1384</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a62444f054c0413110e14df56fc66ccba" title="Clears the current record context. The record context is a set of related records that are meant to b...">clearRecordContext</a>(){</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                $this-&gt;recordContext = array();</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                $contextMasks =&amp; <a class="code" href="class_dataface___permissions_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_PermissionsTool::getInstance</a>()-&gt;getContextMasks();</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                <span class="keywordflow">foreach</span> ($contextMasks as $k=&gt;$v){</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                        unset($contextMasks[$k]);</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        </div>
<div class="line"><a name="l01399"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a98431b5784ef2176775fe9521935f138"> 1399</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a98431b5784ef2176775fe9521935f138" title="Checks is the current record has been loaded yet.">recordLoaded</a>(){</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                <span class="keywordflow">return</span> ( $this-&gt;currentRecord !== null);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        }</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;         </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;         </div>
<div class="line"><a name="l01410"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a8ab4bdaf70679e4dc2b9b8892e2b80fc"> 1410</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#a8ab4bdaf70679e4dc2b9b8892e2b80fc" title="Gets the settings array for the current action as specified by the -action parameter of the current q...">getAction</a>(){</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/ActionTool.php&#39;</span>);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                $actionTool = <a class="code" href="class_dataface___action_tool.html#a9eb606fdb589cab3ae9edc96dce15972">Dataface_ActionTool::getInstance</a>();</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                <span class="keywordflow">return</span> $actionTool-&gt;getAction(array(<span class="stringliteral">&#39;name&#39;</span>=&gt;$this-&gt;_query[<span class="stringliteral">&#39;-action&#39;</span>]));</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        </div>
<div class="line"><a name="l01454"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a75fa059c174baee27db1a24c3e9eb566"> 1454</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a75fa059c174baee27db1a24c3e9eb566" title="Gets the name of the action that should be used as a search target from the given action context...">getSearchTarget</a>(array $action=null){</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                <span class="keywordflow">if</span> ( !isset($action) ){</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                        $action = $this-&gt;<a class="code" href="class_dataface___application.html#a8ab4bdaf70679e4dc2b9b8892e2b80fc" title="Gets the settings array for the current action as specified by the -action parameter of the current q...">getAction</a>();</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                        </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                        <span class="keywordflow">if</span> ( !isset($action) or !is_array($action)){</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;default_search_target&#39;</span>] ) <span class="keywordflow">return</span> $this-&gt;_conf[<span class="stringliteral">&#39;default_search_target&#39;</span>];</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="stringliteral">&#39;list&#39;</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                                <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_dataface___application.html#a75fa059c174baee27db1a24c3e9eb566" title="Gets the name of the action that should be used as a search target from the given action context...">getSearchTarget</a>($action);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                        }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                        <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>($this-&gt;_query[<span class="stringliteral">&#39;-table&#39;</span>]);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                        $tableDel = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getDelegate();</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                        $method = <span class="stringliteral">&#39;getSearchTarget&#39;</span>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                        <span class="keywordflow">if</span> ( isset($tableDel) and method_exists($tableDel, $method) ){</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                                <span class="keywordflow">return</span> $tableDel-&gt;$method($action);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                        }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                        </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                        $appDel = $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                        <span class="keywordflow">if</span> ( isset($appDel) and method_exists($appDel, $method) ){</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                                <span class="keywordflow">return</span> $appDel-&gt;$method($action);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                        }</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                        </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                        </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                        <span class="keywordflow">if</span> ( @$action[<span class="stringliteral">&#39;search_target&#39;</span>] ){</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                                <span class="keywordflow">return</span> $action[<span class="stringliteral">&#39;search_target&#39;</span>];</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;default_search_target&#39;</span>] ) <span class="keywordflow">return</span> $this-&gt;_conf[<span class="stringliteral">&#39;default_search_target&#39;</span>];</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="stringliteral">&#39;list&#39;</span>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                        }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;         </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <span class="comment">// END Request Context</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aaf094d745d982ac490eb73662e6cd303"> 1516</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aaf094d745d982ac490eb73662e6cd303" title="Sets a message to be displayed as an info/alert the next time a page is rendered. This is handy if yo...">saveMessage</a>($str){</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                $_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>] = $str;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        </div>
<div class="line"><a name="l01529"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a0e5c8160381b02811a16d84ad6df2f5d"> 1529</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a0e5c8160381b02811a16d84ad6df2f5d" title="Sets the cookie that causes sessions to be enabled by default. In order to maximize performance Xataf...">enableSessions</a>(){</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                setcookie($this-&gt;sessionCookieKey, 1, 0, DATAFACE_SITE_URL);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        </div>
<div class="line"><a name="l01542"></a><span class="lineno"><a class="code" href="class_dataface___application.html#abd736636c6a39d0561d52f47c42f2100"> 1542</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#abd736636c6a39d0561d52f47c42f2100" title="Unsets the cookie that causes sessions to be enabled by default. Despite the name, this doesn&#39;t actually disable sessions. Sessions will still be enabled when they are needed, eg for login. This will just enable them always by default.">disableSessions</a>(){</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                setcookie($this-&gt;sessionCookieKey, 1, time()-3600*25, DATAFACE_SITE_URL);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        </div>
<div class="line"><a name="l01554"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aadf1a51637c0246767961b76e4b30fcc"> 1554</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aadf1a51637c0246767961b76e4b30fcc" title="Checks if sessions are enabled by default.">sessionEnabled</a>(){</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                <span class="keywordflow">return</span> @$_COOKIE[$this-&gt;sessionCookieKey];</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        </div>
<div class="line"><a name="l01569"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a3e3d63db4cce7a150e81ab2e8573f450"> 1569</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a3e3d63db4cce7a150e81ab2e8573f450" title="Starts a session if one does not already exist. If you are writing code that needs to use session dat...">startSession</a>($conf=null){</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;XATAFACE_NO_SESSION&#39;</span>) and XATAFACE_NO_SESSION ) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                <span class="comment">//echo &quot;In startSession()&quot;;</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                <span class="keywordflow">if</span> ( !$this-&gt;<a class="code" href="class_dataface___application.html#aadf1a51637c0246767961b76e4b30fcc" title="Checks if sessions are enabled by default.">sessionEnabled</a>() ){</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                        $this-&gt;<a class="code" href="class_dataface___application.html#a0e5c8160381b02811a16d84ad6df2f5d" title="Sets the cookie that causes sessions to be enabled by default. In order to maximize performance Xataf...">enableSessions</a>();</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                <span class="keywordflow">if</span> ( session_id() == <span class="stringliteral">&quot;&quot;</span> ){</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                        <span class="keywordflow">if</span> ( !isset($conf) ){</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>]) ) $conf = $this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>];</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                                <span class="keywordflow">else</span> $conf = array();</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                        }</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                        </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                        $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                        <span class="keywordflow">if</span> ( isset($delegate) and method_exists($delegate, <span class="stringliteral">&#39;startSession&#39;</span>) ){</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                                $delegate-&gt;startSession($conf);</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                                </div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                                <span class="comment">// path for cookies</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                                $parts = parse_url(DATAFACE_SITE_URL);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                                $cookie_path = $parts[<span class="stringliteral">&#39;path&#39;</span>];</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                <span class="keywordflow">if</span> ( isset($conf[<span class="stringliteral">&#39;cookie_path&#39;</span>]) ){</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                        $cookie_path = $conf[<span class="stringliteral">&#39;cookie_path&#39;</span>];</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                                        <span class="keywordflow">if</span> ( substr($cookie_path,0,4) == <span class="stringliteral">&#39;php:&#39;</span> ){</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                                                $cookie_path_expr = substr($cookie_path,4);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                                eval(<span class="stringliteral">&#39;$cookie_path = &#39;</span>.$cookie_path_expr.<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                                        }</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                                }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                                </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                                <span class="keywordflow">if</span> (strlen($cookie_path)==0) $cookie_path = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                                <span class="keywordflow">if</span> ( $cookie_path{strlen($cookie_path)-1} != <span class="charliteral">&#39;/&#39;</span> ) $cookie_path .= <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                <span class="comment">// timeout value for the cookie</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                $cookie_timeout = (isset($conf[<span class="stringliteral">&#39;session_timeout&#39;</span>]) ? intval($conf[<span class="stringliteral">&#39;session_timeout&#39;</span>]) : 24*60*60);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                                </div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                                </div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                <span class="comment">// timeout value for the garbage collector</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                                <span class="comment">//   we add 300 seconds, just in case the user&#39;s computer clock</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                                <span class="comment">//   was synchronized meanwhile; 600 secs (10 minutes) should be</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                                <span class="comment">//   enough - just to ensure there is session data until the</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                                <span class="comment">//   cookie expires</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                                $garbage_timeout = $cookie_timeout + 600; <span class="comment">// in seconds</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                                </div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                                <span class="comment">// set the PHP session id (PHPSESSID) cookie to a custom value</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                                session_set_cookie_params($cookie_timeout, $cookie_path);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                                </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                                <span class="comment">// set the garbage collector - who will clean the session files -</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                                <span class="comment">//   to our custom timeout</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                                ini_set(<span class="stringliteral">&#39;session.gc_maxlifetime&#39;</span>, $garbage_timeout);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                                <span class="keywordflow">if</span> ( isset($conf[<span class="stringliteral">&#39;session_timeout&#39;</span>]) and ini_get(<span class="stringliteral">&#39;session.save_handler&#39;</span>) == <span class="stringliteral">&#39;files&#39;</span> ){</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                                        <span class="comment">// we need a distinct directory for the session files,</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                                        <span class="comment">//   otherwise another garbage collector with a lower gc_maxlifetime</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                                        <span class="comment">//   will clean our files aswell - but in an own directory, we only</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                                        <span class="comment">//   clean sessions with our &quot;own&quot; garbage collector (which has a</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                                        <span class="comment">//   custom timeout/maxlifetime set each time one of our scripts is</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                                        <span class="comment">//   executed)</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                                        strstr(strtoupper(substr(@<a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&quot;OS&quot;</span>], 0, 3)), <span class="stringliteral">&quot;WIN&quot;</span>) ? </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                                                $sep = <span class="stringliteral">&quot;\\&quot;</span> : $sep = <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                                        $sessdir = session_save_path(); <span class="comment">//ini_get(&#39;session.save_path&#39;);</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                                        $levels = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                                        <span class="keywordflow">if</span> (strpos($sessdir, <span class="stringliteral">&quot;;&quot;</span>) !== FALSE){</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                                                $levels = substr($sessdir, 0, strpos($sessdir, <span class="stringliteral">&quot;;&quot;</span>)).<span class="charliteral">&#39;;&#39;</span>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                                                 $sessdir = substr($sessdir, strpos($sessdir, <span class="stringliteral">&quot;;&quot;</span>)+1);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                                        }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                                        <span class="keywordflow">if</span> ( !$sessdir ) $sessdir = sys_get_temp_dir(); <span class="comment">//&#39;/tmp&#39;;</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                                        <span class="keywordflow">if</span> ( $sessdir and $sessdir{strlen($sessdir)-1} == <span class="charliteral">&#39;/&#39;</span> ) $sessdir = substr($sessdir,0, strlen($sessdir)-1);</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                        </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                                        <span class="keywordflow">if</span> ( @$conf[<span class="stringliteral">&#39;subdir&#39;</span>] ) $subdir = $conf[<span class="stringliteral">&#39;subdir&#39;</span>];</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                                        <span class="keywordflow">else</span> $subdir = md5(DATAFACE_SITE_PATH);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                                        <span class="keywordflow">if</span> ( !$subdir ) $subdir = <span class="stringliteral">&#39;dataface&#39;</span>;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                                        $sessdir .= <span class="stringliteral">&quot;/&quot;</span>.$subdir;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                                        </div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                        </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                                        <span class="keywordflow">if</span> (!is_dir($sessdir)) { </div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                                                $res = @mkdir($sessdir, 0777);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                                                <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                                                        error_log(<span class="stringliteral">&quot;Failed to create session directory &#39;$sessdir&#39; to store session files in &quot;</span>.__FILE__.<span class="stringliteral">&quot; on line &quot;</span>.__LINE__);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                                        </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                                                }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                        }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                        <span class="keywordflow">if</span> (is_dir($sessdir) ){</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                                                session_save_path($sessdir);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                                        }</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                        <span class="comment">// We need to set a unique session name if we&#39;re not changing the directory</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                                        <span class="keywordflow">if</span> ( !@$conf[<span class="stringliteral">&#39;session_name&#39;</span>] ){</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                                                $conf[<span class="stringliteral">&#39;session_name&#39;</span>] = md5(DATAFACE_SITE_PATH);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                                        }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                                }</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                                <span class="keywordflow">if</span> ( @$conf[<span class="stringliteral">&#39;session_name&#39;</span>] ) session_name($conf[<span class="stringliteral">&#39;session_name&#39;</span>]);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                                <span class="comment">//echo &quot;Starting session with &quot;.session_name();</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                                session_start();        <span class="comment">// start the session</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                                header(<span class="stringliteral">&#39;P3P: CP=&quot;IDC DSP COR CURa ADMa OUR IND PHY ONL COM STA&quot;&#39;</span>);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                                </div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                                <span class="comment">// This updates the session timeout on page load</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                                <span class="keywordflow">if</span> ( isset($_COOKIE[session_name()]) ){</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                                        setcookie(session_name(), $_COOKIE[session_name()], time() + $cookie_timeout, $cookie_path);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                                }</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                        }</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                        <span class="comment">//echo &quot;Session already started&quot;;</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                <span class="keywordflow">if</span> ( isset( $_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>] ) ){</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                        $this-&gt;<a class="code" href="class_dataface___application.html#aed1bea50951ae75cbc78ecc7ba241870" title="Adds a message to be displayed in the messages block.">addMessage</a>($_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                        unset($_SESSION[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                }</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        </div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        </div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="keyword">function</span> writeSessionData(){</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;locations) ) $_SESSION[<span class="stringliteral">&#39;locations&#39;</span>] = serialize($this-&gt;locations);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keyword">function</span> encodeLocation($url){</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;locations) and isset($_SESSION[<span class="stringliteral">&#39;locations&#39;</span>]) ) $this-&gt;locations = unserialize($_SESSION[<span class="stringliteral">&#39;locations&#39;</span>]);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !isset($this-&gt;locations) ) $this-&gt;locations = array();</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                $key = md5($url);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                $this-&gt;locations[$key] = $url;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                <span class="keywordflow">return</span> $key;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="keyword">function</span> decodeLocation($key){</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;locations) and isset($_SESSION[<span class="stringliteral">&#39;locations&#39;</span>]) ) $this-&gt;locations = unserialize($_SESSION[<span class="stringliteral">&#39;locations&#39;</span>]);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !isset($this-&gt;locations) ) $this-&gt;locations = array();</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;locations[$key]) ){</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                        $url = $this-&gt;locations[$key];</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                        unset($this-&gt;locations[$key]);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                        <span class="keywordflow">return</span> $url;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                </div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        </div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        }</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;         </div>
<div class="line"><a name="l01724"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aec35ba475a29ee3e79e20029e4862c28"> 1724</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#aec35ba475a29ee3e79e20029e4862c28" title="Obtains reference to the authentication tool.">getAuthenticationTool</a>(){</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                $null = null;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;authenticationTool) ){</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                        </div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>]) ){</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/AuthenticationTool.php&#39;</span>);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                                $this-&gt;authenticationTool = <a class="code" href="class_dataface___authentication_tool.html#a70344e265a1689f4ef67ce1bc5d889df">Dataface_AuthenticationTool::getInstance</a>($this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>]);</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                                <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                        }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                        </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                <span class="keywordflow">return</span> $this-&gt;authenticationTool;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        }</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;         </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;         </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;         </div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="comment">// END Session Handling</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="comment">//=====================================================================================================</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a8922a305e2a3e1cc73a2505046c375b1"> 1777</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a8922a305e2a3e1cc73a2505046c375b1" title="Adds some content meant to be inserted in the head of the application.">addHeadContent</a>($content){</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                $this-&gt;headContent[] = $content;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        </div>
<div class="line"><a name="l01802"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a840056ab109589a8dd3f28496dea4912"> 1802</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a840056ab109589a8dd3f28496dea4912" title="Returns the nav item info for a key. This is a wrapper around the nav items defined in the [_tables] ...">getNavItem</a>($key, $label=null){</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                $del =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                $override = array();</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                <span class="keywordflow">if</span> ( isset($del) and method_exists($del, <span class="stringliteral">&#39;getNavItem&#39;</span>) ){</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                                $override = $del-&gt;getNavItem($key, $label?$label:$key);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                        } <span class="keywordflow">catch</span> (Exception $ex){}</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                <span class="keywordflow">if</span> ( !isset($override) ){</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                        <span class="keywordflow">return</span> $override;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                }</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                <span class="keywordflow">return</span> array_merge(array(</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                        <span class="stringliteral">&#39;href&#39;</span>=&gt; DATAFACE_SITE_HREF.<span class="stringliteral">&#39;?-table=&#39;</span>.urlencode($key),</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                        <span class="stringliteral">&#39;label&#39;</span>=&gt; $label ? $label:$key,</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                        <span class="stringliteral">&#39;selected&#39;</span> =&gt; $this-&gt;<a class="code" href="class_dataface___application.html#a85ee40f452e674a1d2facab70e8d51d8" title="Checks whether the specified nav item is currently selected. This is used by the default implementati...">isNavItemSelected</a>($key)</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                ), $override);</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        </div>
<div class="line"><a name="l01836"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a85ee40f452e674a1d2facab70e8d51d8"> 1836</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a85ee40f452e674a1d2facab70e8d51d8" title="Checks whether the specified nav item is currently selected. This is used by the default implementati...">isNavItemSelected</a>($key){</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                $del =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                <span class="keywordflow">if</span> ( isset($del) and method_exists($del, <span class="stringliteral">&#39;isNavItemSelected&#39;</span>) ){</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                                <span class="keywordflow">return</span> $del-&gt;isNavItemSelected($key);</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                        } <span class="keywordflow">catch</span> (Exception $ex){}</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                }</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                <span class="keywordflow">return</span> ($query[<span class="stringliteral">&#39;-table&#39;</span>] == $key);</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        }</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        </div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        </div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        </div>
<div class="line"><a name="l01859"></a><span class="lineno"><a class="code" href="class_dataface___application.html#af94b7f8d7868cb953ec7facb7bbb5597"> 1859</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#af94b7f8d7868cb953ec7facb7bbb5597" title="Adds an error to be displayed in the UI in the messages block.">addError</a>($err){</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                $this-&gt;errors[] = $err;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        </div>
<div class="line"><a name="l01871"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aeee58d4eadaf4ed90c3897c33f72fe88"> 1871</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aeee58d4eadaf4ed90c3897c33f72fe88" title="Returns the number of errors that are to be displayed to the user in the messages block...">numErrors</a>(){ <span class="keywordflow">return</span> count($this-&gt;errors); }</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        </div>
<div class="line"><a name="l01880"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a6e548ebf2656742bfd19939ead923ed2"> 1880</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a6e548ebf2656742bfd19939ead923ed2" title="Returns an array of the errors that are set to be displayed to the user in the messages block...">getErrors</a>(){</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                <span class="keywordflow">return</span> $this-&gt;errors;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        }</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        </div>
<div class="line"><a name="l01892"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aed1bea50951ae75cbc78ecc7ba241870"> 1892</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aed1bea50951ae75cbc78ecc7ba241870" title="Adds a message to be displayed in the messages block.">addMessage</a>($msg){</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                $this-&gt;messages[] = $msg;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        }</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        </div>
<div class="line"><a name="l01907"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a7347b0b89cca1d7604e93f5b5e896fc4"> 1907</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a7347b0b89cca1d7604e93f5b5e896fc4" title="Gets the messages that are to be displayed in the messages block. This will look in multiple sources ...">getMessages</a>(){</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                <span class="keywordflow">if</span> ( trim(@$_SESSION[<span class="stringliteral">&#39;msg&#39;</span>]) ){</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                        array_push($this-&gt;messages, $_SESSION[<span class="stringliteral">&#39;msg&#39;</span>]);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                        unset($_SESSION[<span class="stringliteral">&#39;msg&#39;</span>]);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                }</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                $msgs = $this-&gt;messages;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                $response = $this-&gt;<a class="code" href="class_dataface___application.html#a014c5495ef99e58e4cd3c9a9c8bba41d" title="Returns the response array used for compiling response. The response may include messages that need t...">getResponse</a>();</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                <span class="keywordflow">if</span> ( @$response[<span class="stringliteral">&#39;--msg&#39;</span>] ){</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                        array_push($msgs, $response[<span class="stringliteral">&#39;--msg&#39;</span>]);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                }</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                <span class="comment">//print_r($msgs);</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                <span class="keywordflow">return</span> $msgs;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        }</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        </div>
<div class="line"><a name="l01925"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a53c41e070f97eeec827a3f92d1638f85"> 1925</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a53c41e070f97eeec827a3f92d1638f85" title="Clears all of the message to be displayed.">clearMessages</a>(){</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                $this-&gt;messages = array();</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        </div>
<div class="line"><a name="l01933"></a><span class="lineno"><a class="code" href="class_dataface___application.html#aa387ccff8f47bba7666025acb3c0a096"> 1933</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#aa387ccff8f47bba7666025acb3c0a096" title="Returns the number of messages to be displayed to the user.">numMessages</a>(){</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                $count = count($this-&gt;messages);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                $response = $this-&gt;<a class="code" href="class_dataface___application.html#a014c5495ef99e58e4cd3c9a9c8bba41d" title="Returns the response array used for compiling response. The response may include messages that need t...">getResponse</a>();</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                <span class="keywordflow">if</span> ( @$response[<span class="stringliteral">&#39;--msg&#39;</span>] ) $count++;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                <span class="keywordflow">return</span> $count;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        }</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        </div>
<div class="line"><a name="l01951"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a014c5495ef99e58e4cd3c9a9c8bba41d"> 1951</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#a014c5495ef99e58e4cd3c9a9c8bba41d" title="Returns the response array used for compiling response. The response may include messages that need t...">getResponse</a>(){</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                <span class="keyword">static</span> $response = 0;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                <span class="keywordflow">if</span> ( !$response ){</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                        $response = array(<span class="stringliteral">&#39;--msg&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                }</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                <span class="keywordflow">return</span> $response;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        }</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;         </div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;         </div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="comment">// END Template &amp; UI Interaction</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        <span class="comment">//====================================================================================</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        <span class="comment">// {@</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"><a class="code" href="class_dataface___application.html#abdc4e87b8293bdfe510be48cfcc4b124"> 1982</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#abdc4e87b8293bdfe510be48cfcc4b124" title="Fires an event to all event listeners.">fireEvent</a>($name, $params=null){</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                $listeners = $this-&gt;<a class="code" href="class_dataface___application.html#a511c5ee61ae92a6157153e4b29564b44" title="Gets a list of the callbacks that are registered for a given event.">getEventListeners</a>($name);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                <span class="keywordflow">foreach</span> ($listeners as $listener){</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                        $res = call_user_func($listener, $params);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($res) ) <span class="keywordflow">return</span> $res;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        }</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        </div>
<div class="line"><a name="l02001"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a4ad87ce803befbbccf694f99b3547f2d"> 2001</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a4ad87ce803befbbccf694f99b3547f2d" title="Registers an event listener to respond to events of a certain type.">registerEventListener</a>($name, $callback){</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;eventListeners[$name]) ) $this-&gt;eventListeners[$name] = array();</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                $this-&gt;eventListeners[$name][] = $callback;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        }</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        </div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        </div>
<div class="line"><a name="l02013"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a5e6c6db7587de254aa1dbe234cfcf677"> 2013</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a5e6c6db7587de254aa1dbe234cfcf677" title="Unregisters an event listener.">unregisterEventListener</a>($name, $callback){</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;eventListeners[$name]) ){</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                        $listeners =&amp; $this-&gt;eventListeners[$name];</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                        <span class="keywordflow">foreach</span> ( $listeners as $key=&gt;$listener ){</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                                <span class="keywordflow">if</span> ( $listener == $callback ) unset($listeners[$key]);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                        }</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        </div>
<div class="line"><a name="l02027"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a511c5ee61ae92a6157153e4b29564b44"> 2027</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a511c5ee61ae92a6157153e4b29564b44" title="Gets a list of the callbacks that are registered for a given event.">getEventListeners</a>($name=null){</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                <span class="keywordflow">if</span> ( !isset($name) ) <span class="keywordflow">return</span> $this-&gt;eventListeners;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($this-&gt;eventListeners[$name])){</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;eventListeners[$name];</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                        <span class="keywordflow">return</span> array();</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        }</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        </div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;         </div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;         </div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        <span class="comment">// END Event Handling</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <span class="comment">//=====================================================================================</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        </div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        </div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2fdc861bcfe01ddc11cea1316406ebc6"> 2075</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2fdc861bcfe01ddc11cea1316406ebc6" title="Handle a request. This method is the starting point for all Dataface application requests. It will delegate the request to the appropriate handler. The order of delegation is as follows:Uses the ActionTool to check permissions for the action. If permissions are not granted, dispatch the error handler. If permissions are granted then we continue down the delegation chain.If the current table&#39;s delegate class defines a handleRequest() method, then call that.If the current table&#39;s delegate class does not have a handleRequest() method or that method returns a PEAR_Error object with code E_DATAFACE_REQUEST_NOT_HANDLED, then check for a handler bearing the name of the action in one of the actions directories. Check the directories in the following order: a. &lt;site url&gt;=&quot;&quot;&gt;/tables/.">handleRequest</a>($disableCache=<span class="keyword">false</span>){</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                </div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                </div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                <span class="keywordflow">if</span> ( !$disableCache and (@$_GET[<span class="stringliteral">&#39;-action&#39;</span>] != <span class="stringliteral">&#39;getBlob&#39;</span>) and isset( $this-&gt;_conf[<span class="stringliteral">&#39;_output_cache&#39;</span>] ) and @$this-&gt;_conf[<span class="stringliteral">&#39;_output_cache&#39;</span>][<span class="stringliteral">&#39;enabled&#39;</span>] and count($_POST) == 0){</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                        <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/OutputCache.php&#39;</span>);</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                        $oc = <span class="keyword">new</span> <a class="code" href="class_dataface___output_cache.html">Dataface_OutputCache</a>($this-&gt;_conf[<span class="stringliteral">&#39;_output_cache&#39;</span>]);</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                        $oc-&gt;ob_start();</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                        </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                }</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/ActionTool.php&#39;</span>);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/PermissionsTool.php&#39;</span>);</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/Table.php&#39;</span>);</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                </div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) and count($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) &gt; 0 ){</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                        $mt = <a class="code" href="class_dataface___module_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ModuleTool::getInstance</a>();</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                        <span class="keywordflow">foreach</span> ($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] as $modname=&gt;$modpath){</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                                $mt-&gt;loadModule($modname);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                                </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                        }</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                }</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                </div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                $this-&gt;<a class="code" href="class_dataface___application.html#abdc4e87b8293bdfe510be48cfcc4b124" title="Fires an event to all event listeners.">fireEvent</a>(<span class="stringliteral">&#39;beforeHandleRequest&#39;</span>);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                $applicationDelegate = $this-&gt;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>();</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                <span class="keywordflow">if</span> ( isset($applicationDelegate) and method_exists($applicationDelegate, <span class="stringliteral">&#39;beforeHandleRequest&#39;</span>) ){</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                        <span class="comment">// Do whatever we need to do before the request is handled.</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                        $applicationDelegate-&gt;beforeHandleRequest();</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                }</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                </div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                <span class="comment">// Set up security filters</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>($query[<span class="stringliteral">&#39;-table&#39;</span>]);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                <span class="comment">//$table-&gt;setSecurityFilter();</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">                 * Set up some preferences for the display of the application.</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment">                 * These can be overridden by the getPreferences() method in the</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">                 * application delegate class.</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_prefs&#39;</span>]) and is_array($this-&gt;_conf[<span class="stringliteral">&#39;_prefs&#39;</span>]) ){</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                        $this-&gt;prefs = array_merge($this-&gt;prefs,$this-&gt;_conf[<span class="stringliteral">&#39;_prefs&#39;</span>]);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                }</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;hide_nav_menu&#39;</span>] ){</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;show_tables_menu&#39;</span>] = 0;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                }</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                </div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;hide_view_tabs&#39;</span>] ){</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;show_table_tabs&#39;</span>] = 0;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                }</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;hide_result_controller&#39;</span>] ){</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;show_result_controller&#39;</span>] = 0;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                }</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                </div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;hide_table_result_stats&#39;</span>] ){</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;show_result_stats&#39;</span>] = 0;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                }</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;hide_search&#39;</span>] ){</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;show_search&#39;</span>] = 0;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                }</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                </div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;prefs[<span class="stringliteral">&#39;disable_ajax_record_details&#39;</span>]) ){</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                        $this-&gt;prefs[<span class="stringliteral">&#39;disable_ajax_record_details&#39;</span>] = 1;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                <span class="keywordflow">if</span> ( $query[<span class="stringliteral">&#39;-action&#39;</span>] == <span class="stringliteral">&#39;login_prompt&#39;</span> ) $this-&gt;prefs[<span class="stringliteral">&#39;no_history&#39;</span>] = 1;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                </div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                <span class="keywordflow">if</span> ( isset($applicationDelegate) and method_exists($applicationDelegate, <span class="stringliteral">&#39;getPreferences&#39;</span>) ){</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                        $this-&gt;prefs = array_merge($this-&gt;prefs, $applicationDelegate-&gt;getPreferences());</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                }</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                $this-&gt;prefs = array_map(<span class="stringliteral">&#39;intval&#39;</span>, $this-&gt;prefs);</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                </div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                <span class="comment">// Check to make sure that this table hasn&#39;t been disallowed</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                $disallowed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>]) ){</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                        <span class="keywordflow">foreach</span> ( $this-&gt;_conf[<span class="stringliteral">&#39;_disallowed_tables&#39;</span>] as $name=&gt;$pattern ){</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                                <span class="keywordflow">if</span> ( $pattern{0} == <span class="charliteral">&#39;/&#39;</span> and preg_match($pattern, $query[<span class="stringliteral">&#39;-table&#39;</span>]) ){</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                                        $disallowed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $pattern == $query[<span class="stringliteral">&#39;-table&#39;</span>] ){</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                                        $disallowed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                                }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                        }</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                </div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                <span class="keywordflow">if</span> ( $disallowed and isset($this-&gt;_conf[<span class="stringliteral">&#39;_allowed_tables&#39;</span>]) ){</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                        <span class="keywordflow">foreach</span> ($this-&gt;_conf[<span class="stringliteral">&#39;_allowed_tables&#39;</span>] as $name=&gt;$pattern ){</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                                <span class="keywordflow">if</span> ( $pattern{0} == <span class="charliteral">&#39;/&#39;</span> and preg_match($pattern, $query[<span class="stringliteral">&#39;-table&#39;</span>]) ){</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                                        $disallowed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $pattern == $query[<span class="stringliteral">&#39;-table&#39;</span>] ){</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                                        $disallowed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                                }</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                        }</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                }</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                </div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                <span class="keywordflow">if</span> ( $disallowed ){</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#af326456319a1a38b3ae0c9a1942e1458">Dataface_Error::permissionDenied</a>(</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                                <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                                        <span class="comment">/*i18n id*/</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                                        <span class="stringliteral">&quot;Permission Denied. This table has been disallowed in the conf.ini file&quot;</span>,</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                                        <span class="comment">/* default error message */</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                                        <span class="stringliteral">&quot;Permission denied because this table has been disallowed in the conf.ini file &#39;&quot;</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                                )</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                        );</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                        </div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                }</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                </div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                $actionTool = <a class="code" href="class_dataface___action_tool.html#a9eb606fdb589cab3ae9edc96dce15972">Dataface_ActionTool::getInstance</a>();</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                </div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                <span class="comment">//if ( $this-&gt;_conf[&#39;multilingual_content&#39;] ){</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                        <span class="comment">//import(&#39;I18Nv2/I18Nv2.php&#39;);</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                <span class="comment">//I18Nv2::autoConv();</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;                </div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                $params = array(</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                        <span class="stringliteral">&#39;table&#39;</span>=&gt;$query[<span class="stringliteral">&#39;-table&#39;</span>],</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                        <span class="stringliteral">&#39;name&#39;</span>=&gt;$query[<span class="stringliteral">&#39;-action&#39;</span>]);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                <span class="keywordflow">if</span> ( strpos($query[<span class="stringliteral">&#39;-action&#39;</span>], <span class="stringliteral">&#39;custom_&#39;</span>) === 0 ){</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                        $action = array(</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                                <span class="stringliteral">&#39;name&#39;</span> =&gt; $query[<span class="stringliteral">&#39;-action&#39;</span>],</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                                <span class="stringliteral">&#39;page&#39;</span> =&gt; substr($query[<span class="stringliteral">&#39;-action&#39;</span>], 7),</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                                <span class="stringliteral">&#39;permission&#39;</span> =&gt; <span class="stringliteral">&#39;view&#39;</span>,</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                                <span class="stringliteral">&#39;mode&#39;</span> =&gt; <span class="stringliteral">&#39;browse&#39;</span>,</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                                <span class="stringliteral">&#39;custom&#39;</span> =&gt; <span class="keyword">true</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                                );</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                        $action = $actionTool-&gt;getAction($params);</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                        <span class="keywordflow">if</span> ( is_array($action)  and @$action[<span class="stringliteral">&#39;related&#39;</span>] and @$query[<span class="stringliteral">&#39;-relationship&#39;</span>] and preg_match(<span class="stringliteral">&#39;/relationships\.ini/&#39;</span>, @$action[<span class="stringliteral">&#39;allow_override&#39;</span>]) ){</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                                <span class="comment">// This action is to be performed on the currently selected relationship.</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                                $raction = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getRelationshipsAsActions(array(), $query[<span class="stringliteral">&#39;-relationship&#39;</span>]);</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                                <span class="keywordflow">if</span> ( is_array($raction) ){</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                                        $action = array_merge($action,$raction); </div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                                }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                        }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                        <span class="keywordflow">if</span> ( is_array($action) and isset($action[<span class="stringliteral">&#39;delegate&#39;</span>]) ){</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                                $params[<span class="stringliteral">&#39;name&#39;</span>] = $query[<span class="stringliteral">&#39;-action&#39;</span>] = $action[<span class="stringliteral">&#39;delegate&#39;</span>];</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                                $tmp = $actionTool-&gt;getActions($params);</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                                unset($action);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                                $action =&amp; $tmp;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                unset($tmp);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                        } </div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                        <span class="keywordflow">if</span> ( is_array($action) and isset($action[<span class="stringliteral">&#39;auth_type&#39;</span>]) ){</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                                $authTool = $this-&gt;<a class="code" href="class_dataface___application.html#aec35ba475a29ee3e79e20029e4862c28" title="Obtains reference to the authentication tool.">getAuthenticationTool</a>();</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                                $authTool-&gt;setAuthType($action[<span class="stringliteral">&#39;auth_type&#39;</span>]);</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                        }</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                        </div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                }</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        </div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                <span class="keywordflow">if</span> ( (<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($action) or !@$action[<span class="stringliteral">&#39;permission&#39;</span>]) and $this-&gt;_conf[<span class="stringliteral">&#39;security_level&#39;</span>] &gt;= <a class="code" href="_application_8php.html#a590b0ab1ed8ac1e554b1a461e225a464">DATAFACE_STRICT_PERMISSIONS</a> ){</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                        </div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                        <span class="comment">// The only reason getAction() will return an error is if the specified action could not be found.</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                        <span class="comment">// If the application is set to use strict permissions and no action was defined in the ini file</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                        <span class="comment">// then this action cannot be performed.  Strict permissions mode requires that permissions be </span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                        <span class="comment">// strictly set or permission will be denied.</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#af326456319a1a38b3ae0c9a1942e1458">Dataface_Error::permissionDenied</a>(</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                                <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                                        <span class="comment">/*i18n id*/</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                                        <span class="stringliteral">&quot;Permission Denied. No action found in strict permissions mode&quot;</span>,</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                                        <span class="comment">/* default error message */</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                                        <span class="stringliteral">&quot;Permission denied for action &#39;&quot;</span>.</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                                                $query[<span class="stringliteral">&#39;-action&#39;</span>].</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                                        <span class="stringliteral">&quot;&#39;.  No entry for this action was found in the actions.ini file.  </span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="stringliteral">                                        You are currently using strict permissions mode which requires that you define all actions that you want to use in the actions.ini file with appropriate permissions information.&quot;</span>, </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                                        <span class="comment">/* i18n parameters */</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                                        array(<span class="stringliteral">&#39;action&#39;</span>=&gt;$query[<span class="stringliteral">&#39;-action&#39;</span>])</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                                )</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                        );</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                        </div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                } </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                </div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($action) ){</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                        $action = array(<span class="stringliteral">&#39;name&#39;</span>=&gt;$query[<span class="stringliteral">&#39;-action&#39;</span>], <span class="stringliteral">&#39;label&#39;</span>=&gt;$query[<span class="stringliteral">&#39;-action&#39;</span>]);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                }</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                </div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                <span class="comment">// Step 1:  See if the delegate class has a handler.</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                </div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                $delegate = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getDelegate();</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                $handled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                <span class="keywordflow">if</span> ( method_exists($delegate,<span class="stringliteral">&#39;handleRequest&#39;</span>) ){</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                        <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $delegate-&gt;handleRequest();</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) and <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;getCode() === <a class="code" href="_error_8php.html#a92b5fd61ad09b3f80ab10d9a3f6d511c">DATAFACE_E_REQUEST_NOT_HANDLED</a> ){</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                                $handled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                $handled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                        }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                }</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                <span class="keywordflow">if</span> ( isset($action[<span class="stringliteral">&#39;mode&#39;</span>]) and $action[<span class="stringliteral">&#39;mode&#39;</span>] ) $query[<span class="stringliteral">&#39;-mode&#39;</span>] = $action[<span class="stringliteral">&#39;mode&#39;</span>];</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                </div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                <span class="comment">// Step 2: Look to see if there is a handler defined</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                <span class="keywordflow">if</span> ( isset($action[<span class="stringliteral">&#39;custom&#39;</span>]) ){</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                        $locations = array( DATAFACE_PATH.<span class="stringliteral">&#39;/actions/custom.php&#39;</span>=&gt;<span class="stringliteral">&#39;dataface_actions_custom&#39;</span>);</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                        $locations = array();</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                        </div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                        $locations[ <a class="code" href="class_dataface___table.html#adc197cb28172c1a23bb0e603250ceb90">Dataface_Table::getBasePath</a>($query[<span class="stringliteral">&#39;-table&#39;</span>]).<span class="stringliteral">&#39;/tables/&#39;</span>.basename($query[<span class="stringliteral">&#39;-table&#39;</span>]).<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;tables_&#39;</span>.$query[<span class="stringliteral">&#39;-table&#39;</span>].<span class="stringliteral">&#39;_actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                        $locations[ DATAFACE_SITE_PATH.<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                        </div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) and count($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) &gt; 0 ){</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                                $mt = <a class="code" href="class_dataface___module_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ModuleTool::getInstance</a>();</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                                <span class="keywordflow">foreach</span> ($this-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>] as $modname=&gt;$modpath){</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                                        $mt-&gt;loadModule($modname);</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                                        <span class="keywordflow">if</span> ( $modpath{0} == <span class="charliteral">&#39;/&#39;</span> )</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                                $locations[ dirname($modpath).<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                                        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                                                $locations[ DATAFACE_SITE_PATH.<span class="charliteral">&#39;/&#39;</span>.dirname($modpath).<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                                                $locations[ DATAFACE_PATH.<span class="charliteral">&#39;/&#39;</span>.dirname($modpath).<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                                        }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                                }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                        }</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                        </div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                        $locations[ DATAFACE_PATH.<span class="stringliteral">&#39;/actions/&#39;</span>.basename($query[<span class="stringliteral">&#39;-action&#39;</span>]).<span class="stringliteral">&#39;.php&#39;</span> ] = <span class="stringliteral">&#39;dataface_actions_&#39;</span>.$query[<span class="stringliteral">&#39;-action&#39;</span>];</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                        $locations[ DATAFACE_PATH.<span class="stringliteral">&#39;/actions/default.php&#39;</span> ] = <span class="stringliteral">&#39;dataface_actions_default&#39;</span>;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                                </div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                }</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                $doParams = array(<span class="stringliteral">&#39;action&#39;</span>=&gt;&amp;$action);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                        <span class="comment">//parameters to be passed to the do method of the handler</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                        </div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                </div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                <span class="keywordflow">foreach</span> ($locations as $handlerPath=&gt;$handlerClassName){</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                        <span class="keywordflow">if</span> ( is_readable($handlerPath) ){</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                                <span class="keyword">import</span>($handlerPath);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                                $handler = <span class="keyword">new</span> $handlerClassName;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                                $params  = array();</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                                <span class="keywordflow">if</span> ( is_array($action) and @$action[<span class="stringliteral">&#39;related&#39;</span>] and @$query[<span class="stringliteral">&#39;-relationship&#39;</span>] ){</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                                        $params[<span class="stringliteral">&#39;relationship&#39;</span>] = $query[<span class="stringliteral">&#39;-relationship&#39;</span>];</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                                }</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                                <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($action) and method_exists($handler, <span class="stringliteral">&#39;getPermissions&#39;</span>) ){</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                                        <span class="comment">// check the permissions on this action to make sure that we are &#39;allowed&#39; to perform it</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                                        <span class="comment">// this method will return an array of Strings that are names of permissions granted to</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                                        <span class="comment">// the current user.</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                                        </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                                        </div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                        <span class="comment">//echo &quot;Checking permissions:&quot;;</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                                        <span class="comment">//print_r($params);</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                                        $permissions = $handler-&gt;getPermissions($params);</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                                <span class="comment">//} else if ( $applicationDelegate !== null and method_exists($applicationDelegate, &#39;getPermissions&#39;) ){</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                                <span class="comment">//      $permissions =&amp; $applicationDelegate-&gt;getPermissions($params);</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                                        </div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                        </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                                </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                                        <span class="comment">//print_r($params);</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                                        <span class="comment">//print_r($action);</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                                        $permissions = $this-&gt;<a class="code" href="class_dataface___application.html#a2c2976d90b444715ac971add03b2d528" title="Returns the permissions that are currently available to the user in the current context. If we are in browse mode then permissions are checked against the current record. Otherwise, permissions are checked against the table.">getPermissions</a>($params);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                                }</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                                </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                                <span class="keywordflow">if</span> ( isset($action[<span class="stringliteral">&#39;permission&#39;</span>]) &amp;&amp; !(isset($permissions[$action[<span class="stringliteral">&#39;permission&#39;</span>]]) and $permissions[$action[<span class="stringliteral">&#39;permission&#39;</span>]]) ){</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                                </div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                                    <span class="keywordflow">if</span> ( !$permissions ){</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#af326456319a1a38b3ae0c9a1942e1458">Dataface_Error::permissionDenied</a>(df_translate(</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                                            <span class="stringliteral">&quot;Permission Denied for action no permissions&quot;</span>,</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                                            <span class="stringliteral">&quot;Permission to perform action &#39;&quot;</span>.$action[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;&#39; denied. &quot;</span>.</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                                            <span class="stringliteral">&quot;Requires permission &quot;</span>.$action[<span class="stringliteral">&#39;permission&#39;</span>].<span class="stringliteral">&quot; but you currently &quot;</span>.</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                                            <span class="stringliteral">&quot; have no permissions granted.&quot;</span>,</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                                            array(<span class="stringliteral">&#39;action&#39;</span> =&gt; $action)</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                                        ));</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                                    </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#af326456319a1a38b3ae0c9a1942e1458">Dataface_Error::permissionDenied</a>(</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                                                    <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                                                            <span class="stringliteral">&quot;Permission Denied for action.&quot;</span>, <span class="comment">/*i18n id*/</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                                                            <span class="comment">/* Default error message */</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                                                            <span class="stringliteral">&quot;Permission to perform action &#39;&quot;</span>.</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                                                            $action[<span class="stringliteral">&#39;name&#39;</span>].</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                                                            <span class="stringliteral">&quot;&#39; denied.  </span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="stringliteral">                                                            Requires permission &#39;&quot;</span>.</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                                                            $action[<span class="stringliteral">&#39;permission&#39;</span>].</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                                                            <span class="stringliteral">&quot;&#39; but only granted &#39;&quot;</span>.</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                                                            <a class="code" href="class_dataface___permissions_tool.html#aec9754a5cfb0982cda8aad30320cae82">Dataface_PermissionsTool::namesAsString</a>($permissions).<span class="stringliteral">&quot;&#39;.&quot;</span>, </div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                                                            <span class="comment">/* i18n parameters */</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                                                            array(<span class="stringliteral">&#39;action&#39;</span>=&gt;$action, <span class="stringliteral">&#39;permissions_granted&#39;</span>=&gt;<a class="code" href="class_dataface___permissions_tool.html#aec9754a5cfb0982cda8aad30320cae82">Dataface_PermissionsTool::namesAsString</a>($permissions))</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                                    )</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                                            );</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                                    }</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                                </div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                                }</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                                </div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                                <span class="keywordflow">if</span> ( method_exists($handler, <span class="stringliteral">&#39;handle&#39;</span>) ){</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                        </div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                                        </div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                                        <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $handler-&gt;handle($doParams);</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) and <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;getCode() === <a class="code" href="_error_8php.html#a92b5fd61ad09b3f80ab10d9a3f6d511c">DATAFACE_E_REQUEST_NOT_HANDLED</a> ){</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                                        }</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                                        <span class="keywordflow">return</span> <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                }</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                                </div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                                </div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                        }</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                        </div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                }</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                </div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(df_translate(<span class="stringliteral">&#39;scripts.Dataface.Application.handleRequest.NO_HANDLER_FOUND&#39;</span>,<span class="stringliteral">&quot;No handler found for request.  This should never happen because, at the very least, the default handler at dataface/actions/default.php should be called.  Check the permissions on dataface/actions/default.php to make sure that it is readable by the web server.&quot;</span>), E_USER_ERROR);</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                </div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                </div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                </div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        </div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        }</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;         </div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;         </div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;         </div>
<div class="line"><a name="l02398"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a0c8810fac7c1f7768d4f8272ce811d16"> 2398</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a0c8810fac7c1f7768d4f8272ce811d16" title="Displays the Dataface application.">display</a>($main_content_only=<span class="keyword">false</span>, $disableCache=<span class="keyword">false</span>){</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                <span class="comment">// ---------------- Set the Default Character set for output -----------</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;_tables as $key=&gt;$value){</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                        $this-&gt;_tables[$key] = $this-&gt;_conf[<span class="stringliteral">&#39;_tables&#39;</span>][$key] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$key.<span class="stringliteral">&#39;.label&#39;</span>, $value);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                }</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                </div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                $this-&gt;main_content_only = $main_content_only;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;autoSession or $this-&gt;<a class="code" href="class_dataface___application.html#aadf1a51637c0246767961b76e4b30fcc" title="Checks if sessions are enabled by default.">sessionEnabled</a>() ){</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                        $this-&gt;<a class="code" href="class_dataface___application.html#a3e3d63db4cce7a150e81ab2e8573f450" title="Starts a session if one does not already exist. If you are writing code that needs to use session dat...">startSession</a>();</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;disable_session_ip_check&#39;</span>]) and !@$this-&gt;_conf[<span class="stringliteral">&#39;disable_session_ip_check&#39;</span>] ){</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                        <span class="keywordflow">if</span> ( !@$_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>] ){</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                                $_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>] = df_IPv4To6(<a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]);</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                        }</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                        $ipAddressError = null;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                        <span class="keywordflow">if</span> ( df_IPv4To6($_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>]) != df_IPv4To6(<a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]) ){</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                                $msg = sprintf(</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                                        <span class="stringliteral">&quot;Session address does not match the remote address.  Possible hacking attempt.  Session address was &#39;%s&#39;, User address was &#39;%s&#39;&quot;</span>,</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                                        df_escape(df_IPv4To6($_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>])),</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                                        df_escape(df_IPv4To6(<a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]))</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                                );</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                                error_log($msg);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                                <span class="comment">//die(&#39;Your IP address doesn\&#39;t match the session address.  To continue, please clear your cookies or restart your browser and try again.&#39;);</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                                session_destroy();</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                                $this-&gt;<a class="code" href="class_dataface___application.html#a3e3d63db4cce7a150e81ab2e8573f450" title="Starts a session if one does not already exist. If you are writing code that needs to use session dat...">startSession</a>();</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                                <span class="keywordflow">if</span> ( !@$_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>] ){</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                                        $_SESSION[<span class="stringliteral">&#39;XATAFACE_REMOTE_ADDR&#39;</span>] = df_IPv4To6(<a class="code" href="config_8inc_8php.html#a3e51bc0f23b73e34a83a182f22a6b2d2">$_SERVER</a>[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>]);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                                }</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                                </div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                        }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                }</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                <span class="comment">// handle authentication</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <span class="keywordflow">if</span> ( !(defined(<span class="stringliteral">&#39;XATAFACE_DISABLE_AUTH&#39;</span>) and XATAFACE_DISABLE_AUTH) and isset($this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>]) ){</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                        <span class="comment">// The config file _auth section is there so we will be using authentication.</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        </div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                        $loginPrompt = <span class="keyword">false</span>;   <span class="comment">// flag to indicate if we should show the login prompt</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                        $permissionDenied = <span class="keyword">false</span>;<span class="comment">// flag to indicate if we should show permission denied</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                        $permissionError = <span class="stringliteral">&#39;&#39;</span>; <span class="comment">//Placeholder for permissions error messages</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                        $loginError = <span class="stringliteral">&#39;&#39;</span>; <span class="comment">// Placeholder for login error messages.</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                        </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                        $authTool = $this-&gt;<a class="code" href="class_dataface___application.html#aec35ba475a29ee3e79e20029e4862c28" title="Obtains reference to the authentication tool.">getAuthenticationTool</a>();</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                        </div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                        $auth_result = $authTool-&gt;authenticate();</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                        </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($auth_result) and $auth_result-&gt;getCode() == <a class="code" href="_error_8php.html#a156bd127a4e350f4ec392cd4566ceed2">DATAFACE_E_LOGIN_FAILURE</a> ){</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                                <span class="comment">// There was a login failure, show the login prompt</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                                $loginPrompt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                                $loginError = $auth_result-&gt;getMessage();</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $authTool-&gt;isLoggedIn() ){</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                                <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>()-&gt;loadUserConfig();</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                                <span class="comment">// The user is logged in ok</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                                <span class="comment">// Handle the request</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                                <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $this-&gt;<a class="code" href="class_dataface___application.html#a2fdc861bcfe01ddc11cea1316406ebc6" title="Handle a request. This method is the starting point for all Dataface application requests. It will delegate the request to the appropriate handler. The order of delegation is as follows:Uses the ActionTool to check permissions for the action. If permissions are not granted, dispatch the error handler. If permissions are granted then we continue down the delegation chain.If the current table&#39;s delegate class defines a handleRequest() method, then call that.If the current table&#39;s delegate class does not have a handleRequest() method or that method returns a PEAR_Error object with code E_DATAFACE_REQUEST_NOT_HANDLED, then check for a handler bearing the name of the action in one of the actions directories. Check the directories in the following order: a. &lt;site url&gt;=&quot;&quot;&gt;/tables/.">handleRequest</a>();</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___error.html#a8aaa28f87f51fca6bd0ab83ac450b953">Dataface_Error::isPermissionDenied</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                                        <span class="comment">// Permission was denied on the request.  Since the user is already</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                                        <span class="comment">// logged in, there is no use giving him the login prompt.  Just give</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                                        <span class="comment">// him the permission denied screen.</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                        $permissionDenied = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                                        $permissionError = <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;getMessage();</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                                }</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>][<span class="stringliteral">&#39;require_login&#39;</span>]) and $this-&gt;_conf[<span class="stringliteral">&#39;_auth&#39;</span>][<span class="stringliteral">&#39;require_login&#39;</span>] ){</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                                <span class="comment">// The user is not logged in and login is required for this application</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                                <span class="comment">// Show the login prompt</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                                $loginPrompt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                                <span class="comment">// The user is not logged in, but login is not required for this application.</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                                <span class="comment">// Allow the user to perform the action.</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                                <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $this-&gt;<a class="code" href="class_dataface___application.html#a2fdc861bcfe01ddc11cea1316406ebc6" title="Handle a request. This method is the starting point for all Dataface application requests. It will delegate the request to the appropriate handler. The order of delegation is as follows:Uses the ActionTool to check permissions for the action. If permissions are not granted, dispatch the error handler. If permissions are granted then we continue down the delegation chain.If the current table&#39;s delegate class defines a handleRequest() method, then call that.If the current table&#39;s delegate class does not have a handleRequest() method or that method returns a PEAR_Error object with code E_DATAFACE_REQUEST_NOT_HANDLED, then check for a handler bearing the name of the action in one of the actions directories. Check the directories in the following order: a. &lt;site url&gt;=&quot;&quot;&gt;/tables/.">handleRequest</a>($disableCache);</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___error.html#a8aaa28f87f51fca6bd0ab83ac450b953">Dataface_Error::isPermissionDenied</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                                        <span class="comment">// The user did not have permission to perform the action</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                                        <span class="comment">// Give the user a login prompt.</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                                        </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                                        $loginPrompt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                                }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                                </div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                        }</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                        <span class="keywordflow">if</span> ( $loginPrompt ){</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                                <span class="comment">// The user is supposed to see a login prompt to log in.</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                                <span class="comment">// Show the login prompt.</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                                </div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                                $authTool-&gt;showLoginPrompt($loginError);</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($permissionDenied) {</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                                <span class="comment">// The user is supposed to see the permissionm denied page.</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                                </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                                <span class="keywordflow">if</span> ( $query[<span class="stringliteral">&#39;--original_action&#39;</span>] == <span class="stringliteral">&#39;browse&#39;</span> and $query[<span class="stringliteral">&#39;-action&#39;</span>] != <span class="stringliteral">&#39;view&#39;</span> ){</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                                        $this-&gt;<a class="code" href="class_dataface___application.html#acea4248a073af4582d5069babd4656b2" title="Redirects the browser to a particular URL. Using this method rather than using a Location HTTP header...">redirect</a>($this-&gt;<a class="code" href="class_dataface___application.html#afc87537387661228c8eeac6643c5d1c1" title="Builds a link to somewhere in the application. This will maintain the existing query information...">url</a>(<span class="stringliteral">&#39;-action=view&#39;</span>));</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                                }</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                                $this-&gt;<a class="code" href="class_dataface___application.html#af94b7f8d7868cb953ec7facb7bbb5597" title="Adds an error to be displayed in the UI in the messages block.">addError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                                header(<span class="stringliteral">&quot;HTTP/1.1 403 Permission Denied&quot;</span>);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                                df_display(array(), <span class="stringliteral">&#39;Dataface_Permission_Denied.html&#39;</span>);</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                                <span class="comment">// Some other error occurred in handling the request.  Just show an</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                                <span class="comment">// ugly stack trace.</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                                </div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;toString().$result-&gt;getDebugInfo(), E_USER_ERROR);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                        }</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                        <span class="comment">// Authentication is not enabled for this application.</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                        <span class="comment">// Just process the request.</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                        </div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                        <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $this-&gt;<a class="code" href="class_dataface___application.html#a2fdc861bcfe01ddc11cea1316406ebc6" title="Handle a request. This method is the starting point for all Dataface application requests. It will delegate the request to the appropriate handler. The order of delegation is as follows:Uses the ActionTool to check permissions for the action. If permissions are not granted, dispatch the error handler. If permissions are granted then we continue down the delegation chain.If the current table&#39;s delegate class defines a handleRequest() method, then call that.If the current table&#39;s delegate class does not have a handleRequest() method or that method returns a PEAR_Error object with code E_DATAFACE_REQUEST_NOT_HANDLED, then check for a handler bearing the name of the action in one of the actions directories. Check the directories in the following order: a. &lt;site url&gt;=&quot;&quot;&gt;/tables/.">handleRequest</a>($disableCache);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___error.html#a8aaa28f87f51fca6bd0ab83ac450b953">Dataface_Error::isPermissionDenied</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                                </div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                                <span class="keywordflow">if</span> ( $query[<span class="stringliteral">&#39;--original_action&#39;</span>] == <span class="stringliteral">&#39;browse&#39;</span> and $query[<span class="stringliteral">&#39;-action&#39;</span>] != <span class="stringliteral">&#39;view&#39;</span> ){</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                                        $this-&gt;<a class="code" href="class_dataface___application.html#acea4248a073af4582d5069babd4656b2" title="Redirects the browser to a particular URL. Using this method rather than using a Location HTTP header...">redirect</a>($this-&gt;<a class="code" href="class_dataface___application.html#afc87537387661228c8eeac6643c5d1c1" title="Builds a link to somewhere in the application. This will maintain the existing query information...">url</a>(<span class="stringliteral">&#39;-action=view&#39;</span>));</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                                }</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                                $this-&gt;<a class="code" href="class_dataface___application.html#af94b7f8d7868cb953ec7facb7bbb5597" title="Adds an error to be displayed in the UI in the messages block.">addError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                                header(<span class="stringliteral">&quot;HTTP/1.1 403 Permission Denied&quot;</span>);</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                                df_display(array(), <span class="stringliteral">&#39;Dataface_Permission_Denied.html&#39;</span>);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) ){</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                                </div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;toString().$result-&gt;getDebugInfo(), E_USER_ERROR);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                        }</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                }</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        </div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;        }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        </div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        <span class="keyword">function</span> _handleGetBlob($request){</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/Application/blob.php&#39;</span>);</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface___application__blob.html#a58c7d02a755c4cf9112f0a3c31e192ef">Dataface_Application_blob::_handleGetBlob</a>($request);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        }</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        </div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;         </div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="comment">// END Request Handling</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="comment">//======================================================================================</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        </div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        </div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a281c5e6a3c67680411f607fe90034647"> 2547</a></span>&#160;<span class="comment"></span>        var <a class="code" href="class_dataface___application.html#a281c5e6a3c67680411f607fe90034647">$_parseStringContext</a>=array();</div>
<div class="line"><a name="l02615"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2b1206b3591e1ecd8c5ea04c9fa18ea7"> 2615</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2b1206b3591e1ecd8c5ea04c9fa18ea7" title="Evaluates a string expression replacing PHP variables with appropriate values in the current record...">parseString</a>($expression, $context=null){</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                <span class="comment">// make sure that the expression doesn&#39;t try to break the double quotes.</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                <span class="keywordflow">if</span> ( strpos($expression, <span class="charliteral">&#39;&quot;&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                                df_translate(</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                                        <span class="stringliteral">&#39;scripts.Dataface.Application.parseString.ERROR_PARSING_EXPRESSION_DBL_QUOTE&#39;</span>,</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                                        <span class="stringliteral">&quot;Invalid expression (possible hacking attempt in Dataface_Application::eval().  Expression cannot include double quotes &#39;\&quot;&#39;, but recieved &#39;&quot;</span>.$expression.<span class="stringliteral">&quot;&#39;.&quot;</span>,</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                                        array(<span class="stringliteral">&#39;expression&#39;</span>=&gt;$expression))</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                                        , E_USER_ERROR);</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                }</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160; </div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                $site_url = DATAFACE_SITE_URL;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                $site_href = DATAFACE_SITE_HREF;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                $dataface_url = DATAFACE_URL;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = $this-&gt;_currentTable;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                $tableObj = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>);</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($tableObj) ){</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($tableObj-&gt;getMessage(), $tableObj-&gt;getCode());</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                }</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a> = $this;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                $resultSet = <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;getResultSet();</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                <span class="keywordflow">if</span> ( isset($context[<span class="stringliteral">&#39;record&#39;</span>]) ){</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                        $record = $context[<span class="stringliteral">&#39;record&#39;</span>];</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                        $record = <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;getRecord();</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                }</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                <span class="keywordflow">if</span> ( isset($context[<span class="stringliteral">&#39;relationship&#39;</span>]) ){</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                        <span class="comment">//$tableObj = Dataface_Table::loadTable($table);</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                        </div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                        <span class="keywordflow">if</span> ( is_string($context[<span class="stringliteral">&#39;relationship&#39;</span>]) ){</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                                $relationship = $tableObj-&gt;getRelationship($context[<span class="stringliteral">&#39;relationship&#39;</span>]);</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                                <span class="keywordflow">if</span> ( !($relationship instanceof <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a>) ){</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                                        $relationship = null;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                                }</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $context[<span class="stringliteral">&#39;relationship&#39;</span>] instanceof <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a> ){</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                                $relationship = $context[<span class="stringliteral">&#39;relationship&#39;</span>];</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                        }</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                        <span class="comment">//unset($tableObj);</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                }</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                <span class="keywordflow">if</span> ( !@<a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>] ){</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                        @eval(<span class="stringliteral">&#39;$parsed = &quot;&#39;</span>.$expression.<span class="stringliteral">&#39;&quot;;&#39;</span>);</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                        eval(<span class="stringliteral">&#39;$parsed = &quot;&#39;</span>.$expression.<span class="stringliteral">&#39;&quot;;&#39;</span>);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                </div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                <span class="keywordflow">if</span> ( !isset( $parsed ) ){</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(df_translate(<span class="stringliteral">&#39;scripts.Dataface.Application.parseString.ERROR_PARSING_EXPRESSION&#39;</span>,<span class="stringliteral">&quot;Error parsing expression &#39;$expression&#39;. &quot;</span>, array(<span class="stringliteral">&#39;expression&#39;</span>=&gt;$expression)), E_USER_ERROR);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                }</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                <span class="keywordflow">return</span> $parsed;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        </div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;        }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        </div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        </div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keyword">function</span> _parsePregMatch($matches){</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                extract($this-&gt;_parseStringContext);</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                <span class="keywordflow">if</span> ( !@$this-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>] ){</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                        <span class="keywordflow">return</span> @eval(<span class="stringliteral">&#39;return &#39;</span>.$matches[1].$matches[2].<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                        <span class="keywordflow">return</span> eval(<span class="stringliteral">&#39;return &#39;</span>.$matches[1].$matches[2].<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                }</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        }</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        </div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        </div>
<div class="line"><a name="l02751"></a><span class="lineno"><a class="code" href="class_dataface___application.html#abaebf93def71db48c0ac97c0484dcfbb"> 2751</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#abaebf93def71db48c0ac97c0484dcfbb" title="Tests an expression for a boolean result. This is primarly used by the condition directive of actions...">testCondition</a>($condition, $context=null){</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                $site_url = DATAFACE_SITE_URL;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                $site_href = DATAFACE_SITE_HREF;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                $dataface_url = DATAFACE_URL;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = $this-&gt;_currentTable;</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                $tableObj = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($tableObj) ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($tableObj-&gt;getMessage(), $tableObj-&gt;getCode());</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a> = $this;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                $resultSet = <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;getResultSet();</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                <span class="keywordflow">if</span> ( isset($context[<span class="stringliteral">&#39;record&#39;</span>]) ) $record = $context[<span class="stringliteral">&#39;record&#39;</span>];</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                <span class="keywordflow">else</span> $record = <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;getRecord();</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                </div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                <span class="keywordflow">if</span> ( isset($context[<span class="stringliteral">&#39;relationship&#39;</span>]) ){</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                        <span class="comment">//$tableObj =&amp; Dataface_Table::loadTable($table);</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                        <span class="keywordflow">if</span> ( is_string($context[<span class="stringliteral">&#39;relationship&#39;</span>])  ){</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                                $relationship = $tableObj-&gt;getRelationship($context[<span class="stringliteral">&#39;relationship&#39;</span>]);</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                                <span class="keywordflow">if</span> ( !($relationship instanceof <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a>) ){</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                                        $relationship = null;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                                }</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $context[<span class="stringliteral">&#39;relationship&#39;</span>] instanceof <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a> ){</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                                $relationship = $context[<span class="stringliteral">&#39;relationship&#39;</span>];</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                        }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                        <span class="comment">//unset($tableObj);</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                }</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                <span class="keywordflow">if</span> ( !@$this-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>] ){</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                        <span class="keywordflow">return</span> @eval(<span class="stringliteral">&#39;return (&#39;</span>.$condition.<span class="stringliteral">&#39;);&#39;</span>);</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                        error_log($condition);</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                        <span class="keywordflow">return</span> eval(<span class="stringliteral">&#39;return (&#39;</span>.$condition.<span class="stringliteral">&#39;);&#39;</span>);</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                }</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        }</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        </div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        </div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        </div>
<div class="line"><a name="l02813"></a><span class="lineno"><a class="code" href="class_dataface___application.html#afc87537387661228c8eeac6643c5d1c1"> 2813</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#afc87537387661228c8eeac6643c5d1c1" title="Builds a link to somewhere in the application. This will maintain the existing query information...">url</a>($query, $useContext=<span class="keyword">true</span>, $forceContext=<span class="keyword">false</span>){</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/LinkTool.php&#39;</span>);</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                <span class="keywordflow">return</span> Dataface_LinkTool::buildLInk($query, $useContext, $forceContext);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;        </div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        }</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;        </div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        </div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                </div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        </div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        </div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        </div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        </div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        </div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;        </div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;        </div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        </div>
<div class="line"><a name="l02857"></a><span class="lineno"><a class="code" href="class_dataface___application.html#acb99ebe715397311e1916222fd4615bc"> 2857</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#acb99ebe715397311e1916222fd4615bc" title="Registers a filter that acts on URLs that are build with link builder. This allows modules to affect ...">registerUrlFilter</a>( $filter ){</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                $this-&gt;_url_filters[] = $filter;</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        }</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        </div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        </div>
<div class="line"><a name="l02871"></a><span class="lineno"><a class="code" href="class_dataface___application.html#ade274dfbb6f755bf941b95cb875d5b28"> 2871</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#ade274dfbb6f755bf941b95cb875d5b28" title="Filters a URL to add the current table and apply any filters that have been registered using register...">filterUrl</a>($url){</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                <span class="keywordflow">if</span> ( !preg_match( <span class="stringliteral">&#39;/[&amp;\?]-table/i&#39;</span>, $url ) ){</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                        <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/\?/i&#39;</span>, $url ) ){</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                                $url .= <span class="stringliteral">&#39;&amp;-table=&#39;</span>.$this-&gt;_currentTable;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                                $url .= <span class="stringliteral">&#39;?-table=&#39;</span>.$this-&gt;_currentTable;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                        }</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                }</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;_url_filters as $filter){</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                        $url = call_user_func($filter, $url);</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                }</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                <span class="keywordflow">return</span> $url;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        </div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        }</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        </div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        </div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        </div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        <span class="keyword">function</span> init(){</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        </div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;        }</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        </div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        </div>
<div class="line"><a name="l02909"></a><span class="lineno"><a class="code" href="class_dataface___application.html#acea4248a073af4582d5069babd4656b2"> 2909</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#acea4248a073af4582d5069babd4656b2" title="Redirects the browser to a particular URL. Using this method rather than using a Location HTTP header...">redirect</a>($url){</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;redirectHandler) and method_exists(<span class="stringliteral">&#39;redirect&#39;</span>, $this-&gt;redirectHandler) ){</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                        $this-&gt;redirectHandler-&gt;redirect($url);</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_dataface___application___redirect_exception.html" title="An exception class that is raised when the application is requesting to redirect to a different URL...">Dataface_Application_RedirectException</a>($url);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                }</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                header(<span class="stringliteral">&#39;Location: &#39;</span>.$url);</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                <a class="code" href="blob_8php.html#a6733eb5f605d09eaede9845835d71c4e">exit</a>;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                </div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        }</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        </div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <span class="comment">// End Utility Functions</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="comment">//=======================================================================================</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        </div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        </div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f"> 2942</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the delegate object for this application. The delegate object can be used to d...">getDelegate</a>(){</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;delegate === -1 ){</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                        $delegate_path = DATAFACE_SITE_PATH.<span class="stringliteral">&#39;/conf/ApplicationDelegate.php&#39;</span>;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                        <span class="keywordflow">if</span> ( is_readable($delegate_path) ){</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                                <span class="keyword">import</span>($delegate_path);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                                $this-&gt;delegate = <span class="keyword">new</span> conf_ApplicationDelegate();</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                                $this-&gt;delegate = null;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                        }</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;                }</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                <span class="keywordflow">return</span> $this-&gt;delegate;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                                </div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        }</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        </div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        </div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;         </div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;         </div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        <span class="comment">// END Delegate Class</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        <span class="comment">//========================================================================================</span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a2c2976d90b444715ac971add03b2d528"> 2990</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a2c2976d90b444715ac971add03b2d528" title="Returns the permissions that are currently available to the user in the current context. If we are in browse mode then permissions are checked against the current record. Otherwise, permissions are checked against the table.">getPermissions</a>($params=array()){</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;                $query =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#a845e55ed786a923e900d34cd2b2becbc" title="Returns a reference to the current query object. This is very similar to the $_GET and $_REQUEST glob...">getQuery</a>();</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;                $record = $this-&gt;<a class="code" href="class_dataface___application.html#af296b1b4fc05d00411862370131e4d34" title="Gets the current record based on the current query.">getRecord</a>();</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;                <span class="keywordflow">if</span> ( @$query[<span class="stringliteral">&#39;-relationship&#39;</span>] ){</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                        $params[<span class="stringliteral">&#39;relationship&#39;</span>] = $query[<span class="stringliteral">&#39;-relationship&#39;</span>];</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                }</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                <span class="keywordflow">if</span> ( $record and is_a($record, <span class="stringliteral">&#39;Dataface_Record&#39;</span>) ){</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                        <span class="comment">//$params = array();</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___permissions_tool.html#a39928040905a61920af75df95500d402">Dataface_PermissionsTool::getPermissions</a>($record, $params);</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                        <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = <a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">Dataface_Table::loadTable</a>($query[<span class="stringliteral">&#39;-table&#39;</span>]);</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                        <span class="comment">//$params = array();</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___permissions_tool.html#a39928040905a61920af75df95500d402">Dataface_PermissionsTool::getPermissions</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, $params);</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                }</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                </div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        }</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        </div>
<div class="line"><a name="l03020"></a><span class="lineno"><a class="code" href="class_dataface___application.html#ac41bbed64afef11340e440b17858ea8e"> 3020</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#ac41bbed64afef11340e440b17858ea8e" title="Checks if a permission is granted in the current context.">checkPermission</a>($perm){</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                $perms = $this-&gt;<a class="code" href="class_dataface___application.html#a2c2976d90b444715ac971add03b2d528" title="Returns the permissions that are currently available to the user in the current context. If we are in browse mode then permissions are checked against the current record. Otherwise, permissions are checked against the table.">getPermissions</a>();</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = (isset($perms[$perm]) and $perms[$perm]);</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="_quick_form__table__tests_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        }</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        </div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        </div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;         </div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;         </div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        <span class="comment">// END Permissions</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        <span class="comment">//=========================================================================================</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        </div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        </div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        </div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;         <span class="keyword">function</span> refreshSchemas(<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>){</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;metadata_enabled&#39;</span>] ){</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                        $metadataTool = <span class="keyword">new</span> <a class="code" href="class_dataface___metadata_tool.html">Dataface_MetadataTool</a>();</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                        $metadataTool-&gt;updateWorkflowTable(<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>);</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                }</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        }</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        </div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;        </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        </div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;        </div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;        </div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="keyword">function</span> _parseRelatedBlobRequest($request){</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/Application/blob.php&#39;</span>);</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface___application__blob.html#a24029f320715581b3e2a9bd0d2195f68">Dataface_Application_blob::_parseRelatedBlobRequest</a>($request);</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;        }</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        </div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;</div>
<div class="line"><a name="l03101"></a><span class="lineno"><a class="code" href="class_dataface___application.html#af6e2ad00719d1f7d6d289ccaac709aef"> 3101</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___application.html#af6e2ad00719d1f7d6d289ccaac709aef" title="PHP files located in the &#39;pages&#39; directory of the site are considered to be custom pages...">getCustomPages</a>(){</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_customPages ) ){</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                        $this-&gt;_customPages = array();</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                        <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = DATAFACE_SITE_PATH.<span class="stringliteral">&#39;/pages/&#39;</span>;</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                        <span class="keywordflow">if</span> ( is_dir(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) ){</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                                <span class="keywordflow">if</span> ( $dh = opendir(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) ){</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                                        <span class="keywordflow">while</span> ( ( $file = readdir($dh) ) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                                                <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/\.php$/&#39;</span>, $file) ){</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                                                        list($name) = explode(<span class="charliteral">&#39;.&#39;</span>, $file);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;                                                        <span class="comment">//$name = str_replace(&#39;_&#39;, &#39; &#39;, $name);</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                                                        </div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                                                        $this-&gt;_customPages[$name] = <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>.$file;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;                                                }</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;                                        }</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                                }</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                        }</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                }</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_customPages;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        }</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        </div>
<div class="line"><a name="l03128"></a><span class="lineno"><a class="code" href="class_dataface___application.html#acc005c16bd5c221603b30f0beefb5cfd"> 3128</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#acc005c16bd5c221603b30f0beefb5cfd" title="Obtains the full path (read for inclusion) of the custom page with name $name.">getCustomPagePath</a>($name){</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;                $pages =&amp; $this-&gt;<a class="code" href="class_dataface___application.html#af6e2ad00719d1f7d6d289ccaac709aef" title="PHP files located in the &#39;pages&#39; directory of the site are considered to be custom pages...">getCustomPages</a>();</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                <span class="keywordflow">return</span> $pages[$name];</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        }</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        </div>
<div class="line"><a name="l03141"></a><span class="lineno"><a class="code" href="class_dataface___application.html#a38f4f32222c4448c2568dc1fbc23f55e"> 3141</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___application.html#a38f4f32222c4448c2568dc1fbc23f55e" title="Obtains the label for a custom page. The label is the same as the name except with capitalization of ...">getCustomPageLabel</a>($name){</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                $name = str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>, $name);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                <span class="keywordflow">return</span> ucwords($name);</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        }</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        </div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        <span class="comment">// END Custom Pages</span></div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        <span class="comment">//=====================================================================================</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        </div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        <span class="keyword">function</span> addDebugInfo($info){</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;                $this-&gt;debugLog[] = $info;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        }</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        </div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        <span class="keyword">function</span> displayDebugInfo(){</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                echo <span class="stringliteral">&#39;&lt;ul class=&quot;debug-info&quot;&gt;&lt;li&gt;</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;<span class="stringliteral">                &#39;</span>; echo implode(<span class="stringliteral">&#39;&lt;/li&gt;&lt;li&gt;&#39;</span>, $this-&gt;debugLog);</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                echo <span class="stringliteral">&#39;&lt;/li&gt;&lt;/ul&gt;&#39;</span>;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        }</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        </div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        <span class="keyword">function</span> _cleanup(){</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;                <span class="keywordflow">if</span> ( session_id() != <span class="stringliteral">&quot;&quot;</span> ){</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                        $this-&gt;writeSessionData();</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                }</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;_conf[<span class="stringliteral">&#39;support_transactions&#39;</span>] ){</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;                        @mysql_query(<span class="stringliteral">&#39;COMMIT&#39;</span>, $this-&gt;_db);</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                }</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        }</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        </div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        </div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        </div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        </div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        </div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        </div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        </div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;}</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;</div>
<div class="line"><a name="l03199"></a><span class="lineno"><a class="code" href="class_dataface___application___redirect_exception.html"> 3199</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_dataface___application___redirect_exception.html" title="An exception class that is raised when the application is requesting to redirect to a different URL...">Dataface_Application_RedirectException</a> <span class="keyword">extends</span> Exception {</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        <span class="keyword">private</span> $url;</div>
<div class="line"><a name="l03201"></a><span class="lineno"><a class="code" href="class_dataface___application___redirect_exception.html#ae39d11dbd4aaf7b8557d98785ef51257"> 3201</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_dataface___application___redirect_exception.html#ae39d11dbd4aaf7b8557d98785ef51257">__construct</a>($url, $code = 0, Exception $previous = null ){</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;                $this-&gt;url = $url;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;                parent::__construct(<span class="stringliteral">&#39;Request to redirect to &#39;</span>.$url, $code, $previous);</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        }</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;        </div>
<div class="line"><a name="l03206"></a><span class="lineno"><a class="code" href="class_dataface___application___redirect_exception.html#a7fab9ce25511a132269e791a5308f7b7"> 3206</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_dataface___application___redirect_exception.html#a7fab9ce25511a132269e791a5308f7b7">getURL</a>(){</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;                <span class="keywordflow">return</span> $this-&gt;url;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        }</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;}</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 5 2014 09:52:17 for Xataface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
