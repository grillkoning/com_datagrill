<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Xataface: Dataface/Table.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xataface-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xataface
   &#160;<span id="projectnumber">2.0alpha2</span>
   </div>
   <div id="projectbrief">Xataface Application Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_271d545d1c280e09f46c9ec0c891c76f.html">Dataface</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Table.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_dataface_2table_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Xataface Web Application Framework</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2005-2008 Web Lite Solutions Corp (shannah@sfu.ca)</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * modify it under the terms of the GNU General Public License</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * as published by the Free Software Foundation; either version 2</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*******************************************************************************</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * File:        Table.php</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * Author:      Steve Hannah &lt;shannah@sfu.ca&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * Description:</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *      Encapsulates a table of a data driven data type.</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *      </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> ******************************************************************************/</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;DATAFACE_EXTENSION_LOADED_APC&#39;</span>) ){</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        define(<span class="stringliteral">&#39;DATAFACE_EXTENSION_LOADED_APC&#39;</span>,extension_loaded(<span class="stringliteral">&#39;apc&#39;</span>));</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;PEAR.php&#39;</span>);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/Error.php&#39;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/Globals.php&#39;</span>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/Relationship.php&#39;</span>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/converters/date.php&#39;</span>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/Application.php&#39;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//require_once dirname(__FILE__).&#39;/../config.inc.php&#39;;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;SQL/Parser.php&#39;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;SQL/Parser/wrapper.php&#39;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/Serializer.php&#39;</span>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a6ab9cb386da072acbeba87d35fe67bec">   50</a></span>&#160;define(<span class="stringliteral">&#39;Dataface_Table_UseCache&#39;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a942080a3d54a7f1167c7147909e24d78">   56</a></span>&#160;<a class="code" href="config_8inc_8php.html#ac2157b127a400fb158b4387fc317e356">$GLOBALS</a>[<span class="stringliteral">&#39;Dataface_Table_DefaultFieldPermissions&#39;</span>] = array(</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="stringliteral">&quot;view&quot;</span>=&gt;<span class="stringliteral">&#39;View&#39;</span>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="stringliteral">&quot;edit&quot;</span>=&gt;<span class="stringliteral">&#39;Edit&#39;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        );</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#af3c3bf7fd9414719547e950b925a7159">   61</a></span>&#160;<a class="code" href="config_8inc_8php.html#ac2157b127a400fb158b4387fc317e356">$GLOBALS</a>[<span class="stringliteral">&#39;Dataface_Table_DefaultTablePermissions&#39;</span>] = array(</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="stringliteral">&quot;view&quot;</span>=&gt;<span class="stringliteral">&quot;View&quot;</span>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="stringliteral">&quot;edit&quot;</span>=&gt;<span class="stringliteral">&quot;Edit&quot;</span>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="stringliteral">&quot;delete&quot;</span>=&gt;<span class="stringliteral">&quot;Delete&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        );</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a4aa814ed70e92b29b5828dee2e642aad">   67</a></span>&#160;define( <span class="stringliteral">&#39;SCHEMA_INVALID_ADDRESS_ERROR&#39;</span>, 1);</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">   68</a></span>&#160;define( <span class="stringliteral">&#39;SCHEMA_NO_SUCH_FIELD_ERROR&#39;</span>,2);</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a7bdbbc944ae795d6f9d991c424dc9bc6">   69</a></span>&#160;define( <span class="stringliteral">&#39;SCHEMA_AMBIGUOUS_FIELD_ERROR&#39;</span>,3);</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#ae3a231917617d63a8ccb457c0978f514">   70</a></span>&#160;define( <span class="stringliteral">&#39;Dataface_SCHEMA_NO_VALUE_ASSIGNED&#39;</span>, 4);</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a3968fd4931ca53848f90526e61083226">   71</a></span>&#160;define( <span class="stringliteral">&#39;Dataface_SCHEMA_INDEX_OUT_OF_BOUNDS_ERROR&#39;</span>, 5);</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a5c2249da121350bd5284f4f19b4c02f0">   72</a></span>&#160;define( <span class="stringliteral">&#39;Dataface_SCHEMA_SQL_ERROR&#39;</span>, 6);</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a8523478ff684643f32317450ac303f33">   73</a></span>&#160;define( <span class="stringliteral">&#39;Dataface_SCHEMA_NO_SUCH_RELATIONSHIP_ERROR&#39;</span>,7);</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#ad1ded9a00039c662a963319f664a1522">   74</a></span>&#160;define( <span class="stringliteral">&#39;Dataface_SCHEMA_INVALID_VALUE_ERROR&#39;</span>,8);</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a4e19ce4becbcf3f793405047ac9747f8">   75</a></span>&#160;define( <span class="stringliteral">&#39;DATAFACE_TABLE_SQL_PARSE_ERROR&#39;</span>, 9);</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a036a57e944639926b5ef7e19168ca5ca">   76</a></span>&#160;define( <span class="stringliteral">&#39;DATAFACE_TABLE_RELATED_RECORD_CREATION_ERROR&#39;</span>, 10);</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#aaae6b04c9e05f28844a48c1088990c0b">   77</a></span>&#160;define( <span class="stringliteral">&#39;DATAFACE_TABLE_RELATED_RECORD_REQUIRED_FIELD_MISSING_ERROR&#39;</span>,12);</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a81ef0b62940b6a2424b884040c3fc348">   78</a></span>&#160;define( <span class="stringliteral">&#39;DATAFACE_TABLE_RECORD_RELATED_RECORD_BLOCKSIZE&#39;</span>, 30);</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#af06ee381eb7a4adc809c4e8ee49b687b">   79</a></span>&#160;define( <span class="stringliteral">&#39;DATAFACE_TABLE_SQL_ERROR&#39;</span>,11);</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="code" href="_dataface_2table_8php.html#a0fc4b99550d24a307b1e7242be51daf3">   80</a></span>&#160;define( <span class="stringliteral">&#39;SCHEMA_TABLE_NOT_FOUND&#39;</span>, 12);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="code" href="class_dataface___table.html">  116</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_dataface___table.html" title="A class that represents the table of a table in a database.">Dataface_Table</a> {</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5">  122</a></span>&#160;        var <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319">  128</a></span>&#160;        var <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        var $_fields = array();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        var $_grafted_fields = null;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        var $_transient_fields = null;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        var $_parentTable = null;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        var $_cookedValuelists=array();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        var $_joinTables = null;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        var $_sql;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        var $_proxyViews = array();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        var $_fieldsByTab = null;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        var $_relatedFields = array();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        var $_fieldgroups = array();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        var $_tabs = array();</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        var $_keys = array();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        var $_iniFile = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        var $_atts;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        var $_relationships = array();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        var $_relationshipRanges;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        var $_defaultRelationshipRange = array(0, <a class="code" href="_dataface_2table_8php.html#a81ef0b62940b6a2424b884040c3fc348">DATAFACE_TABLE_RECORD_RELATED_RECORD_BLOCKSIZE</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        var $_valuelists;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        var $_delegate;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        var $status;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        var $_relationshipsLoaded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab24faf4aa647cdcee494fc48524ad4ff">  310</a></span>&#160;        var <a class="code" href="class_dataface___table.html#ab24faf4aa647cdcee494fc48524ad4ff" title="Store errors that occur in methods of this class.">$errors</a> = array();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        var $_permissions;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        var $_serializer;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        var $_filters = array();</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        var $_importFilters = null;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        var $_fieldsConfig;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        var $_relationshipsConfig;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        var $_valuelistsConfig;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        var $_actionsLoaded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        var $_actionsConfig = null;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// reference to application object</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span>        var $app = null;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        var $_permissionsLoaded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        var $translations = null;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        var $_cache = array();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        var $metadataColumns = null;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        var $_securityFilter = array();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        var $_securityFilterLoaded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        var $descriptionField;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        var $createdField;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        var $creatorField;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        var $lastUpdatedField;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        var $publicLinkTemplate;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        var $bodyField;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        </div>
<div class="line"><a name="l00446"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a3574c97289e10ce993358e8f2c1e2235">  446</a></span>&#160;        var <a class="code" href="class_dataface___table.html#a3574c97289e10ce993358e8f2c1e2235">$versionField</a> = -1;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        var $_global_field_properties;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f">  474</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#afcddcbfca2d29748c1c610e2323ea44f" title="Loads the table object for a database table.">loadTable</a>($name, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>=null, $getAll=<span class="keyword">false</span>, $quiet=<span class="keyword">false</span>){</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <span class="keywordflow">if</span> ( !is_string($name) ){</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;In Dataface_Table::loadTable() expected first argument to be a string but received &#39;&quot;</span>.get_class($name).<span class="stringliteral">&quot;&#39;&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a> === null ) <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a> = <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>()-&gt;db();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="keywordflow">if</span> ( !isset( $_tables ) ){</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        <span class="keyword">static</span> $_tables = array();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                        <span class="keyword">static</span> $_db = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">if</span> ( $getAll ){</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        <span class="keywordflow">return</span> $_tables;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a> ) $_db = <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">if</span> ( !isset( $_tables[$name] ) ){</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                        $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        $_tables[$name] = <span class="keyword">new</span> <a class="code" href="class_dataface___table.html" title="A class that represents the table of a table in a database.">Dataface_Table</a>($name, $_db, $quiet);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                        </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                        $_tables[$name]-&gt;postInit();</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                        $event = <span class="keyword">new</span> StdClass;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                        $event-&gt;table = $_tables[$name];</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        $app-&gt;fireEvent(<span class="stringliteral">&#39;afterTableInit&#39;</span>, $event);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                <span class="keywordflow">return</span> $_tables[$name];</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html" title="A class that represents the table of a table in a database.">Dataface_Table</a>(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>=null, $quiet=<span class="keyword">false</span>){</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keywordflow">if</span> ( !<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a> || !is_string(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>) ){</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid tablename specified: $tablename&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>,<span class="charliteral">&#39;`&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid character found in table &#39;$tablename&#39;.&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                        </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/Record.php&#39;</span>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                $this-&gt;app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="comment">// register this table name with the application object so we can keep</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="comment">// track of which tables are used on each request.  This helps with </span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <span class="comment">// caching.</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                $this-&gt;app-&gt;tableNamesUsed[] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                $this-&gt;tablename = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a> === null  ) <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a> = $this-&gt;app-&gt;db();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a> = <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                $this-&gt;_permissions = <a class="code" href="class_dataface___permissions_tool.html#a0f09438de04a139cb31716ae52bb6fce">Dataface_PermissionsTool::getRolePermissions</a>($this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;default_table_role&#39;</span>]);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                $this-&gt;tablename = str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $this-&gt;tablename);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        <span class="comment">// prevent malicious SQL injection</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                $this-&gt;_atts = array();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;name&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>] = (isset( $this-&gt;app-&gt;_tables[$this-&gt;tablename] ) ? $this-&gt;app-&gt;_tables[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>] : <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                $mod_times =&amp; self::getTableModificationTimes();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                $apc_key = DATAFACE_SITE_PATH.<span class="stringliteral">&#39;-Table.php-&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;-columns&#39;</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                $apc_key_fields = $apc_key.<span class="stringliteral">&#39;-fields&#39;</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                $apc_key_keys = $apc_key.<span class="stringliteral">&#39;-keys&#39;</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                $apc_key_mtime = $apc_key.<span class="stringliteral">&#39;__mtime&#39;</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordflow">if</span> ( DATAFACE_EXTENSION_LOADED_APC </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        and</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                ( !@$_GET[<span class="stringliteral">&#39;--refresh-apc&#39;</span>] )</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                        and </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                ( @$mod_times[$this-&gt;tablename] &lt; apc_fetch($apc_key_mtime) )</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                        and </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                ( $this-&gt;_fields = apc_fetch($apc_key_fields) )</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                        and</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                ( $this-&gt;_keys = apc_fetch($apc_key_keys) )</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                        ){</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                                <span class="comment">// no need to refresh the cache</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                $fieldnames = array_keys($this-&gt;_fields);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                        </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                } <span class="keywordflow">else</span> { </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                                </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                         </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;SHOW COLUMNS FROM `&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;`&quot;</span>, $this-&gt;db);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                <span class="keywordflow">if</span> ( $quiet ){</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                        <span class="keywordflow">return</span> <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<span class="stringliteral">&quot;Error performing mysql query to get column information from table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.  The mysql error returned was : &#39;&quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>));</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Error performing mysql query to get column information from table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.  The mysql error returned was : &#39;&quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>), E_USER_ERROR);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                        <span class="keywordflow">if</span> ( mysql_num_rows($res) &gt; 0 ){</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                <span class="keywordflow">while</span> ( $row = mysql_fetch_assoc($res) ){</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                        <span class="comment">/*</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">                                         Example row as follows:</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">                                         Array</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">                                        (</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">                                                [Field] =&gt; id</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">                                                [Type] =&gt; int(7)</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">                                                [Null] =&gt;  </span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">                                                [Key] =&gt; PRI</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">                                                [Default] =&gt;</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">                                                [Extra] =&gt; auto_increment</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">                                        )</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">                                        */</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                        </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                                        </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                        </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                        $widget = array();</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                                        $widget[<span class="stringliteral">&#39;label&#39;</span>] = ucfirst(str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>,$row[<span class="stringliteral">&#39;Field&#39;</span>]));</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                        $widget[<span class="stringliteral">&#39;description&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                        $widget[<span class="stringliteral">&#39;label_i18n&#39;</span>] = $this-&gt;tablename.<span class="charliteral">&#39;.&#39;</span>.$row[<span class="stringliteral">&#39;Field&#39;</span>].<span class="stringliteral">&#39;.label&#39;</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                        $widget[<span class="stringliteral">&#39;description_i18n&#39;</span>] = $this-&gt;tablename.<span class="charliteral">&#39;.&#39;</span>.$row[<span class="stringliteral">&#39;Field&#39;</span>].<span class="stringliteral">&#39;.description&#39;</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                        $widget[<span class="stringliteral">&#39;macro&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                        $widget[<span class="stringliteral">&#39;helper_css&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                        $widget[<span class="stringliteral">&#39;helper_js&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                        $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;text&#39;</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                        $widget[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                        $widget[<span class="stringliteral">&#39;atts&#39;</span>] = array();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                        <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/text/&#39;</span>, $row[<span class="stringliteral">&#39;Type&#39;</span>]) ){</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                                $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;textarea&#39;</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>  ( preg_match( <span class="stringliteral">&#39;/blob/&#39;</span>, $row[<span class="stringliteral">&#39;Type&#39;</span>]) ){</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                                $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;file&#39;</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                                </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                        </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                        </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                        $widget[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                        $row[<span class="stringliteral">&#39;tablename&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                        $row[<span class="stringliteral">&#39;widget&#39;</span>] =&amp; $widget;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                        $row[<span class="stringliteral">&#39;tableta&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                        $row[<span class="stringliteral">&#39;vocabulary&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                        $row[<span class="stringliteral">&#39;enforceVocabulary&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                        $row[<span class="stringliteral">&#39;validators&#39;</span>] = array();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                        $row[<span class="stringliteral">&#39;name&#39;</span>] = $row[<span class="stringliteral">&#39;Field&#39;</span>];</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                        $row[<span class="stringliteral">&#39;permissions&#39;</span>] = <a class="code" href="class_dataface___permissions_tool.html#a0f09438de04a139cb31716ae52bb6fce">Dataface_PermissionsTool::getRolePermissions</a>($this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;default_field_role&#39;</span>]);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                        $row[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                        $row[<span class="stringliteral">&#39;visibility&#39;</span>] = array(<span class="stringliteral">&#39;list&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>, <span class="stringliteral">&#39;browse&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>, <span class="stringliteral">&#39;find&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                        </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                        </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                        </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                        </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                                </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                        </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                        </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                        </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                        </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                        </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                        $this-&gt;_fields[ $row[<span class="stringliteral">&#39;Field&#39;</span>] ] = $row;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                        <span class="keywordflow">if</span> ( strtolower($row[<span class="stringliteral">&#39;Key&#39;</span>]) == strtolower(<span class="stringliteral">&#39;PRI&#39;</span>) ){</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                $this-&gt;_keys[ $row[<span class="stringliteral">&#39;Field&#39;</span>] ] =&amp; $this-&gt;_fields[ $row[<span class="stringliteral">&#39;Field&#39;</span>] ];</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                        </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                        unset($widget);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                        }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        mysql_free_result($res);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                        </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                        </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                        <span class="comment">// check for obvious field types</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        $fieldnames = array_keys($this-&gt;_fields);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                        <span class="keywordflow">foreach</span> ($fieldnames as $key){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                $matches = array();</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/^(.*)_mimetype$/&#39;</span>, $key, $matches) and </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                        isset( $this-&gt;_fields[$matches[1]] ) <span class="comment">/*and </span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">                                        ($this-&gt;isBlob($matches[1]) or $this-&gt;isContainer($matches[1]))*/</span> ){</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                        </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;hidden&#39;</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                        $this-&gt;_fields[$matches[1]][<span class="stringliteral">&#39;mimetype&#39;</span>] = $key;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;metafield&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/^(.*)_filename$/&#39;</span>, $key, $matches) and </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                        isset( $this-&gt;_fields[$matches[1]] ) and </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                        $this-&gt;<a class="code" href="class_dataface___table.html#a3f02bbbbe59e8721cc5b77a7358f9183" title="Checks a field to see if it is a blob type.">isBlob</a>($matches[1]) ){</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;hidden&#39;</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                                        $this-&gt;_fields[$matches[1]][<span class="stringliteral">&#39;filename&#39;</span>] = $key;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;metafield&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/password/&#39;</span>, strtolower($key) ) ){</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;password&#39;</span>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $this-&gt;_fields[$key][<span class="stringliteral">&#39;Extra&#39;</span>] == <span class="stringliteral">&#39;auto_increment&#39;</span>){</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;hidden&#39;</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^date/&#39;</span>, strtolower($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>]) ) ){</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;calendar&#39;</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                        </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                        <span class="keywordflow">if</span> ( !preg_match(<span class="stringliteral">&#39;/time/&#39;</span>, strtolower($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>]) ) ){</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                                $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;showsTime&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                                $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;ifFormat&#39;</span>] = <span class="stringliteral">&#39;%Y-%m-%d&#39;</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                        }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/timestamp/&#39;</span>, strtolower($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>]) ) ){</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;static&#39;</span>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strtolower(substr($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>],0, 4)) == <span class="stringliteral">&#39;time&#39;</span>){</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;time&#39;</span>;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( substr($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>], 0,4) == <span class="stringliteral">&#39;enum&#39;</span> ){</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;select&#39;</span>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                        <span class="keywordflow">if</span> ( DATAFACE_EXTENSION_LOADED_APC ){</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                apc_store($apc_key_fields, $this-&gt;_fields);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                                apc_store($apc_key_keys, $this-&gt;_keys);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                apc_store($apc_key_mtime, time());</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        }</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                $this-&gt;_loadFieldsIniFile();</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                        <span class="keywordflow">foreach</span> ( array_keys($this-&gt;<a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7" title="Returns reference to the keys array that contains field definitions for keys.">keys</a>()) as $currkey ){</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                $this-&gt;_fields[$currkey][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;hidden&#39;</span>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                $curr_order = 0;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                $needs_sort = <span class="keyword">false</span>; <span class="comment">// flag to indicate if any &quot;order&quot; attributes were set in the fields.ini file</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="keywordflow">foreach</span> (array_keys($this-&gt;_fields) as $field_name ){</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_fields[$field_name][<span class="stringliteral">&#39;order&#39;</span>]) ) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                                $needs_sort = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                $curr_order++;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        <span class="keywordflow">else</span> $this-&gt;_fields[$field_name][<span class="stringliteral">&#39;order&#39;</span>] = $curr_order++;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                <span class="comment">//$this-&gt;_loadValuelistsIniFile();</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                        <span class="comment">// lazily created now in valuelists() and getValuelist()</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="comment">//$this-&gt;_loadRelationshipsIniFile();</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                        <span class="comment">// had to be removed to prevent possibility of infinite loops.  This is now called lazily as relationships </span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                        <span class="comment">// are needed.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                        </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="comment">//$GLOBALS[&#39;DATAFACE_QUERYBUILDER_SECURITY_CONSTRAINTS&#39;][$this-&gt;tablename] = $this-&gt;_filters;</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                        </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="comment">// get some validation information to start with</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                <span class="keywordflow">foreach</span> ($fieldnames as $key){</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                        $row =&amp; $this-&gt;_fields[$key];</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                        </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        <span class="comment">// handle case where this is an enumerated field</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        $matches = array();</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^(enum|set)\(([^\)]+)\)$/&#39;</span>, $row[<span class="stringliteral">&#39;Type&#39;</span>], $matches )){</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                $valuelists =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a8cdc8a9cb6d7d23cad814cd88a5ba85c" title="Returns the valuelists in this table.">valuelists</a>();</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                $options = explode(<span class="charliteral">&#39;,&#39;</span>, $matches[2]);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                $vocab = array();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                                <span class="keywordflow">foreach</span> ( $options as $val){</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                        $val = substr($val,1,strlen($val)-2); <span class="comment">// strip off the quotes</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                                        $vocab[$val] = $val;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                                </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                $valuelists[$row[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;_values&quot;</span>] =&amp; $vocab;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                                <span class="keywordflow">if</span> ( !@$row[<span class="stringliteral">&#39;vocabulary&#39;</span>] ) $row[<span class="stringliteral">&#39;vocabulary&#39;</span>] = $row[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;_values&quot;</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                                </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                <span class="keywordflow">if</span> ( strtolower($matches[1]) == <span class="stringliteral">&#39;set&#39;</span>){</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                        $row[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                        $row[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                <span class="comment">//$row[&#39;widget&#39;][&#39;type&#39;] = &#39;select&#39;;</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                                $opt_keys = array_keys($vocab);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                                $dummy = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="class_dataface___table.html#a0cee083525b341373363b1908786c7f7" title="Checks if a valuelist is just a boolean valuelist. It will also return (via output parameters) what t...">isYesNoValuelist</a>($row[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;_values&quot;</span>, $dummy, $dummy) ){</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                        $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;checkbox&#39;</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                                unset( $valuelists);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                                unset( $vocab);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                                </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                        </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                        </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                        </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                        </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        <span class="keywordflow">if</span> (            !$this-&gt;<a class="code" href="class_dataface___table.html#a3f02bbbbe59e8721cc5b77a7358f9183" title="Checks a field to see if it is a blob type.">isBlob</a>($row[<span class="stringliteral">&#39;name&#39;</span>])    and </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                                !$this-&gt;<a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>($row[<span class="stringliteral">&#39;name&#39;</span>])    and </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                                !$this-&gt;<a class="code" href="class_dataface___table.html#ab686f41012904c84666d28a4239dd0cf" title="Checks a field to see if it is a date type (date, datetime, time, or timestamp).">isDate</a>($row[<span class="stringliteral">&#39;name&#39;</span>])    and</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                                !$this-&gt;<a class="code" href="class_dataface___table.html#a537fc09b1b164dfb16d91448f464bc26" title="Checks to see if the field is a password field. Any field with widget:type=password is regarded as a ...">isPassword</a>($row[<span class="stringliteral">&#39;name&#39;</span>]) and</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                                $row[<span class="stringliteral">&#39;Null&#39;</span>] != <span class="stringliteral">&#39;YES&#39;</span>                   and</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                                strlen($row[<span class="stringliteral">&#39;Default&#39;</span>]) == 0    and</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                                $row[<span class="stringliteral">&#39;Extra&#39;</span>] != <span class="stringliteral">&#39;auto_increment&#39;</span> and </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                                @$row[<span class="stringliteral">&#39;validators&#39;</span>][<span class="stringliteral">&#39;required&#39;</span>] !== 0){</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                $messageStr = <span class="stringliteral">&quot;%s is a required field&quot;</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                $message = sprintf(</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                                df_translate(<span class="stringliteral">&#39;Field is a required field&#39;</span>, $messageStr),</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                                $row[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                );</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                                </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                <span class="keywordflow">if</span> ( @is_array($row[<span class="stringliteral">&#39;validators&#39;</span>][ <span class="stringliteral">&#39;required&#39;</span> ]) and isset($row[<span class="stringliteral">&#39;validators&#39;</span>][<span class="stringliteral">&#39;required&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>]) ){</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                        $message = $row[<span class="stringliteral">&#39;validators&#39;</span>][<span class="stringliteral">&#39;required&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>];</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                $row[<span class="stringliteral">&#39;validators&#39;</span>][ <span class="stringliteral">&#39;required&#39;</span> ] = array(<span class="stringliteral">&#39;message&#39;</span> =&gt; $message,</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                                                                                  <span class="stringliteral">&#39;arg&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( @$row[<span class="stringliteral">&#39;validators&#39;</span>][<span class="stringliteral">&#39;required&#39;</span>] === 0 ){</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                unset($row[<span class="stringliteral">&#39;validators&#39;</span>][<span class="stringliteral">&#39;required&#39;</span>]);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                        }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                        </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                        </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        <span class="comment">// check for signs that this is a repeated field</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                        <span class="keywordflow">if</span> ( $row[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;checkbox&#39;</span> and isset( $row[<span class="stringliteral">&#39;vocabulary&#39;</span>] ) and ( $this-&gt;<a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>($key) or $this-&gt;<a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b" title="Checks to see if the field is a character field (i.e. varchar or char).">isChar</a>($key) ) ){</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                <span class="keywordflow">if</span> ( isset( $row[<span class="stringliteral">&#39;repeat&#39;</span>] ) and !$row[<span class="stringliteral">&#39;repeat&#39;</span>] ){</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                                        <span class="comment">//do nothing</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                                        $row[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                                }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                        }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                        <span class="keywordflow">if</span> ( !isset($row[<span class="stringliteral">&#39;repeat&#39;</span>]) ) $row[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                        <span class="keywordflow">if</span> ( $row[<span class="stringliteral">&#39;repeat&#39;</span>] and !isset( $row[<span class="stringliteral">&#39;separator&#39;</span>] )){</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                $row[<span class="stringliteral">&#39;separator&#39;</span>] = <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                        </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                        <span class="keywordflow">if</span> ( !isset($row[<span class="stringliteral">&#39;display&#39;</span>]) and $this-&gt;<a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>($row[<span class="stringliteral">&#39;name&#39;</span>]) ) $row[<span class="stringliteral">&#39;display&#39;</span>] = <span class="stringliteral">&#39;block&#39;</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !isset($row[<span class="stringliteral">&#39;display&#39;</span>]) ) $row[<span class="stringliteral">&#39;display&#39;</span>] = <span class="stringliteral">&#39;inline&#39;</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                                </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                        unset($row);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                <span class="comment">// check for obvious signs that this is a repeating field</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                <span class="comment">// sort the fields now based on their order attribute</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="keywordflow">if</span> ($needs_sort){</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                        uasort($this-&gt;_fields, array(&amp;$this, <span class="stringliteral">&#39;_compareFields&#39;</span>));</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keyword">function</span> postInit(){</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <span class="comment">// call init method of delegate</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                        $pdelegate =&amp; $parent-&gt;getDelegate();</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                        <span class="keywordflow">if</span> ( isset($pdelegate) and method_exists($pdelegate, <span class="stringliteral">&#39;init&#39;</span>) ){</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                $res = $pdelegate-&gt;init($this);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                        }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                <span class="keywordflow">if</span> ( $delegate !== null and method_exists($delegate, <span class="stringliteral">&#39;init&#39;</span>) ){</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                        $res = $delegate-&gt;init($this);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($this-&gt;_fields) as $key){</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>] = $this-&gt;<a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>(<span class="stringliteral">&#39;widget:description&#39;</span>, $key);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>] = $this-&gt;<a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>(<span class="stringliteral">&#39;widget:label&#39;</span>, $key);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;vocabulary&#39;</span>] = $this-&gt;<a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>(<span class="stringliteral">&#39;vocabulary&#39;</span>, $key);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = $this-&gt;<a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>(<span class="stringliteral">&#39;widget:type&#39;</span>, $key);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>] = array_merge($this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>], $this-&gt;<a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>(<span class="stringliteral">&#39;widget&#39;</span>, $key));</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                <span class="keywordflow">if</span> ( count($this-&gt;_securityFilter) == 0 ){</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        $this-&gt;<a class="code" href="class_dataface___table.html#a44a905b0643b451c62705cb4a1280c63" title="Sets a security filter on the table. A security filter is an array of key/value pairs that are automa...">setSecurityFilter</a>();</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">// END Initialization</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span>        <span class="comment">// Some static utility methods</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        </div>
<div class="line"><a name="l00882"></a><span class="lineno"><a class="code" href="class_dataface___table.html#abd39ab27289c4d95459ce421a702ba86">  882</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#abd39ab27289c4d95459ce421a702ba86" title="Returns field information given its address. Note: To prevent deadlocks, this method should never be ...">getTableField</a>($address, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>=<span class="stringliteral">&#39;&#39;</span>){</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                $addr = array_map(<span class="stringliteral">&#39;trim&#39;</span>, explode(<span class="charliteral">&#39;.&#39;</span>, $address) );</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                <span class="keywordflow">if</span> ( <span class="keyword">sizeof</span>($addr) != 2 ) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">SCHEMA_NO_SUCH_FIELD_ERROR</a>, null,null,null, <span class="stringliteral">&quot;Call to getTableField with invalid address: &#39;$address&#39;.  Address must be absolute in the form &#39;table_name.column_name&#39;.&quot;</span>);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; self::loadTable($addr[0], <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>) ){</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> =&amp; <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;fields(<span class="keyword">false</span>,<span class="keyword">true</span>,<span class="keyword">true</span>);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                <span class="keywordflow">if</span> ( !isset( <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[ $addr[1] ] ) ){</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">SCHEMA_NO_SUCH_FIELD_ERROR</a>, null,null,null, <span class="stringliteral">&quot;Call to getTableField with invalid address: &#39;$address&#39;.  Column $addr[1] does not exists in table $addr[0].&quot;</span>);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$addr[1]];</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        </div>
<div class="line"><a name="l00912"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aef8a400c460e7e14151b80b8aaf9bdc8">  912</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aef8a400c460e7e14151b80b8aaf9bdc8" title="Checks if a field exists. Note: To prevent deadlocks, this method should never be called inside the D...">fieldExists</a>($address, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>=<span class="stringliteral">&#39;&#39;</span>){</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                $res = self::getTableField($address, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <span class="keywordflow">return</span> !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($res);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        </div>
<div class="line"><a name="l00926"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ae4506a68734fe06f0cc7e90f5d5cf00b">  926</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ae4506a68734fe06f0cc7e90f5d5cf00b" title="Checks if the given table exists. This caches the results so that you won&#39;t have to check the existen...">tableExists</a>(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>, $usecache=<span class="keyword">true</span>){</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                <span class="keyword">static</span> <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a> = 0;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a> === 0 ) <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a> = array();</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                <span class="keywordflow">if</span> ( !isset(<a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>]) or !$usecache ) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                        <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>] = mysql_num_rows(mysql_query(<span class="stringliteral">&quot;show tables like &#39;&quot;</span>.addslashes($tablename).<span class="stringliteral">&quot;&#39;&quot;</span>, $app-&gt;db()));</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>];</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        </div>
<div class="line"><a name="l00944"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ae81f1a439b2c0b79a04db78ee27dfd21">  944</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ae81f1a439b2c0b79a04db78ee27dfd21" title="Checks if a field exists in this table by the given name.">exists</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $checkParent=<span class="keyword">true</span>){</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_dataface___table.html#a503d46bef54079a196b2152e6ec677f0" title="Checks if a field exists in this table by the given name. Alias of hasField()">hasField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $checkParent);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        </div>
<div class="line"><a name="l00954"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a503d46bef54079a196b2152e6ec677f0">  954</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a503d46bef54079a196b2152e6ec677f0" title="Checks if a field exists in this table by the given name. Alias of hasField()">hasField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $checkParent=<span class="keyword">true</span>){</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>,<span class="charliteral">&#39;.&#39;</span>) &gt; 0 ){</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                        list($rel_name, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                        <span class="keywordflow">if</span> ( !$this-&gt;<a class="code" href="class_dataface___table.html#ada42d41741401261ee692c7cdb73ec46" title="Checks if this table has a relationship with the specified name.">hasRelationship</a>($rel_name) ) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                        $relationship =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a32cd7fb65770f8572428933c5b00d8c5" title="Gets a relationship by name.">getRelationship</a>($rel_name);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                        <span class="keywordflow">if</span> ( $relationship-&gt;hasField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, <span class="keyword">true</span>, <span class="keyword">true</span>) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                        <span class="keywordflow">if</span> ( array_key_exists(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>(<span class="keyword">false</span>,<span class="keyword">true</span>)) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                        <span class="comment">//if ( isset( $this-&gt;_fields[$fieldname] ) ) return true;</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                        <span class="comment">//if ( isset( $this-&gt;_graftedFields[$fieldname]) ) return true;</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                        $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                        <span class="keywordflow">if</span> ( $delegate !== null and method_exists($delegate, <span class="stringliteral">&#39;field__&#39;</span>.<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                        $transient =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a1b62b52d7372b6e99b33acf6af44c4bd" title="Returns the transient fields in this table. Transient fields are fields that do not get saved in the ...">transientFields</a>();</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                        <span class="keywordflow">if</span> ( isset($transient[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>]) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                        </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                        <span class="keywordflow">if</span> ( $checkParent ){</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                <span class="keywordflow">if</span> ( isset($parent) and $parent-&gt;hasField($fieldname, $checkParent) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                        }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        </div>
<div class="line"><a name="l00995"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab9245575b12538207c3b3f083b1bd1ad">  995</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab9245575b12538207c3b3f083b1bd1ad" title="Returns the absolute field name of a field as it appears in one of the given tables. This is kind of like a search to find out which of the given tables, the column belongs to. The absolute field name is a string of the form table_name.field_name (ie table name and field name separated by a dot). This method may be called statically.">absoluteFieldName</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, $tablenames, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>=<span class="stringliteral">&#39;&#39;</span>, $columnList=null){</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                <span class="keywordflow">if</span> ( self::fieldExists(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>) ){</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <span class="charliteral">&#39;.&#39;</span>) &gt; 0 ){</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                        <span class="keywordflow">return</span> self::getTableField(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                        $found = 0;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                        $name = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                        </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                        <span class="keywordflow">if</span> ( is_array($columnList) ){</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                                <span class="keywordflow">foreach</span> ( $columnList as $column ){</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^(\w+)\.&#39;</span>.<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>.<span class="stringliteral">&#39;$/&#39;</span>, $column) ){</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                                                $name = $column;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                                                $found++;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                                        }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                                }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                <span class="keywordflow">foreach</span> ($tablenames as <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>){</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                                        <span class="keywordflow">if</span> ( self::fieldExists($table.<span class="charliteral">&#39;.&#39;</span>.<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="class_dataface___table.html#a1fa3127fc82f96b1436d871ef02be319" title="DB connection handle.  resource handle.">$db</a>) ){</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                                                $name = $table.<span class="charliteral">&#39;.&#39;</span>.<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                                $found++;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                        }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                }</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                        }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="keywordflow">if</span> ( $found == 0 ){</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                        $err = <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">SCHEMA_NO_SUCH_FIELD_ERROR</a>,null,null,null, <span class="stringliteral">&quot;Field $field does not exist in tables &quot;</span>.implode(<span class="charliteral">&#39;,&#39;</span>, $tablenames).<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($err-&gt;toString(), E_USER_WARNING);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                <span class="keywordflow">return</span> $name;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        </div>
<div class="line"><a name="l01037"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a309349d8ec3c27ff0bd717b3d8fbdcbd"> 1037</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a309349d8ec3c27ff0bd717b3d8fbdcbd" title="Returns the relative field name given either a relative name or an absolute name.">relativeFieldName</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>,<span class="charliteral">&#39;.&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[1];</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keyword">function</span> _fieldsIniFilePath(){</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                <span class="keywordflow">return</span> $this-&gt;basePath().<span class="stringliteral">&#39;/tables/&#39;</span>.basename($this-&gt;tablename).<span class="stringliteral">&#39;/fields.ini&#39;</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        </div>
<div class="line"><a name="l01081"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839"> 1081</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>($types, $patterns, $forcePattern=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                $candidates = array();</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                $max = null;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>(<span class="keyword">false</span>,<span class="keyword">true</span>) as <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                        $type = strtolower($this-&gt;<a class="code" href="class_dataface___table.html#af7a34c2ee4677cf0d5f5ed3f8d3c4d21" title="Returns the type of a field , eg: int, float, varchar, blob, etc...">getType</a>($field[<span class="stringliteral">&#39;name&#39;</span>]));</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                        <span class="keywordflow">if</span> ( !isset($types[$type]) ){</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                        }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                        </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                        $score = $types[$type];</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                        $found=<span class="keyword">false</span>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                        <span class="keywordflow">foreach</span> ($patterns as $pattern=&gt;$value){</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                <span class="keywordflow">if</span> ( preg_match($pattern, $field[<span class="stringliteral">&#39;name&#39;</span>]) ){</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                                        $score *= $value;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                        $found=<span class="keyword">true</span>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                                }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                        <span class="keywordflow">if</span> ( $forcePattern and !$found ){</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                                $score = 0;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                        }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                        $candidates[$field[<span class="stringliteral">&#39;name&#39;</span>]] = $score;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                        <span class="keywordflow">if</span> ( !isset($max) ) $max = $field[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $candidates[$max] &lt; $score ){</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                                $max = $field[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                        }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                <span class="keywordflow">return</span> $max;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        </div>
<div class="line"><a name="l01120"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a682528f9eb0d8a2e3f27a2776a57baa9"> 1120</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a682528f9eb0d8a2e3f27a2776a57baa9" title="Makes a best guess at which field in this table stores the record description. The record description...">getDescriptionField</a>(){</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;descriptionField) ){</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                        </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                        $this-&gt;descriptionField = $this-&gt;<a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>(</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                array(<span class="stringliteral">&#39;text&#39;</span>=&gt;10, <span class="stringliteral">&#39;mediumtext&#39;</span>=&gt;10, <span class="stringliteral">&#39;shorttext&#39;</span>=&gt;10, <span class="stringliteral">&#39;longtext&#39;</span>=&gt;2,</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                                          <span class="stringliteral">&#39;varchar&#39;</span>=&gt;1, <span class="stringliteral">&#39;char&#39;</span>=&gt;1),</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                                array(<span class="stringliteral">&#39;/description|summary|overview/&#39;</span>=&gt;10, <span class="stringliteral">&#39;/desc/&#39;</span>=&gt;2)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                );</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                        </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <span class="keywordflow">return</span> $this-&gt;descriptionField;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        </div>
<div class="line"><a name="l01142"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a90b32e61a33646c536d4b6c10dcefb50"> 1142</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a90b32e61a33646c536d4b6c10dcefb50" title="Makes a best guess at which field stores the creation date of the record.">getCreatedField</a>(){</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;createdField) ){</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                        $this-&gt;createdField = $this-&gt;<a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>(</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                                array(<span class="stringliteral">&#39;datetime&#39;</span>=&gt;10, <span class="stringliteral">&#39;timestamp&#39;</span>=&gt;10, <span class="stringliteral">&#39;date&#39;</span>=&gt;1),</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                                array(<span class="stringliteral">&#39;/created|inserted|added|posted|creation|insertion/i&#39;</span>=&gt;10, <span class="stringliteral">&#39;/timestamp/i&#39;</span>=&gt;5)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                );</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                }</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <span class="keywordflow">return</span> $this-&gt;createdField;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        </div>
<div class="line"><a name="l01161"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a8d8f0b6e227934563f2bd3b84c8fba43"> 1161</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a8d8f0b6e227934563f2bd3b84c8fba43" title="Makes a best guess at which field stores the username of the person who created the record...">getCreatorField</a>(){</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;creatorField) ){</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                        </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                        $this-&gt;creatorField = $this-&gt;<a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>(</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                                array(<span class="stringliteral">&#39;varchar&#39;</span>=&gt;10,<span class="stringliteral">&#39;char&#39;</span>=&gt;10,<span class="stringliteral">&#39;int&#39;</span>=&gt;5),</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                                array(<span class="stringliteral">&#39;/(created.*by)|(owner)|(posted*by)|(author)|(creator)/i&#39;</span>=&gt;10),</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                                <span class="keyword">true</span> </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                                );</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                <span class="keywordflow">return</span> $this-&gt;creatorField;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        </div>
<div class="line"><a name="l01183"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aade20828851baeddee1f537da3bea323"> 1183</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aade20828851baeddee1f537da3bea323" title="Gets the field that is used to track the version of this record, if one is set. The version field is ...">getVersionField</a>(){</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;versionField == -1 ){</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                        $this-&gt;versionField = null;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = &amp; $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>(<span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                        <span class="keywordflow">foreach</span> (<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> as <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                                <span class="keywordflow">if</span> ( @$field[<span class="stringliteral">&#39;version&#39;</span>] ){</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                                        $this-&gt;versionField = $field[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                                }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                        }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface___table.html#a3574c97289e10ce993358e8f2c1e2235">$this-&gt;versionField</a>;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        </div>
<div class="line"><a name="l01203"></a><span class="lineno"><a class="code" href="class_dataface___table.html#af0d76e8ddd32df6882816ce0ee81c5c5"> 1203</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#af0d76e8ddd32df6882816ce0ee81c5c5" title="Sets the name of the field that should be used to version records of this table.">setVersionField</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                $this-&gt;versionField = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        </div>
<div class="line"><a name="l01207"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa2659c85f90cbfb4537f912a2d5d7caa"> 1207</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aa2659c85f90cbfb4537f912a2d5d7caa">isVersioned</a>(){</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                $vf = $this-&gt;<a class="code" href="class_dataface___table.html#aade20828851baeddee1f537da3bea323" title="Gets the field that is used to track the version of this record, if one is set. The version field is ...">getVersionField</a>();</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                <span class="keywordflow">return</span> isset($vf);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        }</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        </div>
<div class="line"><a name="l01220"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a15a8993901ca4dcadd4ad4a59cbe1b78"> 1220</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a15a8993901ca4dcadd4ad4a59cbe1b78" title="Makes a best guess at which field stores the last modified date of the record.">getLastUpdatedField</a>(){</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;lastUpdatedField) ){</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                        $this-&gt;lastUpdatedField = $this-&gt;<a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>(</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                array(<span class="stringliteral">&#39;datetime&#39;</span>=&gt;10,<span class="stringliteral">&#39;timestamp&#39;</span>=&gt;12),</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                                array(<span class="stringliteral">&#39;/updated|modified|change|modification|update/i&#39;</span>=&gt;10,<span class="stringliteral">&#39;/timestamp/i&#39;</span>=&gt;5)</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                        )       ;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                <span class="keywordflow">return</span> $this-&gt;lastUpdatedField;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        </div>
<div class="line"><a name="l01238"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa1bb3db0f400a24571ef169856960b33"> 1238</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aa1bb3db0f400a24571ef169856960b33" title="Makes a best guess at which field stores the &quot;body&quot; of the record. The body is used in things like th...">getBodyField</a>(){</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;bodyField) ){</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                        $this-&gt;bodyField = $this-&gt;<a class="code" href="class_dataface___table.html#a21543a011628bf46add54e31808b8839" title="Tries to find a field that best matches the criteria we provide. This is useful for finding e...">guessField</a>(</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                                array(<span class="stringliteral">&#39;text&#39;</span>=&gt;10,<span class="stringliteral">&#39;longtext&#39;</span>=&gt;10,<span class="stringliteral">&#39;mediumtext&#39;</span>=&gt;10),</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                                array(<span class="stringliteral">&#39;/main|body|content|profile|writeup|bio/i&#39;</span>=&gt;10)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                        );</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="keyword">function</span> _compareFields($a,$b){</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                <span class="keywordflow">if</span> ( @$a[<span class="stringliteral">&#39;order&#39;</span>] == @$b[<span class="stringliteral">&#39;order&#39;</span>] ) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                <span class="keywordflow">return</span> ( @$a[<span class="stringliteral">&#39;order&#39;</span>] &lt; @$b[<span class="stringliteral">&#39;order&#39;</span>] ) ? -1 : 1;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        </div>
<div class="line"><a name="l01279"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a0ca328d720ca84f37a427a811f9669ac"> 1279</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a0ca328d720ca84f37a427a811f9669ac" title="Returns an associative array of indexes in this table.">getIndexes</a>(){</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_indexes) ){</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                        $this-&gt;_indexes = array();</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;SHOW index FROM `&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;`&quot;</span>, $this-&gt;db);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Failed to get index list due to a mysql error: &quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>), E_USER_ERROR);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                        }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                        </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                        <span class="keywordflow">while</span> ( $row = mysql_fetch_array($res) ){</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $this-&gt;_indexes[ $row[<span class="stringliteral">&#39;Key_name&#39;</span>] ] ) )</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                                        $this-&gt;_indexes[ $row[<span class="stringliteral">&#39;Key_name&#39;</span>] ] = array();</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a> =&amp; $this-&gt;_indexes[$row[<span class="stringliteral">&#39;Key_name&#39;</span>]];</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;name&#39;</span>] = $row[<span class="stringliteral">&#39;Key_name&#39;</span>];</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                                <span class="keywordflow">if</span> ( !isset( <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;columns&#39;</span>] ) )</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                                        <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;columns&#39;</span>] = array();</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;columns&#39;</span>][] = $row[<span class="stringliteral">&#39;Column_name&#39;</span>];</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;unique&#39;</span>] = ( $row[<span class="stringliteral">&#39;Non_unique&#39;</span>] ? <span class="keyword">false</span> : true );</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;type&#39;</span>] = $row[<span class="stringliteral">&#39;Index_type&#39;</span>];</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                                <a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>[<span class="stringliteral">&#39;comment&#39;</span>] = $row[<span class="stringliteral">&#39;Comment&#39;</span>];</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                                unset(<a class="code" href="blob_8php.html#aea0cec502f52901eaddd49f71340632a">$index</a>);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                        }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                        mysql_free_result($res);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                        </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_indexes;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        }</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        </div>
<div class="line"><a name="l01319"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a59a5bb58d618b85eac34d09ebfef35b8"> 1319</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a59a5bb58d618b85eac34d09ebfef35b8" title="Returns an array of field names that have full text indexes.">getFullTextIndexedFields</a>(){</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                $indexes =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a0ca328d720ca84f37a427a811f9669ac" title="Returns an associative array of indexes in this table.">getIndexes</a>();</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array();</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($indexes) as $indexName ){</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                        <span class="keywordflow">if</span> ( strtolower($indexes[$indexName][<span class="stringliteral">&#39;type&#39;</span>]) === <span class="stringliteral">&#39;fulltext&#39;</span> ){</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                                <span class="keywordflow">foreach</span> ( $indexes[$indexName][<span class="stringliteral">&#39;columns&#39;</span>] as $col ){</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[] = $col;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                                }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                        }</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                }</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        }</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        </div>
<div class="line"><a name="l01344"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a4a9d7319e9faeef6ad1ccdfcfa37db1f"> 1344</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a4a9d7319e9faeef6ad1ccdfcfa37db1f" title="Returns array of names of char, varchar, and text fields. These are the fields that can be searched u...">getCharFields</a>($includeGraftedFields=<span class="keyword">false</span>, $excludeUnsearchable=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__]) ){</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                        <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = array();</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                        <span class="keywordflow">foreach</span> ( array_keys($this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>(<span class="keyword">false</span>, $includeGraftedFields)) as <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                                <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b" title="Checks to see if the field is a character field (i.e. varchar or char).">isChar</a>($field) or $this-&gt;<a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>($field) or (strtolower($this-&gt;<a class="code" href="class_dataface___table.html#af7a34c2ee4677cf0d5f5ed3f8d3c4d21" title="Returns the type of a field , eg: int, float, varchar, blob, etc...">getType</a>($field)) == <span class="stringliteral">&#39;enum&#39;</span>) or ($this-&gt;<a class="code" href="class_dataface___table.html#af7a34c2ee4677cf0d5f5ed3f8d3c4d21" title="Returns the type of a field , eg: int, float, varchar, blob, etc...">getType</a>($field) == <span class="stringliteral">&#39;container&#39;</span>) ){</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                        <span class="keywordflow">if</span> ( $excludeUnsearchable and !$this-&gt;<a class="code" href="class_dataface___table.html#a7f9ea17084d13584d2380373c7f2ec6e" title="Checks if a field is searchable. Fields can be made unsearchable by setting the not_searchable direct...">isSearchable</a>($field) ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                                        <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>[] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                        }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                        $this-&gt;_cache[__FUNCTION__] = <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__];</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        </div>
<div class="line"><a name="l01366"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a7f9ea17084d13584d2380373c7f2ec6e"> 1366</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a7f9ea17084d13584d2380373c7f2ec6e" title="Checks if a field is searchable. Fields can be made unsearchable by setting the not_searchable direct...">isSearchable</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                $fld =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                <span class="keywordflow">return</span> !@$fld[<span class="stringliteral">&#39;not_searchable&#39;</span>];</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        </div>
<div class="line"><a name="l01380"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a789b7205ed1b5d5ed370a077b6333048"> 1380</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a789b7205ed1b5d5ed370a077b6333048" title="Indicates if the given field acts as a meta field that describes an aspect of another field...">isMetaField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                <span class="keywordflow">if</span> ( !isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;metafield&#39;</span>]) ){</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>();</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                        $field_names = array_keys(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                        <span class="keywordflow">foreach</span> ( $field_names as $fn){</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                                <span class="keywordflow">if</span> ( ( isset(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fn][<span class="stringliteral">&#39;mimetype&#39;</span>]) and <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fn][<span class="stringliteral">&#39;mimetype&#39;</span>] == <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a> ) or </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                                        ( isset(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fn][<span class="stringliteral">&#39;filename&#39;</span>]) and <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fn][<span class="stringliteral">&#39;filename&#39;</span>] == <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a> ) ) {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;metafield&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                                 }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                        }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                        <span class="keywordflow">if</span> ( !isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;metafield&#39;</span>]) ){</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;metafield&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                        }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;metafield&#39;</span>];</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        </div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        </div>
<div class="line"><a name="l01413"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a47137e5f814eacd9e50d87ec24c90faf"> 1413</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a47137e5f814eacd9e50d87ec24c90faf" title="Returns an array of names of columns in the metadata table for this table. The metadata table contain...">getMetadataColumns</a>(){</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;metadataColumns) ){</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                        $metatablename = $this-&gt;tablename.<span class="stringliteral">&#39;__metadata&#39;</span>;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                        $sql = <span class="stringliteral">&quot;SHOW COLUMNS FROM `{$metatablename}`&quot;</span>;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                        $res = mysql_query($sql, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                        <span class="keywordflow">if</span> ( !$res || mysql_num_rows($res) == 0){</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                                <a class="code" href="class_dataface___metadata_tool.html#a7c4133cb6c51f475257a513974547140">Dataface_MetadataTool::refreshMetadataTable</a>($this-&gt;tablename);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                $res = mysql_query($sql, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                        }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                        <span class="keywordflow">if</span> ( !$res ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>), E_USER_ERROR);</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                        <span class="keywordflow">if</span> ( mysql_num_rows($res) == 0 ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;No metadata table set up for table &#39;{$this-&gt;tablename}&#39;&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                        $this-&gt;metadataColumns = array();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                        <span class="keywordflow">while</span> ($row = mysql_fetch_assoc($res) ){</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                <span class="keywordflow">if</span> ( substr($row[<span class="stringliteral">&#39;Field&#39;</span>],0,2) == <span class="stringliteral">&#39;__&#39;</span> ){</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                                        $this-&gt;metadataColumns[] =  $row[<span class="stringliteral">&#39;Field&#39;</span>];</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                }</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                        }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                        </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                <span class="keywordflow">return</span> $this-&gt;metadataColumns;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        </div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        </div>
<div class="line"><a name="l01446"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac07a8b2d907793c579e3cce5e1aa1d33"> 1446</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ac07a8b2d907793c579e3cce5e1aa1d33" title="Returns the fields that should be included in forms for editing. This includes fields from parent tab...">formFields</a>($byTab=<span class="keyword">false</span>, $includeTransient=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][intval($byTab)][intval($includeTransient)]) ){</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>($byTab,<span class="keyword">false</span>,$includeTransient);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                        $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                                </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array_merge_recursive_unique($parent-&gt;fields($byTab,<span class="keyword">false</span>,$includeTransient), <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                                uasort(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, array(&amp;$this, <span class="stringliteral">&#39;_compareFields&#39;</span>));</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                        }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                        </div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                        $this-&gt;_cache[__FUNCTION__][intval($byTab)][intval($includeTransient)] =&amp; <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                }</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][intval($byTab)][intval($includeTransient)];</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7"> 1492</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>($byTab=<span class="keyword">false</span>, $includeGrafted=<span class="keyword">false</span>, $includeTransient=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                <span class="keywordflow">if</span> ( !$byTab) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                        <span class="comment">//if ( $includeGrafted or $includeTransient){</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][intval($includeGrafted)][intval($includeTransient)]) ){</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                                <span class="comment">//return $this-&gt;_cache[intval($includeGrafted)][intval($includeTransient)];</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                                </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array();</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                                </div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                                <span class="keywordflow">if</span> ( $includeGrafted ){</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                                        $grafted_fields =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa0b8971353bd0c3375dfb0ebb0a3c074" title="Field definitions of fields that have been grafted onto this table.">graftedFields</a>();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                                        <span class="keywordflow">foreach</span> (array_keys($grafted_fields) as $fname){</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                                                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fname] =&amp; $grafted_fields[$fname];</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                                        }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                                }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                                </div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                                <span class="keywordflow">if</span> ( $includeTransient ){</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                                        $transient_fields =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a1b62b52d7372b6e99b33acf6af44c4bd" title="Returns the transient fields in this table. Transient fields are fields that do not get saved in the ...">transientFields</a>();</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                                        <span class="keywordflow">foreach</span> ( array_keys($transient_fields) as $fname){</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                                                <span class="keywordflow">if</span> ( !isset(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fname]) ) <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$fname] =&amp; $transient_fields[$fname];</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                                                </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                                        }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                                }</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                                </div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                                <span class="keywordflow">if</span> ( count(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>) &gt; 0 ){</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array_merge_recursive_unique($this-&gt;_fields, <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                                        uasort(<a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, array(&amp;$this, <span class="stringliteral">&#39;_compareFields&#39;</span>));</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                                        $this-&gt;_cache[__FUNCTION__][intval($includeGrafted)][intval($includeTransient)] =&amp; <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                                </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                                        $this-&gt;_cache[__FUNCTION__][intval($includeGrafted)][intval($includeTransient)] =&amp; $this-&gt;_fields;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                                }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                        }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                        </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][intval($includeGrafted)][intval($includeTransient)];</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                        </div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $this-&gt;_fieldsByTab ) ){</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                                $this-&gt;_fieldsByTab = array();</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                                </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                                <span class="keywordflow">foreach</span> ( $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>(<span class="keyword">false</span>,$includeGrafted, $includeTransient) as <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                                </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                                        $tab = ( isset( $field[<span class="stringliteral">&#39;tab&#39;</span>] ) ? $field[<span class="stringliteral">&#39;tab&#39;</span>] : <span class="stringliteral">&#39;__default__&#39;</span>);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                                        </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                                        <span class="keywordflow">if</span> ( !isset( $this-&gt;_fieldsByTab[ $tab] ) ){</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                                                $this-&gt;_fieldsByTab[ $tab ] = array();</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                                        }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                                        $this-&gt;_fieldsByTab[ $tab ][$field[<span class="stringliteral">&#39;name&#39;</span>]] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                                </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                                }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                        }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_fieldsByTab;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                        </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                }</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        }</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        </div>
<div class="line"><a name="l01573"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa0b8971353bd0c3375dfb0ebb0a3c074"> 1573</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#aa0b8971353bd0c3375dfb0ebb0a3c074" title="Field definitions of fields that have been grafted onto this table.">graftedFields</a>($includeParent=<span class="keyword">true</span>){</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                $tsql = $this-&gt;<a class="code" href="class_dataface___table.html#aac66f1670a1258beaf6f5278880d269c" title="Returns the SQL query used to fetch records of this table, if defined.">sql</a>();</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                <span class="keywordflow">if</span> ( $includeParent ) $includeParent = 1;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                <span class="keywordflow">else</span> $includeParent = 0;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][intval($includeParent)]) ){</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                <span class="comment">//if ( !isset($this-&gt;_grafted_fields) ){</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                        </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                        $this-&gt;_grafted_fields = array();</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                        <span class="keywordflow">if</span> (isset($tsql)){</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                        </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                                $this-&gt;_grafted_fields = array();</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                                <span class="keyword">import</span>(<span class="stringliteral">&#39;SQL/Parser.php&#39;</span>);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                                $parser = <span class="keyword">new</span> SQL_Parser(null,<span class="stringliteral">&#39;MySQL&#39;</span>);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                                $data = $parser-&gt;parse($tsql);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                                <span class="keywordflow">foreach</span> ( $data[<span class="stringliteral">&#39;columns&#39;</span>] as $col ){</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                        <span class="keywordflow">if</span> ( $col[<span class="stringliteral">&#39;type&#39;</span>] != <span class="stringliteral">&#39;glob&#39;</span> ){</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                                $alias = ( @$col[<span class="stringliteral">&#39;alias&#39;</span>] ? $col[<span class="stringliteral">&#39;alias&#39;</span>] : $col[<span class="stringliteral">&#39;value&#39;</span>]);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                                                <span class="keywordflow">if</span> ( isset($this-&gt;_fields[$alias]) ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                                                $this-&gt;_grafted_fields[$alias] = $this-&gt;_newSchema(<span class="stringliteral">&#39;varchar(32)&#39;</span>, $alias);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                                $this-&gt;_grafted_fields[$alias][<span class="stringliteral">&#39;grafted&#39;</span>]=1;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                                                <span class="keywordflow">if</span> ( isset($this-&gt;_atts[$alias]) and is_array($this-&gt;_atts[$alias]) ){</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                                                        </div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                                                        $this-&gt;_parseINISection($this-&gt;_atts[$alias], $this-&gt;_grafted_fields[$alias]);</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                                                }</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                                                <span class="comment">//array(&#39;Field&#39;=&gt;$alias, &#39;name&#39;=&gt;$alias, &#39;Type&#39;=&gt;&#39;varchar(32)&#39;, &#39;widget&#39;=&gt;array(&#39;label&#39;=&gt;$alias, &#39;description&#39;=&gt;&#39;&#39;));</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                                </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                        }</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                }</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                        }</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                        <span class="keywordflow">if</span> ( $includeParent ){</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                <span class="comment">// We now want to load the parent table columns as well.</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                                <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                                        $this-&gt;_grafted_fields = array_merge( $parent-&gt;fields(<span class="keyword">false</span>,<span class="keyword">true</span>), $this-&gt;_grafted_fields);</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                                }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                        }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                        $this-&gt;_cache[__FUNCTION__][intval($includeParent)] = $this-&gt;_grafted_fields;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                        </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][intval($includeParent)];</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        }</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        </div>
<div class="line"><a name="l01627"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a1b62b52d7372b6e99b33acf6af44c4bd"> 1627</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a1b62b52d7372b6e99b33acf6af44c4bd" title="Returns the transient fields in this table. Transient fields are fields that do not get saved in the ...">transientFields</a>($includeParent=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][intval($includeParent)]) ){</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_transient_fields) ){</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                                $this-&gt;_transient_fields = array();</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                                <span class="keywordflow">foreach</span> ( $this-&gt;_atts as <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>=&gt;<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> ){</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                                        <span class="keywordflow">if</span> ( !is_array(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>) ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                                        <span class="keywordflow">if</span> ( @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;transient&#39;</span>] ){</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                                $curr = array();</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                                                $this-&gt;_parseINISection(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, $curr);</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                                                <span class="keywordflow">if</span> ( @$curr[<span class="stringliteral">&#39;relationship&#39;</span>] ) $curr[<span class="stringliteral">&#39;repeat&#39;</span>] = 1;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                                                $curr = array_merge_recursive_unique($this-&gt;_global_field_properties, $curr);</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                                                $schema = $this-&gt;_newSchema(<span class="stringliteral">&#39;text&#39;</span>,<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                                                $curr = array_merge_recursive_unique($schema, $curr);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                                                $this-&gt;_transient_fields[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>] = $curr;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                                        }</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                                }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                <span class="keywordflow">if</span> ( $includeParent){</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                                        $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                                $this-&gt;_transient_fields = array_merge( $parent-&gt;transientFields(), $this-&gt;_transient_fields);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                                        }</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                                }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                        }</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                        $this-&gt;_cache[__FUNCTION__][intval($includeParent)] =&amp; $this-&gt;_transient_fields;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                        </div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                </div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                }</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                <span class="comment">//return $this-&gt;_transient_fields;</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][intval($includeParent)];</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        }</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keyword">function</span> _hasFieldsIniFile(){</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                <span class="keywordflow">return</span> file_exists( $this-&gt;_fieldsIniFilePath() );</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        </div>
<div class="line"><a name="l01679"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ad2a215c69edc046d5d9a30681c041b85"> 1679</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ad2a215c69edc046d5d9a30681c041b85" title="Returns calculated fields defined in the delegate class via the field__fieldname() method naming conv...">delegateFields</a>($includeParent=<span class="keyword">false</span>){</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][intval($includeParent)]) ){</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                <span class="comment">//if ( !isset($this-&gt;_transient_fields) ){</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array();</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                        </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                        $del =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                        <span class="keywordflow">if</span> ( isset($del) ){</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                                $delegate_methods = get_class_methods(get_class($del));</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                                </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                                $delegate_fields = preg_grep(<span class="stringliteral">&#39;/^field__/&#39;</span>, $delegate_methods);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                                </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                                <span class="keywordflow">foreach</span> ($delegate_fields as $dfield){</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                                        $dfieldname = substr($dfield,7);</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$dfieldname] = $this-&gt;_newSchema(<span class="stringliteral">&#39;varchar(32)&#39;</span>, $dfieldname);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$dfieldname][<span class="stringliteral">&#39;visibility&#39;</span>][<span class="stringliteral">&#39;browse&#39;</span>] = <span class="stringliteral">&#39;hidden&#39;</span>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                                        <span class="keywordflow">if</span> ( isset($this-&gt;_atts[$dfieldname]) and </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                                                 is_array($this-&gt;_atts[$dfieldname]) ){</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                                                $this-&gt;_parseINISection($this-&gt;_atts[$dfieldname], <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$dfieldname]);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                                                </div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                                        }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                                        </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                                        </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                                }</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                                </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                                </div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                                <span class="keywordflow">if</span> ( $includeParent){</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                                        $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                                                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array_merge( $parent-&gt;delegateFields(), <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                                        }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                                }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                        }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                        $this-&gt;_cache[__FUNCTION__][intval($includeParent)] = <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                        </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                </div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                <span class="comment">//return $this-&gt;_transient_fields;</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][intval($includeParent)];</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        </div>
<div class="line"><a name="l01730"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aac66f1670a1258beaf6f5278880d269c"> 1730</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aac66f1670a1258beaf6f5278880d269c" title="Returns the SQL query used to fetch records of this table, if defined.">sql</a>(){</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                $del =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                <span class="keywordflow">if</span> ( isset($del) and method_exists($del,<span class="stringliteral">&#39;__sql__&#39;</span>) ){</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                        <span class="keywordflow">return</span> $del-&gt;__sql__();</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($this-&gt;_sql) ){</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_sql;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                }</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        </div>
<div class="line"><a name="l01757"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a388f3743da67a0dbf373a4d6c030c186"> 1757</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a388f3743da67a0dbf373a4d6c030c186" title="Returns the name of the VIEW to be used for reading records from the database. This feature is new in...">getProxyView</a>(){</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;XATAFACE_DISABLE_PROXY_VIEWS&#39;</span>) and XATAFACE_DISABLE_PROXY_VIEWS ){</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                }</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                $sql = $this-&gt;<a class="code" href="class_dataface___table.html#aac66f1670a1258beaf6f5278880d269c" title="Returns the SQL query used to fetch records of this table, if defined.">sql</a>();</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                <span class="comment">// If there is no custom SQL then there is no point using a view at all</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                <span class="keywordflow">if</span> ( !$sql ){</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                $sqlKey = md5($sql);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                $viewName = <span class="stringliteral">&#39;dataface__view_&#39;</span>.md5($this-&gt;tablename.<span class="charliteral">&#39;_&#39;</span>.$sqlKey);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;_proxyViews[$viewName]) and $this-&gt;_proxyViews[$viewName]) <span class="keywordflow">return</span> $viewName;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($this-&gt;_proxyViews[$viewName]) and !$this-&gt;_proxyViews[$viewName]) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                </div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>()-&gt;getMySQLMajorVersion() &lt; 5 ){</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                        $this-&gt;_proxyViews[$viewName] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                }</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                </div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;multilingual_content&#39;</span>] and $this-&gt;getTranslations() ){</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                        $this-&gt;_proxyViews[$viewName] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                <span class="comment">//$app = Dataface_Application::getInstance();</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                <span class="comment">//$dbname = $app-&gt;_conf[&#39;_database&#39;][&#39;name&#39;];</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                <span class="comment">// Check if view already exists</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                <span class="comment">//$res = mysql_query(&quot;select TABLE_NAME from information_schema.tables where TABLE_SCHEMA=&#39;&quot;.addslashes($dbname).&quot;&#39; and TABLE_NAME=&#39;&quot;.addslashes($viewName).&quot;&#39; limit 1&quot;, df_db());</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                </div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                $res = mysql_query(<span class="stringliteral">&quot;show tables like &#39;&quot;</span>.addslashes($viewName).<span class="stringliteral">&quot;&#39;&quot;</span>, df_db());</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                <span class="keywordflow">if</span> ( !$res ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(mysql_error(df_db()));</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                <span class="keywordflow">if</span> ( mysql_num_rows($res) &lt; 1 ){</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                        @mysql_free_result($res);</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                        <span class="comment">// The view doesn&#39;t exist yet</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;create view `&quot;</span>.str_replace(<span class="charliteral">&#39;`&#39;</span>,<span class="stringliteral">&#39;&#39;</span>, $viewName).<span class="stringliteral">&quot;` as &quot;</span>.$sql, df_db());</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                                error_log(mysql_error(df_db()));</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                                $this-&gt;_proxyViews[$viewName] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;                                <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                        }</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                                </div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                        </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                        @mysql_free_result($res);</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                }</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                $this-&gt;_proxyViews[$viewName] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                <span class="keywordflow">return</span> $viewName;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        </div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        </div>
<div class="line"><a name="l01823"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7"> 1823</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7" title="Returns reference to the keys array that contains field definitions for keys.">keys</a>(){</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_keys;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        </div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        </div>
<div class="line"><a name="l01834"></a><span class="lineno"><a class="code" href="class_dataface___table.html#abb1240d4b8d4521d783a58d9b1f1df0a"> 1834</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#abb1240d4b8d4521d783a58d9b1f1df0a" title="Checks to see if the specified field is part of the primary key.">hasKey</a>($name){</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_fields[$name] ) ) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                <span class="keywordflow">if</span> ( isset( $this-&gt;_fields[$name][<span class="stringliteral">&#39;Key&#39;</span>] ) &amp;&amp; strtolower($this-&gt;_fields[$name][<span class="stringliteral">&#39;Key&#39;</span>]) == strtolower(<span class="stringliteral">&#39;PRI&#39;</span>) ){</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                }</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        </div>
<div class="line"><a name="l01856"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ad85a48f4ec638e82d6a075e7ccaf4bbe"> 1856</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ad85a48f4ec638e82d6a075e7ccaf4bbe" title="A list of the keys that are NOT auto incremented.">mandatoryFields</a>(){</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array();</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($this-&gt;<a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7" title="Returns reference to the keys array that contains field definitions for keys.">keys</a>()) as $key){</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_fields[$key][<span class="stringliteral">&#39;Extra&#39;</span>] == <span class="stringliteral">&#39;auto_increment&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                        <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[ $key ] =&amp; $this-&gt;_fields[$key];</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                </div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        </div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        }</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        </div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        </div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        </div>
<div class="line"><a name="l01877"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac056864127dfe76157b56a57b2a9336e"> 1877</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ac056864127dfe76157b56a57b2a9336e" title="Returns the default value for a field.">getDefaultValue</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                <span class="keywordflow">if</span> ( @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;tablename&#39;</span>] and <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;tablename&#39;</span>] != $this-&gt;tablename ){</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                        <span class="comment">// Some fields may have been taken from another table.</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                        <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; self::loadTable(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;tablename&#39;</span>]);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getDefaultValue(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                }</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                <span class="keywordflow">if</span> ( isset($delegate) and method_exists($delegate, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__default&#39;</span>) ){</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                        <span class="keywordflow">return</span> call_user_func(array(&amp;$delegate, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__default&#39;</span>));</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Default&#39;</span>] ){</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Default&#39;</span>];</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                        <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                }</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        }</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        </div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        </div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keyword">function</span> &amp;getFieldsConfig(){</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_fieldsConfig;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        }</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="keyword">function</span> _newSchema($type, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>=null, $permissions = null){</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">                                 Example row as follows:</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">                                 Array</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">                                (</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">                                        [Field] =&gt; id</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">                                        [Type] =&gt; int(7)</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">                                        [Null] =&gt;  </span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">                                        [Key] =&gt; PRI</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">                                        [Default] =&gt;</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">                                        [Extra] =&gt; auto_increment</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">                )</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">                */</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                <span class="keywordflow">if</span> ( !isset(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>) ) <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a> = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                <span class="keywordflow">if</span> ( !isset($permissions) and is_a($this, <span class="stringliteral">&#39;Dataface_Table&#39;</span>) ){</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                        $permissions = <a class="code" href="class_dataface___permissions_tool.html#a0f09438de04a139cb31716ae52bb6fce">Dataface_PermissionsTool::getRolePermissions</a>($this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;default_field_role&#39;</span>]);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !isset($permissions) ){</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                        $permissions = <a class="code" href="class_dataface___permissions_tool.html#a942c2c2be7a0a162408a9a5bdedd7339">Dataface_PermissionsTool::READ_ONLY</a>();</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                }</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                $schema = array(<span class="stringliteral">&quot;Field&quot;</span>=&gt;<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, <span class="stringliteral">&quot;Type&quot;</span>=&gt;$type, <span class="stringliteral">&quot;Null&quot;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&quot;Key&quot;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&quot;Default&quot;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&quot;Extra&quot;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                $schema = array_merge_recursive_unique($this-&gt;_global_field_properties, $schema);</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                $widget = array();</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                $widget[<span class="stringliteral">&#39;label&#39;</span>] = ucfirst($schema[<span class="stringliteral">&#39;Field&#39;</span>]);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                $widget[<span class="stringliteral">&#39;description&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                $widget[<span class="stringliteral">&#39;label_i18n&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>.<span class="charliteral">&#39;.&#39;</span>.<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;.label&#39;</span>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                $widget[<span class="stringliteral">&#39;description_i18n&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>.<span class="charliteral">&#39;.&#39;</span>.<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;.description&#39;</span>;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                $widget[<span class="stringliteral">&#39;macro&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                $widget[<span class="stringliteral">&#39;helper_css&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                $widget[<span class="stringliteral">&#39;helper_js&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                $widget[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;text&#39;</span>;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                $widget[<span class="stringliteral">&#39;atts&#39;</span>] = array();      <span class="comment">//html attributes</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/text/&#39;</span>, $schema[<span class="stringliteral">&#39;Type&#39;</span>]) ){</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                        $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;textarea&#39;</span>;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>  ( preg_match( <span class="stringliteral">&#39;/blob/&#39;</span>, $schema[<span class="stringliteral">&#39;Type&#39;</span>]) ){</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                        $widget[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;file&#39;</span>;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                }</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                $schema[<span class="stringliteral">&#39;widget&#39;</span>] =&amp; $widget;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                $schema[<span class="stringliteral">&#39;tab&#39;</span>] = <span class="stringliteral">&#39;__main__&#39;</span>;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                $schema[<span class="stringliteral">&#39;tablename&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                $schema[<span class="stringliteral">&#39;tableta&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                $schema[<span class="stringliteral">&#39;vocabulary&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                $schema[<span class="stringliteral">&#39;enforceVocabulary&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                $schema[<span class="stringliteral">&#39;validators&#39;</span>] = array();</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                $schema[<span class="stringliteral">&#39;name&#39;</span>] = $schema[<span class="stringliteral">&#39;Field&#39;</span>];</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                $schema[<span class="stringliteral">&#39;permissions&#39;</span>] = $permissions;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                $schema[<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                $schema[<span class="stringliteral">&#39;visibility&#39;</span>] = array(<span class="stringliteral">&#39;list&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>, <span class="stringliteral">&#39;browse&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>, <span class="stringliteral">&#39;find&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                $schema = array_merge_recursive_unique($schema, $this-&gt;_global_field_properties);</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                <span class="keywordflow">return</span> $schema;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        }</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        </div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        </div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        </div>
<div class="line"><a name="l02002"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac5c99282f21752d660f95f007a0ac6a5"> 2002</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ac5c99282f21752d660f95f007a0ac6a5" title="A valid SQL select phrase for a single column. This will be used when extracting the titles of each r...">titleColumn</a>(){</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                <span class="keywordflow">if</span> (!isset( $this-&gt;_atts[<span class="stringliteral">&#39;title&#39;</span>] ) ){</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                        $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                        <span class="keywordflow">if</span> ( $delegate !== null and method_exists($delegate, <span class="stringliteral">&#39;titleColumn&#39;</span>) ){</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                                $this-&gt;_atts[<span class="stringliteral">&#39;title&#39;</span>] = $delegate-&gt;titleColumn();</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                                $bestCandidate = null;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                $this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>();</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                                $fieldnames = array_keys($this-&gt;_fields);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                                <span class="keywordflow">foreach</span> ($fieldnames as <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;_fields[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>];</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                                        <span class="keywordflow">if</span> ( $bestCandidate === null and $this-&gt;<a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b" title="Checks to see if the field is a character field (i.e. varchar or char).">isChar</a>($fieldname) ){</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                                                $bestCandidate = <span class="charliteral">&#39;`&#39;</span>.$fieldname.<span class="charliteral">&#39;`&#39;</span>;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                                        }</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                                        <span class="comment">//if ( strpos(strtolower($fieldname),&#39;title&#39;) !== false ){</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                                        <span class="comment">//      $bestCandidate = $fieldname;</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                                        <span class="comment">//}</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                                }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                                <span class="keywordflow">if</span> ( $bestCandidate === null ){</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                                        $keynames = array_keys($this-&gt;<a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7" title="Returns reference to the keys array that contains field definitions for keys.">keys</a>());</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                                        $bestCandidate = <span class="stringliteral">&quot;CONCAT(`&quot;</span>.implode(<span class="stringliteral">&quot;`,`&quot;</span>, $keynames).<span class="stringliteral">&quot;`)&quot;</span>;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                                }</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                                $this-&gt;_atts[<span class="stringliteral">&#39;title&#39;</span>] = $bestCandidate;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                        }</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                }</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_atts[<span class="stringliteral">&#39;title&#39;</span>];</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        </div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;        }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                </div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        </div>
<div class="line"><a name="l02043"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce"> 2043</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                <span class="keywordflow">if</span> ( count(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>)==1){</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $this-&gt;_fields[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>]) ){</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                                </div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                                <span class="keywordflow">if</span> ( $delegate !== null and method_exists($delegate, <span class="stringliteral">&quot;field__$fieldname&quot;</span>)){</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                                        <span class="keywordflow">if</span> ( isset($this-&gt;_atts[$fieldname]) ){</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                                                $schema = array_merge_recursive_unique($this-&gt;_newSchema(<span class="stringliteral">&#39;calculated&#39;</span>,$fieldname), $this-&gt;_atts[$fieldname]);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                                                $schema = $this-&gt;_newSchema(<span class="stringliteral">&#39;calculated&#39;</span>, $fieldname);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                                        }</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                                        <span class="keywordflow">return</span> $schema;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                                }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                                $grafted =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa0b8971353bd0c3375dfb0ebb0a3c074" title="Field definitions of fields that have been grafted onto this table.">graftedFields</a>();</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                                <span class="keywordflow">if</span> ( isset($grafted[$fieldname]) ) <span class="keywordflow">return</span> $grafted[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>];</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                                </div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                                $transient =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a1b62b52d7372b6e99b33acf6af44c4bd" title="Returns the transient fields in this table. Transient fields are fields that do not get saved in the ...">transientFields</a>();</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                                <span class="keywordflow">if</span> ( isset($transient[$fieldname]) ) <span class="keywordflow">return</span> $transient[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>];</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                                </div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                                <span class="keywordflow">if</span> ( isset($parent) and ( <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $parent-&gt;getField($fieldname) ) ){</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                                        <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>) ) <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                                }</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                                </div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                                $err = <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">SCHEMA_NO_SUCH_FIELD_ERROR</a>,null,null,null, <span class="stringliteral">&quot;Field $fieldname does not exist in table &quot;</span>.$this-&gt;tablename);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                                </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                                <span class="keywordflow">return</span> $err;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                        }</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_fields[<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>];</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                        <span class="comment">// this field is from a relationship.</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                        </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                        <span class="comment">// first check the cache</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $this-&gt;_relatedFields[<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[0]] ) ) $this-&gt;_relatedFields[$path[0]] = array();</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $this-&gt;_relatedFields[$path[0]][$path[1]] ) ) {</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                                </div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                                $relationship =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a32cd7fb65770f8572428933c5b00d8c5" title="Gets a relationship by name.">getRelationship</a>($path[0]);</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                                </div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($relationship) ){</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                                        $err = <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a9aba324e3dbb0fb46ef986334f8d6db1">SCHEMA_NO_SUCH_FIELD_ERROR</a>,null,null,null, <span class="stringliteral">&quot;Field $fieldname does not exist in table &quot;</span>.$this-&gt;tablename);</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                                        <span class="keywordflow">return</span> $err;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                                }</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                                </div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                                $this-&gt;_relatedFields[$path[0]][$path[1]] =&amp; $relationship-&gt;getField($path[1]); <span class="comment">//Dataface_Table::getTableField($absolute_name);</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                        }</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                        </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_relatedFields[$path[0]][$path[1]];</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                        </div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                }</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        </div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        }</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        </div>
<div class="line"><a name="l02116"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555"> 2116</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a84592faacffaa1c4921be49fdfb14555" title="This method returns a property associated with a field, that is defined in the fields.ini file. This method also checks the delegate class to see if an equivalent property method has been defined. Delegate class method names will be of the form &lt;field_name&gt;__&lt;property_name&gt;(). Note that in the case where the property name contains illegal characters (e.g., &#39;:&#39;), the character will be replaced by an underscore ( i.e., &#39;_&#39;).">getFieldProperty</a>($propertyName, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $params=array()){</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                </div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;tablename&#39;</span>] != $this-&gt;tablename ){</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                        <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; self::loadTable(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;tablename&#39;</span>]);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getFieldProperty($propertyName, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $params);</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                }</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#ab10d895244a666856f2a51600754fed3" title="Returns the Table object that contains a specified field. The fieldname is given as a relationship pa...">getTableTableForField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;tablename !== <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;tablename ){</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                        <span class="comment">// THis is a related field so we will have to check the delegate </span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                        <span class="comment">// class for that table.</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                        list(<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getFieldProperty($propertyName,<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $params);</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                }</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                </div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                <span class="comment">// First we will see if the delegate class defines as custom description.</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                $delegate_property_name = str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $propertyName);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                <span class="keywordflow">if</span> ( method_exists($delegate, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__&#39;</span>.$delegate_property_name) ){</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                        </div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $params[<span class="stringliteral">&#39;record&#39;</span>] ) ) $params[<span class="stringliteral">&#39;record&#39;</span>] = null;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                        $methodname = <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__&#39;</span>.$delegate_property_name;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                        $res =&amp; $delegate-&gt;$methodname($params[<span class="stringliteral">&#39;record&#39;</span>], $params);</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                        <span class="comment">//$res =&amp; call_user_func(array(&amp;$delegate, $fieldname.&#39;__&#39;.$delegate_property_name), $params[&#39;record&#39;], $params);</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                        </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                        <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($res) || $res-&gt;getCode() !== <a class="code" href="_error_8php.html#a92b5fd61ad09b3f80ab10d9a3f6d511c">DATAFACE_E_REQUEST_NOT_HANDLED</a> ){</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                                <span class="keywordflow">return</span> $res;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                        }</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                } </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                <span class="comment">// The delegate class doesn&#39;t define a custom description</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                <span class="comment">// we will just pull the property from the schema</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = explode(<span class="charliteral">&#39;:&#39;</span>, $propertyName);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                $arr =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                <span class="keywordflow">while</span> ( count(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>)&gt; 0 ){</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                        $temp =&amp; $arr[array_shift(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>)];</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                        unset($arr);</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                        $arr =&amp; $temp;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                        unset($temp);</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                }</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                <span class="keywordflow">return</span> $arr;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        }</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        </div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        </div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        </div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        </div>
<div class="line"><a name="l02170"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a8bc21e1c8ce842d8a25aefd2a0b92f93"> 2170</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a8bc21e1c8ce842d8a25aefd2a0b92f93" title="Returns the name of the field that is auto incrementing (if it exists).">getAutoIncrementField</a>(){</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                <span class="keywordflow">foreach</span> (array_keys($this-&gt;<a class="code" href="class_dataface___table.html#a089354ac4894b0a176ce7772fc84edb7" title="Returns reference to the keys array that contains field definitions for keys.">keys</a>()) as <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>){</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                        <span class="keywordflow">if</span> (strtolower($this-&gt;_fields[$field][<span class="stringliteral">&#39;Extra&#39;</span>]) == <span class="stringliteral">&#39;auto_increment&#39;</span>){</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                        }</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                }</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> $globalFieldsConfig = null;</div>
<div class="line"><a name="l02180"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a717cbfc2e3b693222f3d606e4ae2ee69"> 2180</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a717cbfc2e3b693222f3d606e4ae2ee69">getGlobalFieldsConfig</a>(){</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                <span class="keywordflow">if</span> ( !isset(self::$globalFieldsConfig) ){</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                        <span class="comment">//self::$globalFieldsConfig = array();</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                        <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                        $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                        self::$globalFieldsConfig =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;fields&#39;</span>, null);</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                        </div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                }</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                <span class="comment">//print_r(self::$globalFieldsConfig);</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                <span class="keywordflow">return</span> self::$globalFieldsConfig;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        </div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        </div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        </div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        <span class="keyword">function</span> _loadFieldsIniFile(){</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                $conf =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;fields&#39;</span>, $this-&gt;tablename); <span class="comment">//$temp[&#39;root&#39;];</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                $gConf =&amp; self::getGlobalFieldsConfig();</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                $conf = array_merge($gConf, $conf);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                $appDel =&amp; $app-&gt;getDelegate();</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                <span class="keywordflow">if</span> ( method_exists($appDel,<span class="stringliteral">&#39;decorateFieldsINI&#39;</span>) ){</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                        $appDel-&gt;decorateFieldsINI($conf, $this);</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                }</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                </div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                $this-&gt;_global_field_properties = array();</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                <span class="keywordflow">if</span> ( isset($conf[<span class="stringliteral">&#39;__global__&#39;</span>]) ) $this-&gt;_parseINISection($conf[<span class="stringliteral">&#39;__global__&#39;</span>], $this-&gt;_global_field_properties);</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                <span class="keywordflow">else</span> $this-&gt;_global_field_properties = array();</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                <span class="comment">//print_r($this-&gt;_fields);</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;_fields as $key=&gt;$val){</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                        <span class="keywordflow">if</span> ( isset($conf[$key]) ){</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                                $conf[$key] = array_merge_recursive_unique($this-&gt;_global_field_properties, $conf[$key]);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                $conf[$key] = $this-&gt;_global_field_properties;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                        }</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                        <span class="comment">//$conf[$key] = array_merge_recursive_unique($this-&gt;_global_field_properties, $conf[$key]);</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                }</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                <span class="keywordflow">foreach</span> ($conf as $key=&gt;$value ){</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                        <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__sql__&#39;</span> and !is_array($value) ){</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                                $this-&gt;_sql = $value;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                        }</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                        </div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                        <span class="keywordflow">if</span> ( is_array($value) and @$value[<span class="stringliteral">&#39;decorator&#39;</span>] ){</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                                $event = <span class="keyword">new</span> StdClass;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                                $event-&gt;key = $key;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                                $event-&gt;conf =&amp; $value;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                                $event-&gt;table = $this;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                                </div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                                $app-&gt;fireEvent($value[<span class="stringliteral">&#39;decorator&#39;</span>].<span class="stringliteral">&#39;__decorateConf&#39;</span>, $event);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                                </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                        }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                        </div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                        <span class="keywordflow">if</span> ( is_array($value) ){</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                                </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                        </div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                                <span class="keywordflow">if</span> ( isset($value[<span class="stringliteral">&#39;extends&#39;</span>]) and isset($conf[$value[<span class="stringliteral">&#39;extends&#39;</span>]]) ){</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                                        $conf[$key] = array_merge($conf[$value[<span class="stringliteral">&#39;extends&#39;</span>]], $value);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                                        $value = $conf[$key];</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                                }</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                                </div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                                <span class="keywordflow">if</span> ( isset($value[<span class="stringliteral">&#39;Type&#39;</span>]) ){</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                                        </div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                                        $ftype = strtolower(preg_replace(<span class="stringliteral">&#39;/\(.*$/&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$value[<span class="stringliteral">&#39;Type&#39;</span>]));</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                                        <span class="comment">//echo $ftype;</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                                        <span class="keywordflow">if</span> ( isset($conf[<span class="charliteral">&#39;/&#39;</span>.$ftype]) ){</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                                                $conf[$key] = $value = array_merge($conf[<span class="charliteral">&#39;/&#39;</span>.$ftype], $value);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                                                <span class="comment">//print_r($value);</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                        }</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                                </div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                                }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                        }</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                        </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment">                         * Iterate through all of the fields.</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                        $matches = array(); <span class="comment">// temp holder for preg matches</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/fieldgroup:(.+)/&#39;</span>, $key, $matches) ){</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                <span class="comment">// This is a group description - not a field description</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                $this-&gt;_fieldgroups[trim($matches[1])] = $value;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                $this-&gt;_fieldgroups[trim($matches[1])][<span class="stringliteral">&#39;name&#39;</span>] = $matches[1];</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                                </div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                                $grp =&amp; $this-&gt;_fieldgroups[trim($matches[1])];</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                                <span class="keywordflow">foreach</span> ($grp as $grpkey=&gt;$grpval){</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                                        $tmp = explode(<span class="charliteral">&#39;:&#39;</span>,$grpkey);</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                        <span class="keywordflow">switch</span> (count($tmp)){</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                                                <span class="keywordflow">case</span> 2: $grp[$tmp[0]][$tmp[1]] =&amp; $grp[$grpkey]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                                                <span class="keywordflow">case</span> 3: $grp[$tmp[0]][$tmp[1]][$tmp[2]] =&amp; $grp[$grpkey]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                                                <span class="keywordflow">case</span> 4: $grp[$tmp[0]][$tmp[1]][$tmp[2]][$tmp[3]] =&amp; $grp[$grpkey]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                                                <span class="keywordflow">case</span> 5: $grp[$tmp[0]][$tmp[1]][$tmp[2]][$tmp[3]][$tmp[4]] =&amp; $grp[$grpkey]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                                        }</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                                }</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                                </div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $grp[<span class="stringliteral">&#39;label&#39;</span>] ) ) $grp[<span class="stringliteral">&#39;label&#39;</span>] = ucfirst($grp[<span class="stringliteral">&#39;name&#39;</span>]);</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $grp[<span class="stringliteral">&#39;description&#39;</span>]) ) $grp[<span class="stringliteral">&#39;description&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $grp[<span class="stringliteral">&#39;display&#39;</span>]) ) $grp[<span class="stringliteral">&#39;display&#39;</span>] = <span class="stringliteral">&quot;inline&quot;</span>;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $grp[<span class="stringliteral">&#39;element_label_visible&#39;</span>])) {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                                        $grp[<span class="stringliteral">&#39;element_label_visible&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                                <span class="keywordflow">if</span> ( !isset($grp[<span class="stringliteral">&#39;element_description_visible&#39;</span>])){</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                                        $grp[<span class="stringliteral">&#39;element_description_visible&#39;</span>] = </div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                                                ($grp[<span class="stringliteral">&#39;display&#39;</span>] == <span class="stringliteral">&#39;inline&#39;</span> ? <span class="keyword">false</span> : <span class="keyword">true</span>);</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                                        </div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                                }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                                </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                                <span class="comment">// Now do the translation stuff</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                                $grp[<span class="stringliteral">&#39;label&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fieldgroups.&#39;</span>.$grp[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39;.label&#39;</span>, $grp[<span class="stringliteral">&#39;label&#39;</span>]);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                                $grp[<span class="stringliteral">&#39;description&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fieldgroups.&#39;</span>.$grp[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39;.description&#39;</span>, $grp[<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                                <span class="keywordflow">if</span> ( !isset($grp[<span class="stringliteral">&#39;order&#39;</span>]) ) $grp[<span class="stringliteral">&#39;order&#39;</span>] = 0;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                                unset($grp);</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                        } </div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                        </div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/tab:(.+)/&#39;</span>, $key, $matches) ){</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                                <span class="comment">// This is a tab description</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                                $tabname = trim($matches[1]);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                                $this-&gt;_parseINISection($value, $this-&gt;_tabs[$tabname]);</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                                $tabarr =&amp; $this-&gt;_tabs[$tabname];</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                                $tabarr[<span class="stringliteral">&#39;name&#39;</span>] = $tabname;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                                </div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                                <span class="keywordflow">if</span> ( !isset($tabarr[<span class="stringliteral">&#39;label&#39;</span>]) ) $tabarr[<span class="stringliteral">&#39;label&#39;</span>] = ucfirst($tabname);</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                                <span class="keywordflow">if</span> ( !isset($tabarr[<span class="stringliteral">&#39;description&#39;</span>]) ) $tabarr[<span class="stringliteral">&#39;description&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                                </div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                                unset($tabarr);</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                                </div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                        </div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                        }</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                        </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&quot;__filters__&quot;</span>){</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                <span class="comment">// THis is a filter to be added to queries of this table.</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                                $this-&gt;_filters=$value;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                        </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                        }</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                        </div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($key == <span class="stringliteral">&quot;__title__&quot;</span>){</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                                $this-&gt;_atts[<span class="stringliteral">&#39;title&#39;</span>] = $value;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                        }</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                        </div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__join__&#39;</span> ){</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                                $this-&gt;_joinTables = $value;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                        </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                        }</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                        </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strpos($key, <span class="charliteral">&#39;:&#39;</span>) &gt; 0 ){</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                                <span class="comment">// This is the definition of a subfield (ie: a field within a</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                                <span class="comment">// table.</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                                list($parent, $child) = explode(<span class="charliteral">&#39;:&#39;</span>, $key);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $this-&gt;_fields[$parent] ) ){</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Error while loading definition for subfield &#39;$key&#39; from the fields.ini file for the table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.  The field &#39;$parent&#39; does not exist.&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                                }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                                </div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;_fields[$parent];</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                                <span class="keywordflow">if</span> ( !isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;fields&#39;</span>]) ) <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;fields&#39;</span>] = array();</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                                $curr = $this-&gt;_newSchema(<span class="stringliteral">&#39;varchar(255)&#39;</span>, $child);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                                </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                                $this-&gt;_parseINISection($value, $curr);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;fields&#39;</span>][$child] =&amp; $curr;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                                unset($curr);</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                                unset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                                </div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                        </div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                        }</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                        </div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $this-&gt;_fields[ $key ] ) ){</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                                </div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;_fields[$key];</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                                $widget =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;widget&#39;</span>];</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                                $permissions =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;permissions&#39;</span>];</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                $validators =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;validators&#39;</span>];</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                                $ftype = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Type&#39;</span>];</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                                <span class="keywordflow">if</span> ( isset($value[<span class="stringliteral">&#39;Type&#39;</span>]) ) $ftype = $value[<span class="stringliteral">&#39;Type&#39;</span>];</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                                $ftype = strtolower(preg_replace(<span class="stringliteral">&#39;/\(.*$/&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$ftype));</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                                <span class="comment">//echo $ftype;</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                                <span class="keywordflow">if</span> ( isset($conf[<span class="charliteral">&#39;/&#39;</span>.$ftype]) ){</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                                        $conf[$key] = $value = array_merge($conf[<span class="charliteral">&#39;/&#39;</span>.$ftype], $value);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                        <span class="comment">//print_r($value);</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                                }</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                                </div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                                <span class="comment">// get the attributes defined in the ini file</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                                <span class="keywordflow">foreach</span> ( $value as $att =&gt; $attval ){</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                                        <span class="comment">// some of the attributes will be prefixed to indicate</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                        <span class="comment">// widget, vocabulary, etc...</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                                        $attpath = explode( <span class="stringliteral">&quot;:&quot;</span>, $att );</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                                        </div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                                        <span class="keywordflow">if</span> ( count( $attpath ) == 1 ){</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                                                <span class="comment">// there was no prefix ... attribute goes straight into table</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                                                <span class="keywordflow">if</span> ( is_array($attval) ){</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                                                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[ $att ] = $attval;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                                                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[ $att ] = trim( $attval );</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                                                        <span class="keywordflow">if</span> ( strcasecmp($att, <span class="stringliteral">&#39;key&#39;</span>) === 0 and strcasecmp($attval, <span class="stringliteral">&#39;pri&#39;</span>)===0 and !isset($this-&gt;_keys[<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;name&#39;</span>]])){</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                                                                <span class="comment">// This field is a surrogate primary key</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                                                                $this-&gt;_keys[$field[<span class="stringliteral">&#39;name&#39;</span>]] =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                                                                </div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                                                        }</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                                                }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                                                <span class="comment">// todo handle validators which can be in the form of a list</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                                                <span class="comment">// **  ** **</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                                                <span class="comment">// There was a prefix</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                                                </div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                                                <span class="keywordflow">switch</span> ( $attpath[0] ){</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                                                        <span class="keywordflow">case</span> <span class="stringliteral">&quot;widget&quot;</span>:</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                                                                <span class="keywordflow">if</span> ( count($attpath) &gt; 2 ){</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                                                                        $widget[ $attpath[1] ][ $attpath[2] ] = trim($attval);</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                                                                        $widget[ $attpath[1] ] = trim($attval);</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                                                                }</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                                                                </div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                                                        <span class="keywordflow">case</span> <span class="stringliteral">&quot;permissions&quot;</span>:</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                                                                $permissions[ $attpath[1] ] = trim($attval);</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                                                        <span class="keywordflow">case</span> <span class="stringliteral">&quot;validators&quot;</span>:</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                                                                <span class="keywordflow">if</span> ( !$attval || $attval == <span class="stringliteral">&#39;false&#39;</span> ) {</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                                                                        $validators[ $attpath[1] ] = 0;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                                                                        </div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                                                                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                                                                }</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                                                                <span class="keywordflow">if</span> ( !isset( $validators[ $attpath[1] ] ) ){</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                                                                        $validators[ $attpath[1] ] = array();</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                                                }</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                                                                <span class="keywordflow">if</span> ( count( $attpath ) &lt;= 2 ){</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                                                                        $validators[ $attpath[1] ][<span class="stringliteral">&#39;arg&#39;</span>] = trim($attval);</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                                                                        $validators[ $attpath[1] ][ $attpath[2] ] = trim($attval);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                                                                }</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                                                                <span class="keywordflow">if</span> ( !isset( $validators[ $attpath[1] ][<span class="stringliteral">&#39;message&#39;</span>] )){</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                                                                        $validators[ $attpath[1] ][<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;Illegal input for field &quot;</span>.$field[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                                                                }</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                                                                </div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                                                        <span class="keywordflow">case</span> <span class="stringliteral">&quot;visibility&quot;</span>:</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                                                                <span class="keywordflow">if</span> ( !isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;visibility&#39;</span>] ) ) <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;visibility&#39;</span>] = array(<span class="stringliteral">&#39;list&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>,</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                                                                                                                                                                                                  <span class="stringliteral">&#39;browse&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>,</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                                                                                                                                                                                                  <span class="stringliteral">&#39;find&#39;</span>=&gt;<span class="stringliteral">&#39;visible&#39;</span>);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                                                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;visibility&#39;</span>][ $attpath[1] ] = trim($attval);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                                                                </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                                                                </div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                                                        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                                                                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[$attpath[0]][$attpath[1]] = trim($attval);</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;        </div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                                                }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                                                </div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                                                </div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                        }</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                                        </div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                                        </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                                }</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                                </div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                                <span class="comment">// prevent ourselves from doing damage</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                                unset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>);</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                                unset($widget);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                                unset($permissions);</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                                unset($validators);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                                $this-&gt;_atts[$key] = $value;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                        }</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                }</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                </div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                <span class="comment">// Create missing fieldgroups</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                <span class="comment">// Explanation:  It is possible that fields reference</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                <span class="comment">// groups that don&#39;t have an explicit definition in the ini files.</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                <span class="comment">// This step creates those implicit groups.</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                <span class="keywordflow">foreach</span> (array_keys($this-&gt;_fields) as $key){</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_fields[$key][<span class="stringliteral">&#39;group&#39;</span>])  ){</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                                $grpname = $this-&gt;_fields[$key][<span class="stringliteral">&#39;group&#39;</span>];</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $this-&gt;_fieldgroups[$grpname] ) ){</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                                        $this-&gt;_fieldgroups[$grpname] = array(</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                                                <span class="stringliteral">&quot;name&quot;</span>=&gt;$grpname, </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                                                <span class="stringliteral">&quot;label&quot;</span>=&gt;df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fieldgroups.&#39;</span>.$grpname.<span class="stringliteral">&#39;.label&#39;</span>, ucfirst($grpname)),</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                                                <span class="stringliteral">&quot;description&quot;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                                                <span class="stringliteral">&quot;display&quot;</span>=&gt;<span class="stringliteral">&#39;inline&#39;</span>,</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                                                <span class="stringliteral">&quot;element_label_visible&quot;</span>=&gt;<span class="keyword">true</span>,</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                                                <span class="stringliteral">&quot;element_description_visible&quot;</span>=&gt;<span class="keyword">false</span>,</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                                                <span class="stringliteral">&#39;order&#39;</span>=&gt;0</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                                        );</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                                }</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                        }</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                        <span class="keywordflow">if</span> ( strcasecmp($this-&gt;_fields[$key][<span class="stringliteral">&#39;Type&#39;</span>], <span class="stringliteral">&#39;container&#39;</span>) === 0){</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                                <span class="comment">/*</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="comment">                                 * This field is a Container field.  We will need to set up the save path.</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment">                                 * If no save path is specified we will create a directory by the name</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">                                 * of this field inside the table&#39;s directory.</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="comment">                                 */</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                                <span class="keywordflow">if</span> ( $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;text&#39;</span> ) $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;file&#39;</span>;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                                <span class="keywordflow">if</span> ( !isset( $this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>] ) ){</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>] = $this-&gt;basePath().<span class="stringliteral">&#39;/tables/&#39;</span>.$this-&gt;tablename.<span class="charliteral">&#39;/&#39;</span>.$key;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strpos($this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>], <span class="charliteral">&#39;/&#39;</span>) !== 0 and !preg_match(<span class="stringliteral">&#39;/^[a-z0-9]{1,5}:\/\//&#39;</span>, $this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>]) ) {</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>] = DATAFACE_SITE_PATH.<span class="charliteral">&#39;/&#39;</span>.$this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>];</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                                }</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                                </div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                                <span class="keywordflow">if</span> ( !isset($this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>]) ){</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>] = str_replace(DATAFACE_SITE_PATH, DATAFACE_SITE_URL, $this-&gt;_fields[$key][<span class="stringliteral">&#39;savepath&#39;</span>]);</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                                        </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strpos( $this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>], <span class="charliteral">&#39;/&#39;</span>) !== 0 and strpos($this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>], <span class="stringliteral">&#39;http://&#39;</span>) !== 0 ){</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                                        $this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>] = DATAFACE_SITE_URL.<span class="charliteral">&#39;/&#39;</span>.$this-&gt;_fields[$key][<span class="stringliteral">&#39;url&#39;</span>];</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                                }</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                                <span class="keywordflow">if</span> ( !isset($this-&gt;_fields[$key][<span class="stringliteral">&#39;noLinkFromListView&#39;</span>]) ){</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                                    $this-&gt;_fields[$key][<span class="stringliteral">&#39;noLinkFromListView&#39;</span>] = 1;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                                }</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                        }</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                        </div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                        </div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_fields[$key][<span class="stringliteral">&#39;tab&#39;</span>]) ) $this-&gt;_fields[$key][<span class="stringliteral">&#39;tab&#39;</span>] = <span class="stringliteral">&#39;__main__&#39;</span>;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                        $tab = $this-&gt;_fields[$key][<span class="stringliteral">&#39;tab&#39;</span>];     </div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_tabs[$tab]) ){</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                                $this-&gt;_tabs[$tab] = array(<span class="stringliteral">&#39;name&#39;</span>=&gt;$tab, <span class="stringliteral">&#39;label&#39;</span>=&gt;ucfirst(str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>,$tab)), <span class="stringliteral">&#39;description&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                                </div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                        }</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                </div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                        </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;checkbox&#39;</span> and ($this-&gt;<a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>($key) || $this-&gt;<a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b" title="Checks to see if the field is a character field (i.e. varchar or char).">isChar</a>($key)) and @$this-&gt;_fields[$key][<span class="stringliteral">&#39;vocabulary&#39;</span>] ){</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                                <span class="comment">// This is a checkbox field with a vocabulary.  It should be a repeating field</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                                $this-&gt;_fields[$key][<span class="stringliteral">&#39;repeat&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                        }</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                        </div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                        $widget =&amp; $this-&gt;_fields[$key][<span class="stringliteral">&#39;widget&#39;</span>];</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                        <span class="keywordflow">switch</span> ($widget[<span class="stringliteral">&#39;type&#39;</span>]){</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                                <span class="keywordflow">case</span> <span class="stringliteral">&#39;text&#39;</span>:</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                                        <span class="keywordflow">if</span> ( !isset($widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;size&#39;</span>]) ){</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                                                <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="class_dataface___table.html#a4a7e3bdb27deaa7a039a79a59c99f436" title="Checks to see if the field is an INT field.">isInt</a>($key) or $this-&gt;<a class="code" href="class_dataface___table.html#a1e21daaeaf49239a1a5eb6a07cc64989" title="Checks to see if the field is a floating point field (i.e. float, double, tinyfloat, etc..)">isFloat</a>($key) ){</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                                                        $widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;size&#39;</span>] = 10;</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                                                        $widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;size&#39;</span>] = 30;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                                                }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                                        }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                                <span class="keywordflow">case</span> <span class="stringliteral">&#39;textarea&#39;</span>:</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                                        <span class="keywordflow">if</span> (!isset($widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;rows&#39;</span>]) ){</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                                                $widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;rows&#39;</span>] = 6;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                                        }</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                                        <span class="keywordflow">if</span> ( !isset($widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;cols&#39;</span>]) ){</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                                                $widget[<span class="stringliteral">&#39;atts&#39;</span>][<span class="stringliteral">&#39;cols&#39;</span>] = 60;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                                        }</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                        }</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                        </div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                        <span class="comment">// Now we do the translation stuff</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                        $widget[<span class="stringliteral">&#39;label&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fields.&#39;</span>.$key.<span class="stringliteral">&#39;.widget.label&#39;</span>,$widget[<span class="stringliteral">&#39;label&#39;</span>]);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                        $widget[<span class="stringliteral">&#39;description&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fields.&#39;</span>.$key.<span class="stringliteral">&#39;.widget.description&#39;</span>,$widget[<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                        <span class="keywordflow">if</span> ( isset($widget[<span class="stringliteral">&#39;question&#39;</span>]) ){</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                                $widget[<span class="stringliteral">&#39;question&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.fields.&#39;</span>.$key.<span class="stringliteral">&#39;.widget.question&#39;</span>,$widget[<span class="stringliteral">&#39;question&#39;</span>]);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                        </div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                        }</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                        <span class="comment">//$this-&gt;_fields[ $key ] = </span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                        unset($widget);</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                </div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        </div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        </div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        </div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        </div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        </div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        </div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <span class="comment">// END Fields methods</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment"></span>        <span class="keyword">function</span> readOnly(){</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        }</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        </div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        </div>
<div class="line"><a name="l02600"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a44a905b0643b451c62705cb4a1280c63"> 2600</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a44a905b0643b451c62705cb4a1280c63" title="Sets a security filter on the table. A security filter is an array of key/value pairs that are automa...">setSecurityFilter</a>($filter=null){</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                </div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                <span class="keywordflow">if</span> ( !isset($filter)){</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                        $filter = array();</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;                        $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                        $query =&amp; $app-&gt;getQuery();</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                        <span class="keywordflow">if</span> ( class_exists(<span class="stringliteral">&#39;Dataface_AuthenticationTool&#39;</span>) ){</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                                $auth =&amp; <a class="code" href="class_dataface___authentication_tool.html#a70344e265a1689f4ef67ce1bc5d889df">Dataface_AuthenticationTool::getInstance</a>();</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                                $user =&amp; $auth-&gt;getLoggedInUser();</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                                $auth = null;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                                $user = null;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                        }</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                        <span class="keywordflow">foreach</span> ($this-&gt;_filters as $key=&gt;$value){</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                                <span class="keywordflow">if</span> ( isset($this-&gt;_securityFilter[$key]) ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                                <span class="keywordflow">if</span> ( $value{0} == <span class="charliteral">&#39;$&#39;</span> ){</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                                        <span class="keywordflow">if</span> ( !$user and strpos($value, <span class="stringliteral">&#39;$user&#39;</span>) !== <span class="keyword">false</span> ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                                        eval(<span class="stringliteral">&#39;$filter[$key] = &quot;=&quot;.&#39;</span>.$value.<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( substr($value,0,4) == <span class="stringliteral">&#39;php:&#39;</span> ){</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                                        <span class="keywordflow">if</span> ( !$user and strpos($value, <span class="stringliteral">&#39;$user&#39;</span>) !== <span class="keyword">false</span> ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                                        eval(<span class="stringliteral">&#39;$filter[$key] = &quot;=&quot;.&#39;</span>.substr($value,4).<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                                        $filter[$key] = <span class="stringliteral">&quot;=&quot;</span>.$value;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                                }</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                        }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                </div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                } </div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                </div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                $this-&gt;_securityFilter = $filter;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        }</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        </div>
<div class="line"><a name="l02639"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a17db946a497591942bd7e53ef1e8a868"> 2639</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a17db946a497591942bd7e53ef1e8a868" title="Returns the security filter for this table.">getSecurityFilter</a>($filter=array()){</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                <span class="keywordflow">return</span> array_merge($this-&gt;_securityFilter, $filter);</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        }</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;         </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;         </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;         </div>
<div class="line"><a name="l02674"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a31933e90916783e262a4f4a29df2e6cd"> 2674</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a31933e90916783e262a4f4a29df2e6cd" title="Gets the permissions for a particular relationship.">getRelationshipPermissions</a>($relationshipName, $params=array()){</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                $params[<span class="stringliteral">&#39;relationship&#39;</span>] = $relationshipName;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_dataface___table.html#a2c2976d90b444715ac971add03b2d528" title="Obtains the permissions for a particular record or for this table. Parameters are passed in associati...">getPermissions</a>($params);</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        }</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        </div>
<div class="line"><a name="l02680"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a81b416e74224eb2fb0a9c1dda84610d7"> 2680</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a81b416e74224eb2fb0a9c1dda84610d7">getGroupRecordRoles</a>(<a class="code" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> $record = null){</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;            <span class="keywordflow">if</span> ( !isset($record) ){</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;            }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;            </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;            <span class="keywordflow">return</span> $record-&gt;getGroupRoles();</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;            </div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        }</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        </div>
<div class="line"><a name="l02712"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a2c2976d90b444715ac971add03b2d528"> 2712</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a2c2976d90b444715ac971add03b2d528" title="Obtains the permissions for a particular record or for this table. Parameters are passed in associati...">getPermissions</a>($params=array()){</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        </div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                <span class="comment">// First let&#39;s try to load permissions from the cache</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;                $pt =&amp; <a class="code" href="class_dataface___permissions_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_PermissionsTool::getInstance</a>();</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                $params[<span class="stringliteral">&#39;table&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                <span class="keywordflow">if</span> ( isset($params[<span class="stringliteral">&#39;record&#39;</span>]) ) $record =&amp; $params[<span class="stringliteral">&#39;record&#39;</span>];</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;                <span class="keywordflow">else</span> $record = null;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                $cachedPermissions = $pt-&gt;getCachedPermissions($record, $params);</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                <span class="keywordflow">if</span> ( isset($cachedPermissions) ) <span class="keywordflow">return</span> $cachedPermissions;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;                </div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                </div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                $appDelegate =&amp; $app-&gt;getDelegate();</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                $recordmask = @$params[<span class="stringliteral">&#39;recordmask&#39;</span>];</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                $methods = array();</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                <span class="keywordflow">if</span> ( isset($params[<span class="stringliteral">&#39;relationship&#39;</span>]) ){</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;                        <span class="keywordflow">if</span> ( isset($params[<span class="stringliteral">&#39;relationshipmask&#39;</span>]) ) $rmask =&amp; $params[<span class="stringliteral">&#39;relationshipmask&#39;</span>];</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                        <span class="keywordflow">else</span> $rmask = array();</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                        </div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                        <span class="keywordflow">if</span> ( isset($params[<span class="stringliteral">&#39;field&#39;</span>]) ){</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                                $relprefix = <span class="stringliteral">&#39;rel_&#39;</span>.$params[<span class="stringliteral">&#39;relationship&#39;</span>].<span class="stringliteral">&#39;__&#39;</span>;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$relprefix.$params[<span class="stringliteral">&#39;field&#39;</span>].<span class="stringliteral">&#39;__permissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$relprefix.$params[<span class="stringliteral">&#39;field&#39;</span>].<span class="stringliteral">&#39;__roles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$relprefix.<span class="stringliteral">&#39;__field__permissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$relprefix.<span class="stringliteral">&#39;__field__roles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                                </div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                                <span class="comment">//if ( @$params[&#39;recordmask&#39;] ) $methods[] = &#39;recordmask&#39;;</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                                <span class="keywordflow">if</span> ( @$params[<span class="stringliteral">&#39;nobubble&#39;</span>] ) $methods[] = <span class="stringliteral">&#39;break&#39;</span>;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                                        </div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                        }</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                        </div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                        </div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;rel_&#39;</span>.$params[<span class="stringliteral">&#39;relationship&#39;</span>].<span class="stringliteral">&#39;__permissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;mask&#39;</span>=&gt;&amp;$rmask, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;rel_&#39;</span>.$params[<span class="stringliteral">&#39;relationship&#39;</span>].<span class="stringliteral">&#39;__roles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;mask&#39;</span>=&gt;&amp;$rmask, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ) $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$parent, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;Dataface_Table&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                        <span class="keywordflow">if</span> ( @$params[<span class="stringliteral">&#39;nobubble&#39;</span>] ) $methods[] = <span class="stringliteral">&#39;break&#39;</span>;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                }</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($params[<span class="stringliteral">&#39;field&#39;</span>]) ){</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                        <span class="keywordflow">if</span> ( isset($record) and is_a($record, <span class="stringliteral">&#39;Dataface_Record&#39;</span>) ){</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;$pt, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPortalFieldPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                        }</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$params[<span class="stringliteral">&#39;field&#39;</span>].<span class="stringliteral">&#39;__permissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;$params[<span class="stringliteral">&#39;field&#39;</span>].<span class="stringliteral">&#39;__roles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;__field__permissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;__field__roles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ) $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$parent, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;Dataface_Table&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                        <span class="keywordflow">if</span> ( @$params[<span class="stringliteral">&#39;recordmask&#39;</span>] ) $methods[] = <span class="stringliteral">&#39;recordmask&#39;</span>;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                        <span class="keywordflow">if</span> ( @$params[<span class="stringliteral">&#39;nobubble&#39;</span>] ) $methods[] = <span class="stringliteral">&#39;break&#39;</span>;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                        </div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                }</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                <span class="comment">//if ( isset($params[&#39;recordmask&#39;]) ) $mask =&amp; $params[&#39;recordmask&#39;];</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                <span class="comment">//else $mask = array();</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="keywordflow">if</span> ( isset($record) and $record instanceof <a class="code" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> ){</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                        $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;$pt, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPortalRecordPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span>=&gt;1);</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                        <span class="keywordflow">if</span> ( $record-&gt;table()-&gt;hasField(<span class="stringliteral">&#39;__roles__&#39;</span>) ){</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                            $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;$record-&gt;table(), <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getGroupRecordRoles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>, <span class="stringliteral">&#39;partial&#39;</span> =&gt; 1);</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                        }</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                }</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                </div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>);</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$delegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getRoles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>);</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$appDelegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;permissions&#39;</span>);</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$appDelegate, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getRoles&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;roles&#39;</span>);</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                <span class="keywordflow">if</span> ( isset($parent) ) $methods[] = array(<span class="stringliteral">&#39;object&#39;</span>=&gt;&amp;$parent, <span class="stringliteral">&#39;name&#39;</span>=&gt;<span class="stringliteral">&#39;getPermissions&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;Dataface_Table&#39;</span>);</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                $perms = array();</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                <span class="keywordflow">foreach</span> ($methods as $method){</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                        <span class="keywordflow">if</span> ( $method == <span class="stringliteral">&#39;break&#39;</span> ) {</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                                <span class="keywordflow">if</span> ( !$perms ) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">return</span> $perms;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                        }</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                        <span class="keywordflow">if</span> ( $method == <span class="stringliteral">&#39;recordmask&#39;</span> and is_array($recordmask) ){</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                                <span class="comment">// If a record mask has been supplied we apply that here</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                                <span class="comment">// so that unspecified permissions in a field request will</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                                <span class="comment">// be augmented with a specified recordmask</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;                                $perms = array_merge($recordmask, $perms);</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                        }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                        <span class="keywordflow">if</span> ( isset($method[<span class="stringliteral">&#39;object&#39;</span>]) and method_exists($method[<span class="stringliteral">&#39;object&#39;</span>], $method[<span class="stringliteral">&#39;name&#39;</span>]) ){</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                                $name = $method[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;                                <span class="keywordflow">if</span> ( $method[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;Dataface_Table&#39;</span>){</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                                        $res = $method[<span class="stringliteral">&#39;object&#39;</span>]-&gt;$name(array_merge($params, array(<span class="stringliteral">&#39;nobubble&#39;</span>=&gt;1)));</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                                        $res = $method[<span class="stringliteral">&#39;object&#39;</span>]-&gt;$name($record, $params);</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                                }</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                                <span class="keywordflow">if</span> ( $method[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;roles&#39;</span> ){</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                                        $res = $this-&gt;<a class="code" href="class_dataface___table.html#a275f276bff6cb6710a546ba283bb2105" title="Resolves the pemissions for a role or list of roles.">convertRolesToPermissions</a>($res);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                                }</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                                <span class="keywordflow">if</span> ( is_array($res) ){</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                                        <span class="keywordflow">if</span> ( @$method[<span class="stringliteral">&#39;mask&#39;</span>] and is_array(@$method[<span class="stringliteral">&#39;mask&#39;</span>]) ) $res = array_merge($method[<span class="stringliteral">&#39;mask&#39;</span>], $res);</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                                        </div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                                        $perms = array_merge($res, $perms);</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                                        <span class="keywordflow">if</span> ( !@$method[<span class="stringliteral">&#39;partial&#39;</span>] and !@$res[<span class="stringliteral">&#39;__partial__&#39;</span>]){</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                                                $pt-&gt;filterPermissions($record, $perms, $params);</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                                                $pt-&gt;cachePermissions($record, $params, $perms);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                                                <span class="keywordflow">return</span> $perms;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                                        }</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                                }</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                        }</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                }</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                $res = array_merge(<a class="code" href="class_dataface___permissions_tool.html#a53a8c60bebeb3380b9389c7a6e00f4c2">Dataface_PermissionsTool::ALL</a>(), $perms);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                $pt-&gt;filterPermissions($record, $res, $params);</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                $pt-&gt;cachePermissions($record,$params,$res);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                <span class="keywordflow">return</span> $res;</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        }</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        </div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        </div>
<div class="line"><a name="l02831"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a275f276bff6cb6710a546ba283bb2105"> 2831</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a275f276bff6cb6710a546ba283bb2105" title="Resolves the pemissions for a role or list of roles.">convertRolesToPermissions</a>($roles){</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                <span class="keywordflow">if</span> ( is_array($roles) ){</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                        $perms = array();</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                        <span class="keywordflow">foreach</span> ($roles as $role){</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                                <span class="keywordflow">if</span> ( is_string($role) ){</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                                        $perms = array_merge($perms, <a class="code" href="class_dataface___permissions_tool.html#a0f09438de04a139cb31716ae52bb6fce">Dataface_PermissionsTool::getRolePermissions</a>($role));</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                                }</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                        }</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                        <span class="keywordflow">return</span> $perms;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( is_string($roles) ){</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___permissions_tool.html#a0f09438de04a139cb31716ae52bb6fce">Dataface_PermissionsTool::getRolePermissions</a>($roles);</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                }</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                </div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                <span class="keywordflow">return</span> $roles;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        </div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        </div>
<div class="line"><a name="l02853"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ae99081606d290f5bcc7840e35a56c86d"> 2853</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ae99081606d290f5bcc7840e35a56c86d" title="Loads the permissions from the permissions.ini files.">loadPermissions</a>(){</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                $this-&gt;_permissionsLoaded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                $conf =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;permissions&#39;</span>, $this-&gt;tablename);</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                $permissionsTool =&amp; <a class="code" href="class_dataface___permissions_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_PermissionsTool::getInstance</a>();</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                $permissionsTool-&gt;addPermissions($conf);</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                </div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;         </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <span class="comment">// END Permissions</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;        </div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a79239b7f9201790e10dfe3e4a1091e5f"> 2882</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a79239b7f9201790e10dfe3e4a1091e5f" title="Returns associative array of translations where the key is the 2-digit language code and the value is...">getTranslations</a>(){</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;translations === null ){</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                        $this-&gt;translations = array();</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;SHOW TABLES LIKE &#39;&quot;</span>.addslashes($this-&gt;tablename).<span class="stringliteral">&quot;%&#39;&quot;</span>, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                                </div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;                                        <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                                                <span class="stringliteral">&#39;MySQL query error loading translation tables&#39;</span>,</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                                                <span class="stringliteral">&#39;MySQL query error while trying to find translation tables for table &quot;&#39;</span>.addslashes($this-&gt;tablename).<span class="stringliteral">&#39;&quot;. &#39;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>).<span class="stringliteral">&#39;. &#39;</span>,</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;                                                array(<span class="stringliteral">&#39;sql_error&#39;</span>=&gt;mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>), <span class="stringliteral">&#39;stack_trace&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;table&#39;</span>=&gt;$this-&gt;tablename)</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                                        ),</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                                        E_USER_ERROR </div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                                </div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                                );</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                        }</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                        <span class="keywordflow">if</span> (mysql_num_rows($res) &lt;= 0 ){</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                                <span class="comment">// there should at least be the current table returned.. there is a problem</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                                <span class="comment">// if nothing was returned.</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;                                        <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                                                <span class="stringliteral">&#39;Not enough results returned loading translation tables&#39;</span>,</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                                                <span class="stringliteral">&#39;No tables were returned when trying to load translation tables for table &quot;&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;&quot;.  This query should have at least returned one record (the current table) so there must be a problem with the query.&#39;</span>,</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                                                array(<span class="stringliteral">&#39;table&#39;</span>=&gt;$this-&gt;tablename)</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                                        ),</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                                        E_USER_ERROR</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                                );</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                        }</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                        </div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                        <span class="keywordflow">while</span> ( $row = mysql_fetch_array($res ) ){</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                                <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a> = $row[0];</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a> == $this-&gt;tablename ){</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                                }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                                </div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                                $matches = array();</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                                <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/^&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;_([a-zA-Z]{2})$/&#39;</span>, <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>, $matches) ){</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                                        $this-&gt;translations[$matches[1]] = 0;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                                }</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;                                </div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;                        }</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                        mysql_free_result($res);</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                                        </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                        </div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                }</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;                <span class="keywordflow">return</span> $this-&gt;translations;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        </div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        }</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        </div>
<div class="line"><a name="l02937"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ae7545a0eea938d477e572a1a014d966a"> 2937</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ae7545a0eea938d477e572a1a014d966a" title="Returns an array of column names that are available in a given language.">getTranslation</a>($name){</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                $translations =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a79239b7f9201790e10dfe3e4a1091e5f" title="Returns associative array of translations where the key is the 2-digit language code and the value is...">getTranslations</a>();</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                <span class="keywordflow">if</span> ( isset( $translations[$name] )){</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                        <span class="comment">// the translation exists</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                        <span class="keywordflow">if</span> ( !$translations[$name]  ){</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                                <span class="comment">// the columns are not loaded yet, we need to load them.</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                                $res = mysql_query(<span class="stringliteral">&quot;SHOW COLUMNS FROM `&quot;</span>.addslashes($this-&gt;tablename).<span class="stringliteral">&quot;_&quot;</span>.addslashes($name).<span class="stringliteral">&quot;`&quot;</span>, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                                <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                                                <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                                                        <span class="stringliteral">&#39;Problem loading columns from translation table&#39;</span>,</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                                                        <span class="stringliteral">&#39;Problem loading columns from translation table for table &quot;&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;&quot; in language &quot;&#39;</span>.$name.<span class="stringliteral">&#39;&quot;. &#39;</span>,</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                                                        array(<span class="stringliteral">&#39;table&#39;</span>=&gt;$this-&gt;tablename,<span class="stringliteral">&#39;langauge&#39;</span>=&gt;$name,<span class="stringliteral">&#39;stack_trace&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;sql_error&#39;</span>=&gt;mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>))</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                                                ),</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;                                                E_USER_ERROR</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                                        );</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                                }</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                                $translations[$name] = array();</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                                <span class="keywordflow">while</span> ( $row = mysql_fetch_assoc($res) ){</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;                                        $translations[$name][] = $row[<span class="stringliteral">&#39;Field&#39;</span>];</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                                }</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;                                mysql_free_result($res);</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                        }</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                        <span class="keywordflow">return</span> $translations[$name];</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                }</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                $null = null;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        }</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        </div>
<div class="line"><a name="l02972"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a045c35a1fbb4124d5b63a72ef602fa45"> 2972</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a045c35a1fbb4124d5b63a72ef602fa45" title="Gets array of translation states available.">getTranslationStates</a>(){</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                <span class="keywordflow">return</span> array(</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                        <span class="stringliteral">&#39;o-a-c&#39;</span>=&gt;<span class="stringliteral">&#39;Original translation&#39;</span>,</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                        <span class="stringliteral">&#39;m-u-c&#39;</span>=&gt;<span class="stringliteral">&#39;Machine translation - unapproved&#39;</span>,</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                        <span class="stringliteral">&#39;m-a-c&#39;</span>=&gt;<span class="stringliteral">&#39;Machine translation - approved&#39;</span>,</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                        <span class="stringliteral">&#39;m-u-o&#39;</span>=&gt;<span class="stringliteral">&#39;Machine translation - unapproved - out of date&#39;</span>,</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                        <span class="stringliteral">&#39;m-a-o&#39;</span>=&gt;<span class="stringliteral">&#39;Machine translation - approved - out of date&#39;</span>,</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                        <span class="stringliteral">&#39;h-u-c&#39;</span>=&gt;<span class="stringliteral">&#39;Human translation - unapproved&#39;</span>,</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                        <span class="stringliteral">&#39;h-a-c&#39;</span>=&gt;<span class="stringliteral">&#39;Human translation - approved&#39;</span>,</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                        <span class="stringliteral">&#39;h-u-o&#39;</span>=&gt;<span class="stringliteral">&#39;Human translation - unapproved - out of date&#39;</span>,</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                        <span class="stringliteral">&#39;h-a-o&#39;</span>=&gt;<span class="stringliteral">&#39;Human translation - approved - out of date&#39;</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                        );</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        </div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        }</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;         </div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;         </div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        <span class="comment">// END Internationalization</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;        </div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a14c4e7420d903d3e40342266333d2ecf"> 3004</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a14c4e7420d903d3e40342266333d2ecf" title="Gets the label for this table. This is displayed in the navigation menu (table tabs).">getLabel</a>(){</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;            <span class="keywordflow">if</span> ( !@$this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>] ){</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>] = <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;            }</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;            <span class="keywordflow">if</span> ( !@$this-&gt;_atts[<span class="stringliteral">&#39;label__translated&#39;</span>]){</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;label__translated&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.label&#39;</span>, $this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>]);</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;            }</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;            <span class="keywordflow">return</span> $this-&gt;_atts[<span class="stringliteral">&#39;label&#39;</span>];</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;            </div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        }</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        </div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        </div>
<div class="line"><a name="l03029"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ad8cf547494af21baaf5d7b08334b4216"> 3029</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ad8cf547494af21baaf5d7b08334b4216" title="Returns the label for this table as a singular. Often tables are named as plurals of the entities the...">getSingularLabel</a>(){</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            <span class="keywordflow">if</span> ( !@$this-&gt;_atts[<span class="stringliteral">&#39;singular_label&#39;</span>] ){</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;singular_label&#39;</span>] = df_singularize($this-&gt;<a class="code" href="class_dataface___table.html#a14c4e7420d903d3e40342266333d2ecf" title="Gets the label for this table. This is displayed in the navigation menu (table tabs).">getLabel</a>());</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;            }</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;            <span class="keywordflow">if</span> ( !@$this-&gt;_atts[<span class="stringliteral">&#39;singular_label__translated&#39;</span>] ){</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;singular_label__translated&#39;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                $this-&gt;_atts[<span class="stringliteral">&#39;singular_label&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.singular_label&#39;</span>, $this-&gt;_atts[<span class="stringliteral">&#39;singular_label&#39;</span>]);</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                </div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;            }</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            </div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;            <span class="keywordflow">return</span> $this-&gt;_atts[<span class="stringliteral">&#39;singular_label&#39;</span>];</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        </div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        }</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;         </div>
<div class="line"><a name="l03047"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a525b26f31fd79f12577a338b51de0243"> 3047</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a525b26f31fd79f12577a338b51de0243" title="Print information about Table.">tableInfo</a>(){</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                </div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                $info = array();</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($this-&gt;<a class="code" href="class_dataface___table.html#ac6fbd345f8d78104d5588f2a40cc99c7" title="Returns reference to the fields array that contains field definitions.">fields</a>()) as <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a745e45e8706e19673d67511542ac52ce" title="Returns a field structure with the given name. This can also be related field. Simply prepend the rel...">getField</a>($fieldname);</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;                        $info[<span class="stringliteral">&#39;fields&#39;</span>][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>][<span class="stringliteral">&#39;Type&#39;</span>] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Type&#39;</span>];</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                        $info[<span class="stringliteral">&#39;fields&#39;</span>][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>][<span class="stringliteral">&#39;Extra&#39;</span>] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Extra&#39;</span>];</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                        $info[<span class="stringliteral">&#39;fields&#39;</span>][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>][<span class="stringliteral">&#39;Key&#39;</span>] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Key&#39;</span>];</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;                        $info[<span class="stringliteral">&#39;fields&#39;</span>][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>][<span class="stringliteral">&#39;widget&#39;</span>] = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;widget&#39;</span>];</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                        unset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>);  </div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;                }       </div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                <span class="keywordflow">return</span> $info;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        }</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        </div>
<div class="line"><a name="l03064"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a72415c0d9f4d189556a70972953206a2"> 3064</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a72415c0d9f4d189556a70972953206a2">databaseInfo</a>(){</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                $tables =&amp; self::loadTable(<span class="stringliteral">&#39;&#39;</span>,null,<span class="keyword">true</span>);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                $info = array();</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($tables) as <a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a> ){</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                        $info[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>] =&amp; $tables[<a class="code" href="class_dataface___table.html#ab55152af3e5453213c2891ba55a0c6d5" title="The name of the table that this table represents.  string.">$tablename</a>]-&gt;tableInfo();  </div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;                }</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;                <span class="keywordflow">return</span> $info;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        }</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;         </div>
<div class="line"><a name="l03077"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac0480e3ba08eedd919cde3c455de403d"> 3077</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ac0480e3ba08eedd919cde3c455de403d" title="Returns reference to the attributes array for this table.">attributes</a>(){</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__]) ){</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                        $atts =&amp; $this-&gt;_atts;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;                        $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;                                $atts = array_merge($parent-&gt;attributes(), $atts);</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;                        }</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                        $this-&gt;_cache[__FUNCTION__] =&amp; $atts;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                }</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__];</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        }</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        </div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        </div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;         </div>
<div class="line"><a name="l03098"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da"> 3098</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>(){</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_parentTable) ){</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_atts[<span class="stringliteral">&#39;__isa__&#39;</span>]) ){</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                                $this-&gt;_parentTable =&amp; self::loadTable($this-&gt;_atts[<span class="stringliteral">&#39;__isa__&#39;</span>]);</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;                        }</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                }</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_parentTable;</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        }</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        </div>
<div class="line"><a name="l03119"></a><span class="lineno"><a class="code" href="class_dataface___table.html#adee1c95af10b62971d6c87dd58bd27dd"> 3119</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#adee1c95af10b62971d6c87dd58bd27dd" title="Indicates whether this table is declared as implementing the given ontology.">implementsOntology</a>($ontologyName){</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;                <span class="keywordflow">return</span> (isset($this-&gt;_atts[<span class="stringliteral">&#39;__implements__&#39;</span>]) and isset($this-&gt;_atts[<span class="stringliteral">&#39;__implements__&#39;</span>][$ontologyName]));</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        }</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        </div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        </div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        </div>
<div class="line"><a name="l03131"></a><span class="lineno"><a class="code" href="class_dataface___table.html#af301236b14a9b026b808d82b9df364d2"> 3131</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#af301236b14a9b026b808d82b9df364d2" title="Returns the status of this table. Includes things like modification time, etc...">getStatus</a>(){</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;status ) ){</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="comment">                         * Get the table status - when was it last updated, etc...</span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>()-&gt;getMySQLMajorVersion() &lt; 5 ){</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                                $res = mysql_query(<span class="stringliteral">&quot;SHOW TABLE STATUS LIKE &#39;&quot;</span>.addslashes($this-&gt;tablename).<span class="stringliteral">&quot;&#39;&quot;</span>,$this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                                $dbname = <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>()-&gt;_conf[<span class="stringliteral">&#39;_database&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                                $res = mysql_query(<span class="stringliteral">&quot;select CREATE_TIME as Create_time, UPDATE_TIME as Update_time from information_schema.tables where TABLE_SCHEMA=&#39;&quot;</span>.addslashes($dbname).<span class="stringliteral">&quot;&#39; and TABLE_NAME=&#39;&quot;</span>.addslashes($this-&gt;tablename).<span class="stringliteral">&quot;&#39; limit 1&quot;</span>, df_db());</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                                </div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                        }</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Error performing mysql query to obtain status for table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;: &quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>), E_USER_ERROR);</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                        }</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                        </div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                        $this-&gt;status = mysql_fetch_array($res);</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                        mysql_free_result($res);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                } </div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                </div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                <span class="keywordflow">return</span> $this-&gt;status;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                </div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;        </div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        }</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        </div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        </div>
<div class="line"><a name="l03179"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac8441f17014cd12565d675da32ae5598"> 3179</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ac8441f17014cd12565d675da32ae5598" title="Neither INNODB tables nor views store the last updated time inside of MySQL. This wreaks havoc on cac...">getBackupModificationTimes</a>($refresh=<span class="keyword">false</span>){</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                <span class="keyword">static</span> $backup_times = 0;</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;                <span class="keywordflow">if</span> ( $backup_times === 0 or $refresh ){</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;select * from dataface__mtimes&quot;</span>, df_db());</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;                                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/IO.php&#39;</span>);</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;                                <a class="code" href="class_dataface___i_o.html#a8c0b22048828ca2a6fff889be8ac55a9">Dataface_IO::createModificationTimesTable</a>();</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;                                $res = mysql_query(<span class="stringliteral">&quot;select * from dataface__mtimes&quot;</span>, df_db());</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;                                <span class="keywordflow">if</span> ( !$res ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(mysql_error(df_db()));</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;                                </div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;                        }</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;                        $backup_times = array();</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;                        <span class="keywordflow">while</span> ( $row = mysql_fetch_assoc($res) ){</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;                                $backup_times[$row[<span class="stringliteral">&#39;name&#39;</span>]] = $row[<span class="stringliteral">&#39;mtime&#39;</span>];</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;                        }</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                        @mysql_free_result($res);</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                }</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                <span class="keywordflow">return</span> $backup_times;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        </div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;        </div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        }</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        </div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        </div>
<div class="line"><a name="l03216"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a93c06909572548e00115aa27315fe164"> 3216</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a93c06909572548e00115aa27315fe164" title="Returns an associative array mapping table names to their associated modification as a unix timestamp...">getTableModificationTimes</a>($refresh=<span class="keyword">false</span>){</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;                <span class="keyword">static</span> $mod_times = 0;</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;                <span class="keywordflow">if</span> ( $mod_times === 0 or $refresh ){ </div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                        $mod_times = array();</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;                        $app = <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                        $dbname = $app-&gt;_conf[<span class="stringliteral">&#39;_database&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;                        <span class="comment">//if ( $app-&gt;getMySQLMajorVersion() &lt; 5 ){</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                        <span class="comment">//      $res = mysql_query(&quot;show table status&quot;, df_db());</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                        <span class="comment">//} else {</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;                        <span class="comment">//      $res = mysql_query(&quot;select TABLE_NAME as Name, UPDATE_TIME as Update_time from information_schema.tables where TABLE_SCHEMA=&#39;&quot;.addslashes($dbname).&quot;&#39;&quot;, df_db());</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                        <span class="comment">//}</span></div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                        $res = mysql_query(<span class="stringliteral">&quot;show tables&quot;</span>, df_db());</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(mysql_error(df_db()));</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                        }</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                        $backup_times = null;</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                        <span class="comment">//while ( $row = mysql_fetch_assoc($res) ){</span></div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                        <span class="keywordflow">while</span> ($row = mysql_fetch_row($res) ){</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                                $row[<span class="stringliteral">&#39;Name&#39;</span>] = $row[0];</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;                                <span class="keywordflow">if</span> ( @$row[<span class="stringliteral">&#39;Update_time&#39;</span>] ){</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;                                        $mod_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]] = @strtotime($row[<span class="stringliteral">&#39;Update_time&#39;</span>]);</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;                                        <span class="keywordflow">if</span> ( !$backup_times ){</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                                                $backup_times =&amp; self::getBackupModificationTimes($refresh);</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                                        }</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;                                        <span class="keywordflow">if</span> ( isset($backup_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]]) and $backup_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]] ){</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;                                                $mod_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]] = $backup_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]];</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;                                                $mod_times[$row[<span class="stringliteral">&#39;Name&#39;</span>]] = time();</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                                                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/IO.php&#39;</span>);</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;                                                <a class="code" href="class_dataface___i_o.html#a331bb06ba508433e879b2bcd892754dc">Dataface_IO::touchTable</a>($row[<span class="stringliteral">&#39;Name&#39;</span>]);</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                                                </div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;                                        }</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;                                }</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;                        }</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;                }</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;                <span class="keywordflow">return</span> $mod_times;</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        }</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        </div>
<div class="line"><a name="l03261"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a587dcf9b68adbc319bcd37314e560a4f"> 3261</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a587dcf9b68adbc319bcd37314e560a4f" title="Returns the update time as an SQL DateTime string for this table.">getUpdateTime</a>(){</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                $status =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#af301236b14a9b026b808d82b9df364d2" title="Returns the status of this table. Includes things like modification time, etc...">getStatus</a>();</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                <span class="keywordflow">return</span> $status[<span class="stringliteral">&#39;Update_time&#39;</span>];</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        }</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        </div>
<div class="line"><a name="l03272"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a025d2a456e4890fc7642f18c18ebf755"> 3272</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a025d2a456e4890fc7642f18c18ebf755" title="Returns the creation time of this table as an SQL DateTime string.">getCreateTime</a>(){</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                $status =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#af301236b14a9b026b808d82b9df364d2" title="Returns the status of this table. Includes things like modification time, etc...">getStatus</a>();</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                <span class="keywordflow">return</span> $status[<span class="stringliteral">&#39;Create_time&#39;</span>];</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;        }</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;         </div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        <span class="comment">// END Table Info</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;        </div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l03298"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a0cee083525b341373363b1908786c7f7"> 3298</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a0cee083525b341373363b1908786c7f7" title="Checks if a valuelist is just a boolean valuelist. It will also return (via output parameters) what t...">isYesNoValuelist</a>($valuelist_name, &amp;$yes, &amp;$no){</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        </div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                $options =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#afdf21facc12f564c0bf746d1b3d74ae8" title="Returns a named valuelist in this table.">getValuelist</a>($valuelist_name);</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                <span class="keywordflow">if</span> ( !$options ) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                </div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                <span class="keywordflow">if</span> (count($options) != 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                $opt_keys = array_keys($options);</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                $yes_val = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                $no_val = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                <span class="keywordflow">foreach</span> ($opt_keys as $opt_key){</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                        <span class="keywordflow">if</span> ( stristr($opt_key,<span class="charliteral">&#39;n&#39;</span>) == $opt_key ) $no_val = $opt_key;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stristr($opt_key,<span class="charliteral">&#39;y&#39;</span>) == $opt_key) $yes_val = $opt_key;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $opt_key == <span class="stringliteral">&quot;0&quot;</span> ) $no_val = $opt_key;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $opt_key == <span class="stringliteral">&quot;1&quot;</span> ) $yes_val = $opt_key;</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( in_array(strtolower($opt_key), array(<span class="stringliteral">&#39;on&#39;</span>,<span class="stringliteral">&#39;active&#39;</span>,<span class="stringliteral">&#39;true&#39;</span>,<span class="charliteral">&#39;t&#39;</span>) ) ){</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                                $yes_val = $opt_key;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( in_array(strtolower($opt_key), array(<span class="stringliteral">&#39;off&#39;</span>,<span class="stringliteral">&#39;inactive&#39;</span>,<span class="stringliteral">&#39;false&#39;</span>,<span class="charliteral">&#39;f&#39;</span>) ) ){</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;                                $no_val = $opt_key;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;                        }</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;                }</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;                </div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;                <span class="keywordflow">if</span> ( $yes_val and $no_val ){</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;                        $yes = $yes_val;</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                        $no = $no_val;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                }</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;        </div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        }</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        </div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        </div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;        <span class="keyword">function</span> _valuelistsIniFilePath(){</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                <span class="keywordflow">return</span> $this-&gt;basePath().<span class="stringliteral">&#39;/tables/&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;/valuelists.ini&#39;</span>;</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;        }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;        </div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        <span class="keyword">function</span> _hasValuelistsIniFile(){</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                <span class="keywordflow">return</span> file_exists( $this-&gt;_valuelistsIniFilePath() );</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        }</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;         </div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        </div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;        <span class="comment">//private $_valuelistsConfig = null;</span></div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        </div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        <span class="keyword">private</span> <span class="keyword">function</span> &amp;_loadValuelistsIniFile(){</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_valuelistsConfig) ){</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                        <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                        $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                        $this-&gt;_valuelistsConfig =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;valuelists&#39;</span>, $this-&gt;tablename);</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                }</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_valuelistsConfig;</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        }</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        </div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        </div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        <span class="keyword">private</span> <span class="keyword">function</span> _loadValuelist($name){</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_valuelists) ){</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                        $this-&gt;_valuelists = array();</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                }</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;                </div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_valuelists[$name]) ){</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;                        $conf =&amp; $this-&gt;_loadValuelistsIniFile();</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                        <span class="keywordflow">if</span> ( isset($conf[$name]) ){</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;                                $vllist = $conf[$name];</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;                                $vlname = $name;</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;                                $valuelists =&amp; $this-&gt;_valuelists;</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;                                <span class="keywordflow">foreach</span> ( $vllist as $key=&gt;$value ){</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                                        <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__import__&#39;</span> ){</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;                                                <span class="comment">// we import the values from another value list.  The value of this</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;                                                <span class="comment">// entry should be in the form tablename.valuelistname</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;                                                list( $ext_table, $ext_valuelist ) = explode(<span class="charliteral">&#39;.&#39;</span>, $value);</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;                                                <span class="keywordflow">if</span> ( isset( $ext_table ) &amp;&amp; isset( $ext_valuelist ) ){</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;                                                        $ext_table =&amp; self::loadTable($ext_table, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $ext_table ) ){</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                                                        $ext_valuelist = $ext_table;</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;                                                        $ext_table =&amp; $this;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;                                                }</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                                                </div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;                                                <span class="keywordflow">if</span> ( isset( $ext_table ) ){</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                                                        $ext_valuelist = $ext_table-&gt;getValuelist( $ext_valuelist );</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;                                                        <span class="keywordflow">foreach</span> ( $ext_valuelist as $ext_key=&gt;$ext_value ){</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;                                                                $valuelists[$vlname][$ext_key] = $ext_value;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;                                                        }</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;                                                }</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                                                <span class="comment">// clean up temp variables so they don&#39;t confuse us</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;                                                <span class="comment">// in the next iteration.</span></div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;                                                unset($ext_table);</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;                                                unset($ext_table);</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                                                unset($ext_valuelist);</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;                                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__sql__&#39;</span> ) {</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;                                                <span class="comment">// we perform the sql query specified to produce our valuelist.</span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;                                                <span class="comment">// the sql query should return two columns only.  If more are </span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;                                                <span class="comment">// returned, only the first two will be used.   If one is returned</span></div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;                                                <span class="comment">// it will be used as both the key and value.</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;                                                $res = df_query($value, null, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;                                                <span class="keywordflow">if</span> ( is_array($res) ){</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                                                        <span class="comment">//while ($row = mysql_fetch_row($res) ){</span></div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;                                                        <span class="keywordflow">foreach</span> ($res as $row){</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;                                                                $valuekey = $row[0];</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                                                                $valuevalue = count($row)&gt;1 ? $row[1] : $row[0];</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;                                                                $valuelists[$vlname][$valuekey] = $valuevalue;</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;                                                                </div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                                                                <span class="keywordflow">if</span> ( count($row)&gt;2 ){</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;                                                                        $valuelists[$vlname.<span class="stringliteral">&#39;__meta&#39;</span>][$valuekey] = $row[2];</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                                                                }</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                                                        }</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;                                                        <span class="comment">//mysql_free_result($res);</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Valuelist query &#39;&quot;</span>.$value.<span class="stringliteral">&quot;&#39; failed. :&quot;</span>.mysql_error(df_db()), E_USER_NOTICE);</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;                                                }</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;                                        </div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;                                                $valuelists[$vlname][$key] = $value;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                                        }</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                                }</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;                        }</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                }</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                </div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;        }</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        </div>
<div class="line"><a name="l03450"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a432f4477ebeecd56f07917b71526d621"> 3450</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a432f4477ebeecd56f07917b71526d621">_loadValuelistsIniFile_old</a>(){</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_valuelists ) ){</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                        $this-&gt;_valuelists = array();</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                }</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;                $valuelists =&amp; $this-&gt;_valuelists;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                </div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                $conf =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;valuelists&#39;</span>, $this-&gt;tablename);</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;                </div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;                </div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;                <span class="keywordflow">foreach</span> ( $conf as $vlname=&gt;$vllist ){</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                        $valuelists[$vlname] = array();</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                        <span class="keywordflow">if</span> ( is_array( $vllist ) ){</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                                <span class="keywordflow">foreach</span> ( $vllist as $key=&gt;$value ){</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                                        <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__import__&#39;</span> ){</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;                                                <span class="comment">// we import the values from another value list.  The value of this</span></div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                                                <span class="comment">// entry should be in the form tablename.valuelistname</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                                                list( $ext_table, $ext_valuelist ) = explode(<span class="charliteral">&#39;.&#39;</span>, $value);</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;                                                <span class="keywordflow">if</span> ( isset( $ext_table ) &amp;&amp; isset( $ext_valuelist ) ){</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                                                        $ext_table =&amp; self::loadTable($ext_table, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;                                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $ext_table ) ){</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                                                        $ext_valuelist = $ext_table;</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                                                        $ext_table =&amp; $this;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                                                }</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;                                                </div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                                                <span class="keywordflow">if</span> ( isset( $ext_table ) ){</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                                                        $ext_valuelist = $ext_table-&gt;getValuelist( $ext_valuelist );</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                                                        <span class="keywordflow">foreach</span> ( $ext_valuelist as $ext_key=&gt;$ext_value ){</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                                                                $valuelists[$vlname][$ext_key] = $ext_value;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                                                        }</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                                                }</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                                                <span class="comment">// clean up temp variables so they don&#39;t confuse us</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                                                <span class="comment">// in the next iteration.</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                                                unset($ext_table);</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                                                unset($ext_table);</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                                                unset($ext_valuelist);</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;                                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $key == <span class="stringliteral">&#39;__sql__&#39;</span> ) {</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                                                <span class="comment">// we perform the sql query specified to produce our valuelist.</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                                                <span class="comment">// the sql query should return two columns only.  If more are </span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                                                <span class="comment">// returned, only the first two will be used.   If one is returned</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                                                <span class="comment">// it will be used as both the key and value.</span></div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                                                $res = df_query($value, null, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                                                <span class="keywordflow">if</span> ( is_array($res) ){</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                                                        <span class="comment">//while ($row = mysql_fetch_row($res) ){</span></div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                                                        <span class="keywordflow">foreach</span> ($res as $row){</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                                                                $valuekey = $row[0];</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;                                                                $valuevalue = count($row)&gt;1 ? $row[1] : $row[0];</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;                                                                $valuelists[$vlname][$valuekey] = $valuevalue;</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;                                                                </div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;                                                                <span class="keywordflow">if</span> ( count($row)&gt;2 ){</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;                                                                        $valuelists[$vlname.<span class="stringliteral">&#39;__meta&#39;</span>][$valuekey] = $row[2];</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;                                                                }</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                                                        }</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;                                                        <span class="comment">//mysql_free_result($res);</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;                                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Valuelist query &#39;&quot;</span>.$value.<span class="stringliteral">&quot;&#39; failed. &quot;</span>, E_USER_NOTICE);</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;                                                }</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;                                        </div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                                                $valuelists[$vlname][$key] = $value;</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                                        }</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                                }</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                        }</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                        </div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                        </div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;                }</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                </div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;        }</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;        </div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;        </div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        <span class="keyword">function</span> &amp;getValuelistsConfig(){</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_valuelistsConfig;</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        }</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        </div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;        </div>
<div class="line"><a name="l03534"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a14fd6ab8bc982ff49ed9e48e0dff5215"> 3534</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a14fd6ab8bc982ff49ed9e48e0dff5215" title="Clears the valuelist cache.">clearValuelistCache</a>(){</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                $this-&gt;_valuelists = null;</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        }</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        </div>
<div class="line"><a name="l03547"></a><span class="lineno"><a class="code" href="class_dataface___table.html#afdf21facc12f564c0bf746d1b3d74ae8"> 3547</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#afdf21facc12f564c0bf746d1b3d74ae8" title="Returns a named valuelist in this table.">getValuelist</a>( $name ){</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) ){</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                        $this-&gt;_cookedValuelists[$name] = null;</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;                        $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                        <span class="keywordflow">if</span> ( method_exists($delegate, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name) ){</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                                $res = call_user_func(array(&amp;$delegate, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name));</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;                                <span class="keywordflow">if</span> ( is_array($res) ) $this-&gt;_cookedValuelists[$name] = $res;</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;                        }</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;                        </div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;                        $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) and isset($parent) ){</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;                                $res = $parent-&gt;getValuelist($name);</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                                <span class="keywordflow">if</span> ( is_array($res) ) $this-&gt;_cookedValuelists[$name] = $res;</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                        }</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                        </div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                        $app =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                        $appdel =&amp; $app-&gt;getDelegate();</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) and isset($appdel) and method_exists($appdel, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name) ){</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                                $res = call_user_func(array(&amp;$appdel, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name));</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                                <span class="keywordflow">if</span> ( is_array($res) ) $this-&gt;_cookedValuelists[$name] = $res;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;                        }</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;                        </div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) and !isset( $this-&gt;_valuelists ) ){</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                                $this-&gt;_loadValuelistsIniFile();</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                        }</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                        $this-&gt;_loadValuelist($name);   <span class="comment">// Load the valuelist from the ini file if it is defined there</span></div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                        </div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) and isset( $this-&gt;_valuelists[$name] ) ){</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                                $this-&gt;_cookedValuelists[$name] = $this-&gt;_valuelists[$name];</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                                </div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                        } </div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                        </div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;                        <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ValuelistTool.php&#39;</span>);</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;                        <span class="keywordflow">if</span> ( !isset($this-&gt;_cookedValuelists[$name]) and <a class="code" href="class_dataface___valuelist_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ValuelistTool::getInstance</a>()-&gt;hasValuelist($name) ){</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                                </div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                                $this-&gt;_cookedValuelists[$name] = <a class="code" href="class_dataface___valuelist_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ValuelistTool::getInstance</a>()-&gt;getValuelist($name);</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                        }</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                        </div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_cookedValuelists[$name]) and isset($delegate) and method_exists($delegate, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name.<span class="stringliteral">&#39;__decorate&#39;</span>) ){</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                        </div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;                                $methodname = <span class="stringliteral">&#39;valuelist__&#39;</span>.$name.<span class="stringliteral">&#39;__decorate&#39;</span>;</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                                $this-&gt;_cookedValuelists[$name] = $delegate-&gt;$methodname($this-&gt;_cookedValuelists[$name]);</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($this-&gt;_cookedValuelists[$name]) and isset($appdel) and method_exists($appdel, <span class="stringliteral">&#39;valuelist__&#39;</span>.$name.<span class="stringliteral">&#39;__decorate&#39;</span>) ){</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                                $methodname = <span class="stringliteral">&#39;valuelist__&#39;</span>.$name.<span class="stringliteral">&#39;__decorate&#39;</span>;</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;                                $this-&gt;_cookedValuelists[$name] = $appdel-&gt;$methodname($this-&gt;_cookedValuelists[$name]);</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;                                </div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                        }</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                }</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cookedValuelists[$name];</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        }</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;        </div>
<div class="line"><a name="l03607"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a8cdc8a9cb6d7d23cad814cd88a5ba85c"> 3607</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a8cdc8a9cb6d7d23cad814cd88a5ba85c" title="Returns the valuelists in this table.">valuelists</a>(){</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                </div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_valuelists ) ){</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;                        </div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;                        $this-&gt;_loadValuelistsIniFile();</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                }</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_valuelists;</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;        }</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        </div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;        </div>
<div class="line"><a name="l03622"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a9bebd83828a6b716666f1f6a125535fc"> 3622</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a9bebd83828a6b716666f1f6a125535fc" title="Returns a list of all valuelists that are available to this table.">getAvailableValuelistNames</a>(){</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                $valuelists = array_keys($this-&gt;<a class="code" href="class_dataface___table.html#a8cdc8a9cb6d7d23cad814cd88a5ba85c" title="Returns the valuelists in this table.">valuelists</a>());</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                $delegate =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>();</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                <span class="keywordflow">if</span> ( isset($delegate) ){</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                        $delegate_methods = get_class_methods(get_class($delegate));</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;                        $valuelist_methods = preg_grep(<span class="stringliteral">&#39;/^valuelist__/&#39;</span>, $delegate_methods);</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                        <span class="keywordflow">foreach</span> ( $valuelist_methods as $method ){</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                                $valuelists[] = substr($method, 11);</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                        }</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                }</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ValuelistTool.php&#39;</span>);</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                </div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                $valuelists = array_merge($valuelists, array_keys(<a class="code" href="class_dataface___valuelist_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ValuelistTool::getInstance</a>()-&gt;<a class="code" href="class_dataface___table.html#a8cdc8a9cb6d7d23cad814cd88a5ba85c" title="Returns the valuelists in this table.">valuelists</a>()));</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;                <span class="keywordflow">return</span> $valuelists;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;        }</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        </div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;        </div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;        <span class="comment">// END Valuelists</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;        </div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        </div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;<span class="comment"></span>        <span class="keyword">function</span> _relationshipsIniFilePath(){</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;                <span class="keywordflow">return</span> $this-&gt;basePath().<span class="stringliteral">&#39;/tables/&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;/relationships.ini&#39;</span>;</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;        }</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;        </div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keyword">function</span> _hasRelationshipsIniFile(){</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;                </div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                <span class="keywordflow">return</span> file_exists( $this-&gt;_relationshipsIniFilePath() );</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        }</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;        </div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;        </div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;        <span class="keyword">function</span> _loadRelationshipsIniFile(){</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;                </div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;        </div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;                $conf =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;relationships&#39;</span>, $this-&gt;tablename); </div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                </div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;                $r =&amp; $this-&gt;_relationships;</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;                <span class="keywordflow">foreach</span> ($conf as $rel_name =&gt; $rel_values){</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;                        <span class="comment">// Case 1: The we have an array of values - meaning that this is the definition of a relationship.</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                        <span class="comment">// Right now there is only one case, but we could have cases with single entries also.</span></div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;                        <span class="keywordflow">if</span> ( strpos($rel_name, <span class="charliteral">&#39;.&#39;</span>) === <span class="keyword">false</span> and is_array( $rel_values ) ){</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;                                </div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;                                $r[$rel_name] = <span class="keyword">new</span> <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a>($this-&gt;tablename, $rel_name, $rel_values);</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( is_array($rel_values) ){</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;                                list($rel_name, $field_name) = explode(<span class="charliteral">&#39;.&#39;</span>, $rel_name);</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;                                <span class="keywordflow">if</span> ( isset($r[$rel_name]) ){</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;                                        $field_def = array();</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;                                        $this-&gt;_parseIniSection($rel_values, $field_def);</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;                                        $r[$rel_name]-&gt;setFieldDefOverride($field_name, $field_def);</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;                                }</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;                        }</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;                        </div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                }</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                </div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                $parent =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#a082e9ac00414f2c3f21aa818209033da" title="Gets the parent table of this table to help model inheritance. The parent table can be specified by t...">getParent</a>();</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;                <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                        $this-&gt;_relationships = array_merge($parent-&gt;relationships(), $this-&gt;_relationships);</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                }</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;                $this-&gt;_relationshipsLoaded = <span class="keyword">true</span>;     </div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;        </div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        }</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;        </div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;        </div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        </div>
<div class="line"><a name="l03718"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a41943e972144ca9c608212a8ee1bee83"> 3718</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a41943e972144ca9c608212a8ee1bee83" title="Adds a relationship to the table.">addRelationship</a>($name, $relationship){</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                <span class="keywordflow">if</span> ( !is_array($relationship) ){</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;In Dataface_Table::addRelationship() 2nd argument expected to be an array, but received &quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                }</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;                $this-&gt;_relationships[$name] = <span class="keyword">new</span> <a class="code" href="class_dataface___relationship.html">Dataface_Relationship</a>($this-&gt;tablename, $name, $relationship);</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;                </div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;        }</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;        </div>
<div class="line"><a name="l03732"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a2f47ea42e24c1c1845e5b3fedfd4e46c"> 3732</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a2f47ea42e24c1c1845e5b3fedfd4e46c" title="Gets the relationship that should be used as the parent relationship. This is useful for representing...">getParentRelationship</a>(){</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                $r =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>();</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;                <span class="keywordflow">if</span> ( array_key_exists(__FUNCTION__,$this-&gt;_cache) ) <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__];</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($r) as $name ){</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_relationships[$name]-&gt;isParentRelationship() ){</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;                                $this-&gt;_cache[__FUNCTION__] =&amp; $r[$name];</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;                                <span class="keywordflow">return</span> $r[$name];</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;                        }</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                }</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;                $null = null;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;        }</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;        </div>
<div class="line"><a name="l03750"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a522264705ea28fee671829ce35c0c502"> 3750</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a522264705ea28fee671829ce35c0c502" title="Gets the relationship that should be used as the children relationship. This is useful for representi...">getChildrenRelationship</a>(){</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                $r =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>();</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                <span class="keywordflow">if</span> ( array_key_exists(__FUNCTION__,$this-&gt;_cache) ) <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__];</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                <span class="keywordflow">foreach</span> ( array_keys($r) as $name ){</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                        <span class="keywordflow">if</span> ( $r[$name]-&gt;isChildrenRelationship() ){</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                                $this-&gt;_cache[__FUNCTION__] =&amp; $r[$name];</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                                <span class="keywordflow">return</span> $r[$name];</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                        }</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                }</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;                $null = null;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;                <span class="keywordflow">return</span> $null;</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;        }</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;        </div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;        </div>
<div class="line"><a name="l03774"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a4b75d75f0eae82e5946b4977a1530599"> 3774</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a4b75d75f0eae82e5946b4977a1530599" title="Gets the range of records that should be returned for a given relationship when records are returning...">getRelationshipRange</a>($relationshipName){</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;                <span class="keywordflow">if</span> ( isset( $this-&gt;_relationshipRanges[$relationshipName] ) ){</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_relationshipRanges[$relationshipName];</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                }  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_defaultRelationshipRange;</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;                }</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;        }</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        </div>
<div class="line"><a name="l03794"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ad1d1d8947ea2639ed20cc3151bb31039"> 3794</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ad1d1d8947ea2639ed20cc3151bb31039" title="Sets the range of related records that should be returned by records of this table when getting recor...">setRelationshipRange</a>($relationshipName, $lower, $upper){</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_relationshipRanges ) ) $this-&gt;_relationshipRanges = array();</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                $this-&gt;_relationshipRanges[$relationshipName] = array($lower, $upper);</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                </div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        }</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        </div>
<div class="line"><a name="l03807"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a0cd71dfa44acfa3f1a182efd4bdb187b"> 3807</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a0cd71dfa44acfa3f1a182efd4bdb187b" title="Gets the default relationship range for all relationships.">getDefaultRelationshipRange</a>(){</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_defaultRelationshipRange;</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;        }</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        </div>
<div class="line"><a name="l03817"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a02b5bd4f5f7b21a6c773739acbc31ae9"> 3817</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a02b5bd4f5f7b21a6c773739acbc31ae9" title="Sets the default relationship range to be used for all relationships.">setDefaultRelationshipRange</a>($lower, $upper){</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;                $this-&gt;_defaultRelationshipRange = array($lower, $upper);</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;        }</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;        </div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        <span class="keyword">function</span> &amp;getRelationshipsConfig(){</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_relationshipsConfig;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        }</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        </div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        </div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;        </div>
<div class="line"><a name="l03840"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a32cd7fb65770f8572428933c5b00d8c5"> 3840</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a32cd7fb65770f8572428933c5b00d8c5" title="Gets a relationship by name.">getRelationship</a>($name){</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;                $r =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>();</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                <span class="keywordflow">if</span> ( !is_string($name) ) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Relationship name is not a string&quot;</span>);</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;                <span class="keywordflow">if</span> ( !isset($r[$name]) ){</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;                        $err = <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<span class="stringliteral">&quot;Attempt to get relationship nonexistent &#39;$name&#39; from table &#39;&quot;</span>.$this-&gt;tablename, E_USER_ERROR);</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                        <span class="keywordflow">return</span> $err;</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;                }</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                </div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                <span class="keywordflow">return</span> $r[$name];</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;        }</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        </div>
<div class="line"><a name="l03858"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ada42d41741401261ee692c7cdb73ec46"> 3858</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ada42d41741401261ee692c7cdb73ec46" title="Checks if this table has a relationship with the specified name.">hasRelationship</a>($name){</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;                $r =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>();</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;                <span class="keywordflow">return</span> isset($r[$name]);</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;        }</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;        </div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;        </div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;        </div>
<div class="line"><a name="l03878"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a95511d0a09f33ec223c8d76fcec8c2ef"> 3878</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a95511d0a09f33ec223c8d76fcec8c2ef" title="Returns a list of the relationships for this table as actions.">getRelationshipsAsActions</a>($params=array(), $relationshipName=null, $passthru=<span class="keyword">false</span>){</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;                </div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                $relationships =&amp; $this-&gt;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>();</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                $rkeys = array_keys($relationships);</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;                 <span class="keywordflow">if</span> ( isset( $this-&gt;_cache[<span class="stringliteral">&#39;getRelationshipsAsActions&#39;</span>]) ){</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;                        $actions = $this-&gt;_cache[<span class="stringliteral">&#39;getRelationshipsAsActions&#39;</span>];</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;                 } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;                         $actions = array();</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;                         <span class="keywordflow">foreach</span> ( $rkeys as $key){</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;                                $srcTable =&amp; $relationships[$key]-&gt;getSourceTable();</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;                                $actions[$key] = array(</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;                                        <span class="stringliteral">&#39;name&#39;</span>=&gt;$key, </div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;                                        <span class="stringliteral">&#39;id&#39;</span>=&gt;$key, </div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;                                        <span class="stringliteral">&#39;label&#39;</span>=&gt;ucwords(str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>,$key)), </div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                                        <span class="stringliteral">&#39;url&#39;</span> =&gt;<span class="stringliteral">&#39;{$this-&gt;url(\&#39;-action=related_records_list&amp;-relationship=&#39;</span>.$key.<span class="charliteral">&#39;\&#39;</span>)}<span class="stringliteral">&#39;,</span></div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;<span class="stringliteral">                                        &#39;</span>selected_condition<span class="stringliteral">&#39; =&gt; &#39;</span>$query[\<span class="stringliteral">&#39;-relationship\&#39;] == \&#39;&#39;</span>.$key.<span class="charliteral">&#39;\&#39;&#39;</span>,</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;                                        <span class="comment">//&#39;label_i18n&#39; =&gt; $srcTable-&gt;tablename.&#39;::&#39;.$key.&#39;.label&#39;,</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;                                        <span class="comment">//&#39;description_i18n&#39; =&gt; $srcTable-&gt;tablename.&#39;::&#39;.$key.&#39;.description&#39;,</span></div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;                                        <span class="stringliteral">&#39;condition&#39;</span> =&gt; <span class="stringliteral">&#39;$record and $record-&gt;checkPermission(&quot;view related records&quot;, array(&quot;relationship&quot;=&gt;&quot;&#39;</span>.basename($key).<span class="stringliteral">&#39;&quot;))&#39;</span>,</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                                        <span class="stringliteral">&#39;order&#39;</span> =&gt; 1,</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;                                        <span class="stringliteral">&#39;visible&#39;</span>=&gt;(!($relationships[$key]-&gt;isParentRelationship()) ? 1 : 0)</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                                        );</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                                <span class="keywordflow">if</span> ( isset($relationships[$key]-&gt;_schema[<span class="stringliteral">&#39;action&#39;</span>]) ){</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;                                        $actions[$key] = array_merge($actions[$key], $relationships[$key]-&gt;_schema[<span class="stringliteral">&#39;action&#39;</span>]);</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;                                }</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;                                $actions[$key][<span class="stringliteral">&#39;label&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$srcTable-&gt;tablename.<span class="stringliteral">&#39;.relationships.&#39;</span>.$key.<span class="stringliteral">&#39;.label&#39;</span>, @$actions[$key][<span class="stringliteral">&#39;label&#39;</span>]);</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;                                $actions[$key][<span class="stringliteral">&#39;description&#39;</span>] = df_translate(<span class="stringliteral">&#39;tables.&#39;</span>.$srcTable-&gt;tablename.<span class="stringliteral">&#39;.relationships.&#39;</span>.$key.<span class="stringliteral">&#39;.description&#39;</span>, @$actions[$key][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;                                unset($srcTable);</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;                         }</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;                         $this-&gt;_cache[<span class="stringliteral">&#39;getRelationshipsAsActions&#39;</span>] = $actions;</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;                 }</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;                 </div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;                 <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/ActionTool.php&#39;</span>);</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;                 $actionsTool =&amp; <a class="code" href="class_dataface___action_tool.html#a9eb606fdb589cab3ae9edc96dce15972">Dataface_ActionTool::getInstance</a>();</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;                 <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = $actionsTool-&gt;getActions($params, $actions);</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;                 <span class="keywordflow">if</span> ( isset($relationshipName) ) {</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;                        <span class="keywordflow">if</span> ( isset(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>[$relationshipName]) ){</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;                                <span class="keywordflow">return</span> @<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>[$relationshipName];</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                                <span class="keywordflow">return</span> $actionsTool-&gt;getAction($params, $actions[$relationshipName]);</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;                                </div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;                        }</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;                 }</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;                 <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>;</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        }</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        </div>
<div class="line"><a name="l03931"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920"> 3931</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#aa1617047e561ef4ed5e0566fc7ce8920" title="Returns reference to the relationships array for this table.">relationships</a>(){</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;                <span class="keywordflow">if</span> ( !$this-&gt;_relationshipsLoaded ){</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                        $start = microtime_float();</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                        $this-&gt;_loadRelationshipsIniFile();</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                        $end = microtime_float()-$start;</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;                        <span class="keywordflow">if</span> ( DATAFACE_DEBUG ){</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;                                $this-&gt;app-&gt;addDebugInfo(<span class="stringliteral">&quot;Time to load relationships: $end&quot;</span>);</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;                        }</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;                }</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;                </div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_relationships;</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        }</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        </div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        </div>
<div class="line"><a name="l03952"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab10d895244a666856f2a51600754fed3"> 3952</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ab10d895244a666856f2a51600754fed3" title="Returns the Table object that contains a specified field. The fieldname is given as a relationship pa...">getTableTableForField</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        </div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>,<span class="charliteral">&#39;.&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;                        <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;                        $relationship =&amp; $this-&gt;getRelationship(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[0]);</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;                        </div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;                        $domainTable =&amp; self::loadTable($relationship-&gt;getDomainTable());</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;                        <span class="keywordflow">if</span> ( $domainTable-&gt;hasField(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[1]) ) <span class="keywordflow">return</span> $domainTable;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;                        </div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;                        <span class="comment">//print_r($relationship-&gt;_schema[&#39;selected_tables&#39;]);</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;                        <span class="keywordflow">foreach</span> ($relationship-&gt;_schema[<span class="stringliteral">&#39;selected_tables&#39;</span>] as <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> ){</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;                                <span class="keywordflow">if</span> ( $table == $domainTable-&gt;tablename ) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;                                $table =&amp; self::loadTable($table, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;                                <span class="comment">//if ( in_array( $path[1], array_keys($table-&gt;fields()) ) ){</span></div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;                                <span class="keywordflow">if</span> ( $table-&gt;hasField(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[1]) ){</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;                                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>;</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;                                }</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;                                unset($table);</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;                        }</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;                        </div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<a class="code" href="_dataface_2table_8php.html#a0fc4b99550d24a307b1e7242be51daf3">SCHEMA_TABLE_NOT_FOUND</a>,null,null,null,<span class="stringliteral">&quot;Failed to find table table for field &#39;$fieldname&#39; in Dataface_Table::getTableTableForField() &quot;</span>);</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                        <span class="keywordflow">return</span> $this;</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;                }</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;        </div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        }</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;         </div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        <span class="comment">// End Relationships</span></div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        </div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l03998"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f"> 3998</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a47284d2e7e041e10a0f1929d15cb934f" title="Returns a reference to the Table&#39;s delegate class.">getDelegate</a>(){</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = null;</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_delegate ) ){</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;_hasDelegateFile() ){</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;                                </div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;                                $this-&gt;_loadDelegate();</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;                                        </div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;                                </div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>;</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;                        }</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;                } </div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_delegate;</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;                </div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;        }</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;        </div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;        </div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        </div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;        </div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;        </div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;        </div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;        </div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;        </div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        </div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;        </div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        <span class="keyword">function</span> _delegateFilePath(){</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;                <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> =$this-&gt;basePath().<span class="stringliteral">&#39;/tables/&#39;</span>.$this-&gt;tablename.<span class="charliteral">&#39;/&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;.php&#39;</span>;</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;                </div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>;</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        }</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        </div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        </div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;        </div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        </div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        </div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        </div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;        </div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;        <span class="keyword">function</span> _hasDelegateFile(){</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;                <span class="keywordflow">return</span> file_exists( $this-&gt;_delegateFilePath() );</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;        }       </div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        </div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;        </div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        <span class="keyword">function</span> _loadDelegate(){</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;                </div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;_hasDelegateFile() ){</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;                        </div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;                        <span class="keyword">import</span>( $this-&gt;_delegateFilePath() );</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;                        $delegate_name = <span class="stringliteral">&quot;tables_&quot;</span>.$this-&gt;tablename;</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                        $this-&gt;_delegate = <span class="keyword">new</span> $delegate_name();</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;                        <span class="keywordflow">if</span> ( isset($this-&gt;_delegate) and method_exists($this-&gt;_delegate, <span class="stringliteral">&#39;getDelegate&#39;</span>) ){</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;                                $del = $this-&gt;_delegate-&gt;getDelegate();</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;                                <span class="keywordflow">if</span> ( isset($del) ){</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;                                        $this-&gt;_delegate = $del;</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;                                }</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;                        }</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;                        </div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;                        <span class="keywordflow">if</span> ( method_exists($this-&gt;_delegate, <span class="stringliteral">&#39;tablePermissions&#39;</span>) ){</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;                                <span class="comment">// table permissions are now just done inside the getPermissions() method.</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;                                <span class="comment">// so the tablePermissions() method is no longer supported.  Let the developer</span></div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;                                <span class="comment">// know in case he has old code.</span></div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;                                        <a class="code" href="class_dataface___language_tool.html#a04a9c3b638f4cb6edc812088ba0f064f">Dataface_LanguageTool::translate</a>(</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;                                                <span class="stringliteral">&#39;tablePermissions method no longer supported&#39;</span>,</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                                                <span class="stringliteral">&#39;Dataface noticed that the delegate class for the table &quot;&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;&quot; contains a tablePermissions() method.  This method is no longer supported as of Dataface version 0.6.  Please use the getPermissions() method instead with first parameter null to achieve the same results.</span></div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;<span class="stringliteral">                                                For example:</span></div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;<span class="stringliteral">                                                function getPermissions(&amp;$record, $params){</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="stringliteral">                                                        if ( $record === null ){</span></div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;<span class="stringliteral">                                                                // return generic table permissions</span></div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;<span class="stringliteral">                                                        } else {</span></div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;<span class="stringliteral">                                                                // return record-specific permissions</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;<span class="stringliteral">                                                        }</span></div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;<span class="stringliteral">                                                }&#39;</span>,</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;                                                array(<span class="stringliteral">&#39;table&#39;</span>=&gt;$this-&gt;tablename)</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;                                        ), E_USER_NOTICE</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;                                );</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;                        }</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;                        </div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;                }</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;        }</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;        </div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;         </div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        <span class="comment">// End Delegate Classes</span></div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        </div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;        </div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        </div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l04120"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a2e93c00662e712dd19e2e4accb5a166e"> 4120</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a2e93c00662e712dd19e2e4accb5a166e" title="Returns an array of strings that are the names of the tabs for this table. Fields can be grouped into...">getTabs</a>(){</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;                <span class="keywordflow">return</span> array_keys($this-&gt;tabs());</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;        }</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;        </div>
<div class="line"><a name="l04149"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a034d28a366786cbcf7c663585592aeb0"> 4149</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a034d28a366786cbcf7c663585592aeb0" title="Returns an associative array of tab definitions of the form: [tabname] -&gt; [tab_properties].">tabs</a>($record=null){</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;                </div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;                $del =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;                <span class="keywordflow">if</span> ( isset($del) and method_exists($del, <span class="stringliteral">&#39;__tabs__&#39;</span>) ){</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;                        $tabs = $del-&gt;__tabs__($record);</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;                        $i=0;</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;                        <span class="keywordflow">foreach</span> ($tabs as $tkey=&gt;$tdata){</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;                                $tabs[$tkey][<span class="stringliteral">&#39;order&#39;</span>] = $i++;</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;                        }</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;                        <span class="keywordflow">return</span> $tabs;</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;                        </div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;                        $tabs = $this-&gt;_tabs;</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;                        <span class="keywordflow">if</span> ( isset($record) ){</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;                                <span class="keywordflow">foreach</span> ( $this-&gt;__join__($record) as <a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>=&gt;$tablelabel ){</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;                                        <span class="keywordflow">if</span> ( !isset($tabs[<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>]) ){</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;                                                $tabs[<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>] = array(<span class="stringliteral">&#39;name&#39;</span>=&gt;$tablename, <span class="stringliteral">&#39;label&#39;</span>=&gt;$tablelabel, <span class="stringliteral">&#39;description&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;                                        }</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;                                }</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;                        }</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;                        $i=0;</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;                        <span class="keywordflow">foreach</span> ($tabs as $tkey=&gt;$tdata){</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;                                $tabs[$tkey][<span class="stringliteral">&#39;order&#39;</span>] = $i++;</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;                        }</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;                        <span class="keywordflow">return</span> $tabs;</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;                }</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;        }</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;        </div>
<div class="line"><a name="l04184"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a46bd279644a832ce340300b877bc57f7"> 4184</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a46bd279644a832ce340300b877bc57f7" title="Returns specified tab&#39;s properties.">getTab</a>($tabname, $record=null){</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;                $tabs =&amp; $this-&gt;tabs($record);</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;                <span class="keywordflow">return</span> $tabs[$tabname];</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;        }</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;        </div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;        </div>
<div class="line"><a name="l04206"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa60496c65689a62cbad1df3c72905a89"> 4206</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aa60496c65689a62cbad1df3c72905a89" title="Returns an array of tables for a particular record that can be treated as join tables.">__join__</a>(&amp;$record){</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;                $del =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;                <span class="keywordflow">if</span> ( isset($del) and method_exists($del, <span class="stringliteral">&#39;__join__&#39;</span>) ){</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;                        <span class="keywordflow">return</span> $del-&gt;__join__($record);</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($this-&gt;_joinTables) ){</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;                        <span class="keywordflow">return</span> $this-&gt;_joinTables;</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;                        <span class="keywordflow">return</span> array();</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;                }</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;        }</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        </div>
<div class="line"><a name="l04228"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a797be6813c7bd34be5877a22167e9087"> 4228</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a797be6813c7bd34be5877a22167e9087" title="Indicates whether or not this table has a join table.">hasJoinTable</a>(<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>, &amp;$record){</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;                <span class="keywordflow">return</span> array_key_exists(<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>,$this-&gt;__join__($record));</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;        }</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;        </div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;        </div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;         </div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;        <span class="comment">// End Tabs</span></div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;        </div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;        </div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l04271"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a44a3e90e73a4199c376390818fb1c56c"> 4271</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a44a3e90e73a4199c376390818fb1c56c" title="Returns an associative array describing a field group.">getFieldgroup</a>($fieldgroupname){</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_fieldgroups[$fieldgroupname] ) ){</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;                        $parent =&amp; $this-&gt;getParent();</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;                                $fg =&amp; $parent-&gt;getFieldgroup($fieldgroupname);</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;                                <span class="keywordflow">return</span> $fg;</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;                        }</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_p_e_a_r.html#af25642dd23a403015692fb6a3402332b">PEAR::raiseError</a>(<span class="stringliteral">&quot;Attempt to get nonexistent field group &#39;$fieldgroupname&#39; from table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;\n&lt;br&gt;&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;                }</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_fieldgroups[$fieldgroupname];</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        }</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;        </div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;        </div>
<div class="line"><a name="l04296"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a700df7f2ea9f3dc77327c02635fa85b3"> 4296</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#a700df7f2ea9f3dc77327c02635fa85b3" title="Returns associative array of all of the field group definitions (keys are the fieldgroup names)...">getFieldgroups</a>(){</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_cache[__FUNCTION__] ) ){</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;                        $fg =&amp; $this-&gt;_fieldgroups;</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;                        $parent =&amp; $this-&gt;getParent();</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;                                $fg = array_merge_recursive_unique($parent-&gt;getFieldgroups(), $fg);</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;                                uasort($fg, array(&amp;$this, <span class="stringliteral">&#39;_compareFields&#39;</span>));</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;                        }</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;                        $this-&gt;_cache[__FUNCTION__] =&amp; $fg;</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;                }</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__];</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;        }</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        </div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;         </div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;        <span class="comment">// End Field Groups</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;        </div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        </div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l04332"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ad1ed71f4408ee5f861bb9cb2592671e9"> 4332</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#ad1ed71f4408ee5f861bb9cb2592671e9" title="Import filters facilitate the importing of data into the table.">getImportFilters</a>(){</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ImportFilter.php&#39;</span>);</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;                <span class="keywordflow">if</span> ( $this-&gt;_importFilters === null ){</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;                        $this-&gt;_importFilters = array();</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="comment">                         * Filters have not been loaded yet.. let&#39;s load them.</span></div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;<span class="comment">                         *</span></div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;<span class="comment">                         * Any method in the delegate file with a name of the form __import__&lt;string&gt;</span></div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="comment">                         * is considered to be an import filter.</span></div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;<span class="comment">                         *</span></div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;                        $delegate =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;                        <span class="keywordflow">if</span> ( $delegate !== null ) {</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;                                $methods = get_class_methods(get_class( $delegate ) );</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;                                <span class="keywordflow">foreach</span> ( $methods as $method ){</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;                                        $matches = array();</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;                                        <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&#39;/^__import__(.*)$/&#39;</span>, $method, $matches) ){</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;                                                $filter = <span class="keyword">new</span> <a class="code" href="class_dataface___import_filter.html">Dataface_ImportFilter</a>($this-&gt;tablename, $matches[1], df_translate(<span class="stringliteral">&#39;import_filters:&#39;</span>.$matches[1].<span class="stringliteral">&#39;:label&#39;</span>, ucwords(str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>,$matches[1]))));</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;                                                $this-&gt;_importFilters[$matches[1]] =&amp; $filter;</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;                                                unset($filter);</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;                                        }</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;                                }</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;                        }</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;                        </div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;                        $parent =&amp; $this-&gt;getParent();</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;                        <span class="keywordflow">if</span> ( isset($parent) ){</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;                                $this-&gt;_importFilters = array_merge($parent-&gt;getImportFilters(), $this-&gt;_importFilters);</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;                        }</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;                </div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;                }</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;                </div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_importFilters;</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;        }</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;        </div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;        </div>
<div class="line"><a name="l04378"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a13d22dc9eac4e2029540fb816754e798"> 4378</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a13d22dc9eac4e2029540fb816754e798">registerImportFilter</a>(&amp;$filter){</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;                <span class="keywordflow">if</span> (!is_a( $filter, <span class="stringliteral">&#39;Dataface_ImportFilter&#39;</span>) ){</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;In Dataface_Table::registerImportFilter() 2nd argument expected to be of type &#39;Dataface_ImportFilter&#39; but received &#39;&quot;</span>.get_class($filter).<span class="stringliteral">&quot;&#39;. &quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;                }</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;                $filters =&amp; $this-&gt;getImportFilters();</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;                $filters[$filter-&gt;name] =&amp; $filter;</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        </div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;        }</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;         </div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;         </div>
<div class="line"><a name="l04398"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a43b2cacac403cddd33df631890351d92"> 4398</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a43b2cacac403cddd33df631890351d92" title="Gets the tables from the database that are explicitly for importing data. They are tables of the form...">getImportTables</a>(){</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;                $res = mysql_query(<span class="stringliteral">&quot;SHOW TABLES LIKE &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;__import_%&#39;&quot;</span>, $this-&gt;db);</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;                <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Error getting import table list for table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;                }</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;                </div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;                $tables = array();</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;                <span class="keywordflow">while</span> ( $row = mysql_fetch_row($res) ){</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                        $tables[] = $row[0];</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;                }</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;                mysql_free_result($res);</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;                <span class="keywordflow">return</span> $tables;</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;        }</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;        </div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;        </div>
<div class="line"><a name="l04421"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa4e2ab5556d8bf6fe210159098fb3cc6"> 4421</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aa4e2ab5556d8bf6fe210159098fb3cc6" title="Creates an import table for this table. An import table is an empty clone of this table...">createImportTable</a>(){</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;                <span class="keyword">import</span>(<span class="stringliteral">&#39;Dataface/QueryBuilder.php&#39;</span>);</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;<span class="comment">                 * It is a good idea to clean the import tables before we create them.</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;<span class="comment">                 * That way they don&#39;t get cluttered</span></div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;                $this-&gt;cleanImportTables();</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;                </div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;                $rand = rand(10000,999999);</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;                $name = $this-&gt;tablename.<span class="stringliteral">&#39;__import_&#39;</span>.strval(time()).<span class="charliteral">&#39;_&#39;</span>.strval($rand);</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;                $qb = <span class="keyword">new</span> <a class="code" href="class_dataface___query_builder.html">Dataface_QueryBuilder</a>($this-&gt;tablename);</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;                $res = mysql_query(<span class="stringliteral">&quot;CREATE TABLE `$name` SELECT * &quot;</span>.$qb-&gt;_from().<span class="stringliteral">&quot; LIMIT 0&quot;</span>, $this-&gt;db);</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;                <span class="keywordflow">if</span> (!$res ){</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Failed to create import table `$name` because a mysql error occurred: &quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>).<span class="stringliteral">&quot;\n&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;                }</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;                <span class="keywordflow">return</span> $name;</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        </div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        }</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;        </div>
<div class="line"><a name="l04448"></a><span class="lineno"><a class="code" href="class_dataface___table.html#abe149f023090d6cd517dbcbf8127ebd3"> 4448</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#abe149f023090d6cd517dbcbf8127ebd3" title="Cleans up old import tables. Any import tables older (in seconds) than the garbage collector threshol...">cleanImportTables</a>(){</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;                </div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;                $tables = $this-&gt;getImportTables();</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;                <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a> =&amp; <a class="code" href="class_dataface___application.html#a9eb606fdb589cab3ae9edc96dce15972" title="Returns reference to the singleton instance of this class.">Dataface_Application::getInstance</a>();</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;                $garbageLifetime = <a class="code" href="blob_8php.html#adfb117f244076aa9bc269269f7e57403">$app</a>-&gt;_conf[<span class="stringliteral">&#39;garbage_collector_threshold&#39;</span>];</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;                <span class="keywordflow">foreach</span> ($tables as <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>){</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;                        $matches =array();</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^&#39;</span>.$this-&gt;tablename.<span class="stringliteral">&#39;__import_(\d+)_(\d)$/&#39;</span>, $table,  $matches) ){</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;                                <span class="keywordflow">if</span> ( time() - intval($matches[1]) &gt; intval($garbageLifetime) ){</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;                                        $res = mysql_query(<span class="stringliteral">&quot;DROP TABLE `$table`&quot;</span>, $this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>);</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;                                        <span class="keywordflow">if</span> ( !$res ){</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;                                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Problem occurred attemtping to clean up old import table &#39;$table&#39;. MySQL returned an error: &quot;</span>.mysql_error($this-&gt;<a class="code" href="_installer_8php.html#abf2dfcff06cad1e6c249ddc4df4d0866">db</a>).<span class="stringliteral">&quot;\n&quot;</span>, E_USER_ERROR);</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;                                        }</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;                                }</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;                        }</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;                }</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;        }</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        </div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        </div>
<div class="line"><a name="l04475"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a8f0e07e8bd6bbe4559bf500759bcecb4"> 4475</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a8f0e07e8bd6bbe4559bf500759bcecb4" title="Checks if a given table is an import table as created with createImportTable().">isImportTable</a>(<a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>){</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;                <span class="keywordflow">return</span> preg_match(<span class="stringliteral">&#39;/^\w+__import_(\d{5,20})_(\d{4,10})$/&#39;</span>, <a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$tablename</a>);</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;                </div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;        </div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;        }</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        </div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;        </div>
<div class="line"><a name="l04533"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a004db74a3082de013580469f54aeeb97"> 4533</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a004db74a3082de013580469f54aeeb97" title="Prepares data to be imported into the table. It takes raw data and produces an array of Dataface_Reco...">parseImportData</a>($data, $importFilter=null, $defaultValues=array()){</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;                $filters =&amp; $this-&gt;getImportFilters();</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;                $delegate =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;                <span class="keywordflow">if</span> ( $delegate === null ){</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;<span class="comment">                         * Currently the only place that Import filters can be defined is in the</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="comment">                         * delegate file.  If there is no delegate file, then there are no filters.</span></div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="comment">                         * if there are no filters, then we can&#39;t possibly do any importing so we</span></div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;<span class="comment">                         * return an error.</span></div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#a46ea1845f8ef55433846b7612a182892">Dataface_Error::noImportFiltersFound</a>();</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;                }</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;                $errors = array();</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;                <span class="keywordflow">if</span> ( $importFilter === null ){</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;<span class="comment">                         * The filter is not specified so we will try every filter until we find one</span></div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;<span class="comment">                         * that works.</span></div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;                        <span class="keywordflow">foreach</span> (array_keys($filters) as $filtername){</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;                                $parsed =&amp; $filters[$filtername]-&gt;import($data, $defaultValues);</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($parsed) ){</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;                                        <span class="comment">/*</span></div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;<span class="comment">                                         * This filter encountered an error.</span></div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="comment">                                         * Record the error, and unset the $parsed variable.</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="comment">                                         */</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;                                        $errors[$filtername] =&amp; $parsed;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;                                        unset($parsed);</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;                                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;                                }</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;                                </div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;                        }</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;                        </div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;                        <span class="keywordflow">if</span> ( isset($parsed) ){</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;                                <span class="comment">/*</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;<span class="comment">                                 * The only way that the $parsed variable should be &#39;set&#39; is if </span></div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;<span class="comment">                                 * one of the filters successfully parsed the data.</span></div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;<span class="comment">                                 */</span></div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;                                <span class="keywordflow">return</span> $parsed;</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;                        </div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#a46ea1845f8ef55433846b7612a182892">Dataface_Error::noImportFiltersFound</a>(</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;                                        <span class="stringliteral">&quot;No suitable import filter was found to import data into table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.  The following filters were attempted: {&quot;</span>.implode(<span class="charliteral">&#39;,&#39;</span>, array_keys($errors)).<span class="stringliteral">&quot;}.&quot;</span></div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;                                );</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;                        }</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;                        <span class="comment">/*</span></div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;<span class="comment">                         * A particular import filter was specified so we will try with that one.</span></div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;<span class="comment">                         */</span></div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;                        <span class="keywordflow">if</span> ( !isset( $filters[$importFilter] ) ){</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="class_dataface___error.html#a46ea1845f8ef55433846b7612a182892">Dataface_Error::noImportFiltersFound</a>(<span class="stringliteral">&quot;The import filter &#39;&quot;</span>.$importFilter.<span class="stringliteral">&quot;&#39; was not found while attempting to import data into the table &#39;&quot;</span>.$this-&gt;tablename.<span class="stringliteral">&quot;&#39;.  The following import filters are available: {&quot;</span>.implode(<span class="charliteral">&#39;,&#39;</span>, array_keys($errors)).<span class="stringliteral">&quot;}.&quot;</span></div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;                                );</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;                        }</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;                        </div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;                        <span class="keywordflow">return</span> $filters[$importFilter]-&gt;import($data, $defaultValues);</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;                }</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;        </div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;        }</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        </div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;         </div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;        <span class="comment">// End Imports</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;        </div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;        </div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;        </div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;        </div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;        </div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;        </div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;        </div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;        </div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;        </div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;        </div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;        </div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;        </div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;        <span class="keyword">function</span> _parseINISection($section, &amp;$curr){</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;                </div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;                <span class="keywordflow">foreach</span> ($section as $valuekey=&gt;$valuevalue){</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;                        <span class="keywordflow">if</span> ( strpos($valuekey,<span class="charliteral">&#39;:&#39;</span>) &gt; 0 ){</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;                                <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = explode(<span class="charliteral">&#39;:&#39;</span>, $valuekey);</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;                                $temp =&amp; $curr;</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;                                <span class="keywordflow">for</span> ( $i=0; $i&lt;count(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>); $i++){</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;                                        <span class="keywordflow">if</span> ( $i&lt;count(<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>)-1){</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;                                                <span class="keywordflow">if</span> ( !isset($temp[<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[$i]])) $temp[<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[$i]] = array();</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;                                                $temp2 =&amp; $temp[<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[$i]];</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;                                                unset($temp);</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;                                                $temp =&amp; $temp2;</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;                                                unset($temp2);</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;                                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;                                                $temp[<a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>[$i]] = $valuevalue;</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;                                        }</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;                                }</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;                                $curr[$valuekey] = $valuevalue;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;                        }</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;                }</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;                </div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;        </div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;        }</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;        </div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;        </div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;        </div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;        </div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;        </div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;        </div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;        </div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;        </div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;        </div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l04660"></a><span class="lineno"><a class="code" href="class_dataface___table.html#af7a34c2ee4677cf0d5f5ed3f8d3c4d21"> 4660</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#af7a34c2ee4677cf0d5f5ed3f8d3c4d21" title="Returns the type of a field , eg: int, float, varchar, blob, etc...">getType</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;                <span class="keywordflow">if</span> ( !isset($this-&gt;_cache[__FUNCTION__][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>]) ){</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;                        <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;getField($fieldname);</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>) ) <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;                        </div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;                        <span class="keywordflow">if</span> ( isset( <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> ) ){</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;                                </div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;                                $type = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;Type&#39;</span>];</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;                                </div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;                                $matches = array();</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;                                </div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;                                <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/^([^\( ]+).*/&#39;</span>, $type, $matches) ){</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;                                        $type = $matches[1];</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;                                }</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;                                </div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;                                $type = trim($type);</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;                                $this-&gt;_cache[__FUNCTION__][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>] = strtolower($type);</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;                        }</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;                }</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_cache[__FUNCTION__][<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>];</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;                        </div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;        </div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;        }</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;        </div>
<div class="line"><a name="l04690"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab686f41012904c84666d28a4239dd0cf"> 4690</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab686f41012904c84666d28a4239dd0cf" title="Checks a field to see if it is a date type (date, datetime, time, or timestamp).">isDate</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;                $type = $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($type) ){</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;                }</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;                <span class="keywordflow">return</span> in_array( $type, array(<span class="stringliteral">&#39;date&#39;</span>,<span class="stringliteral">&#39;datetime&#39;</span>,<span class="stringliteral">&#39;time&#39;</span>,<span class="stringliteral">&#39;timestamp&#39;</span>) );</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;        }</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;        </div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;        </div>
<div class="line"><a name="l04705"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a3f02bbbbe59e8721cc5b77a7358f9183"> 4705</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a3f02bbbbe59e8721cc5b77a7358f9183" title="Checks a field to see if it is a blob type.">isBlob</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;                <span class="keywordflow">return</span> in_array( $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>), array(<span class="stringliteral">&#39;blob&#39;</span>, <span class="stringliteral">&#39;longblob&#39;</span>,<span class="stringliteral">&#39;tinyblob&#39;</span>,<span class="stringliteral">&#39;mediumblob&#39;</span>) );</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;        }</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;        </div>
<div class="line"><a name="l04718"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a6448915f13e1c0b880a1df082b8a60f5"> 4718</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a6448915f13e1c0b880a1df082b8a60f5" title="Indicates if a field is a container field. A container field is a varchar or char field but it contai...">isContainer</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;                <span class="keywordflow">return</span> strtolower($this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>)) == <span class="stringliteral">&#39;container&#39;</span>;</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;        </div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;        }</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;        </div>
<div class="line"><a name="l04730"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a537fc09b1b164dfb16d91448f464bc26"> 4730</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a537fc09b1b164dfb16d91448f464bc26" title="Checks to see if the field is a password field. Any field with widget:type=password is regarded as a ...">isPassword</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;getField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;                <span class="comment">//if ( !is_array($field) ) return false;</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;                <span class="keywordflow">return</span> (<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;password&#39;</span>);</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;        }</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;        </div>
<div class="line"><a name="l04741"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9"> 4741</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab27351c1ebb154acb37aadd9dab9d2a9" title="Checks to see if the field is a text field (e.g. text, longtext, tinytext, or mediumtext).">isText</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;                <span class="keywordflow">return</span> in_array( $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>), array(<span class="stringliteral">&#39;text&#39;</span>,<span class="stringliteral">&#39;longtext&#39;</span>,<span class="stringliteral">&#39;tinytext&#39;</span>,<span class="stringliteral">&#39;mediumtext&#39;</span>) );</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;        }</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;        </div>
<div class="line"><a name="l04752"></a><span class="lineno"><a class="code" href="class_dataface___table.html#abdd6a933eccf4ad8fbc0871f3645277d"> 4752</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#abdd6a933eccf4ad8fbc0871f3645277d" title="Checks to see if the field is stored in XML format. Only the &#39;table&#39; and &#39;group&#39; widgets cause the da...">isXML</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;                $fld =&amp; $this-&gt;getField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;                <span class="keywordflow">return</span> in_array( $fld[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>], array(<span class="stringliteral">&#39;table&#39;</span>,<span class="stringliteral">&#39;group&#39;</span>));</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;        }</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;        </div>
<div class="line"><a name="l04762"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b"> 4762</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a0169e50d1ef9935a3bf2581c536e1c1b" title="Checks to see if the field is a character field (i.e. varchar or char).">isChar</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;                <span class="keywordflow">return</span> in_array( $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>), array(<span class="stringliteral">&#39;varchar&#39;</span>,<span class="stringliteral">&#39;char&#39;</span>) );</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;        }</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;        </div>
<div class="line"><a name="l04771"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a4a7e3bdb27deaa7a039a79a59c99f436"> 4771</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a4a7e3bdb27deaa7a039a79a59c99f436" title="Checks to see if the field is an INT field.">isInt</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;                <span class="keywordflow">return</span> in_array(strtolower($this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>)), array(<span class="stringliteral">&#39;int&#39;</span>,<span class="stringliteral">&#39;tinyint&#39;</span>,<span class="stringliteral">&#39;mediumint&#39;</span>,<span class="stringliteral">&#39;smallint&#39;</span>,<span class="stringliteral">&#39;bigint&#39;</span>));</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;        }</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;        </div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;        </div>
<div class="line"><a name="l04781"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a1e21daaeaf49239a1a5eb6a07cc64989"> 4781</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a1e21daaeaf49239a1a5eb6a07cc64989" title="Checks to see if the field is a floating point field (i.e. float, double, tinyfloat, etc..)">isFloat</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>){</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;                <span class="keywordflow">return</span> in_array(strtolower($this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>)), array(<span class="stringliteral">&#39;float&#39;</span>,<span class="stringliteral">&#39;double&#39;</span>,<span class="stringliteral">&#39;tinyfloat&#39;</span>,<span class="stringliteral">&#39;mediumfloat&#39;</span>,<span class="stringliteral">&#39;decimal&#39;</span>));</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;        }</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;         </div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;         </div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;        <span class="comment">// END Field Type Information</span></div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;        </div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;        </div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l04813"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab5af5528667e1ca3386b4e551e7292ba"> 4813</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab5af5528667e1ca3386b4e551e7292ba" title="Parses a value intended to be placed into a date field and converts it to a normalized format...">parse_datetime</a>($value){</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;                <span class="keywordflow">return</span> $this-&gt;parse_datetype($value);</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;        </div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;        </div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;        }</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;        </div>
<div class="line"><a name="l04823"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa04cc209f363aabe3393005242d665bd"> 4823</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aa04cc209f363aabe3393005242d665bd" title="Alias of parse_datetype()">parse_date</a>($value){</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;        </div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;                <span class="keywordflow">return</span> $this-&gt;parse_datetype($value);</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;        </div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;        }</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;        </div>
<div class="line"><a name="l04841"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a9bc38dc7c83af3b51391d3cc081ca761"> 4841</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a9bc38dc7c83af3b51391d3cc081ca761" title="Parses a date, but also recognizes teh CURRENT_TIMESTAMP keyword string to return the current timesta...">parse_timestamp</a>($value){</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;                <span class="keywordflow">if</span> ( $value == <span class="stringliteral">&#39;CURRENT_TIMESTAMP&#39;</span> ){</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;                        $value = date(<span class="stringliteral">&#39;Y-m-d H:i:s&#39;</span>);</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;                }</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;                <span class="keywordflow">return</span> $this-&gt;parse_datetype($value);</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;        </div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;        }</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;        </div>
<div class="line"><a name="l04853"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a696234c42b484a157724fba33138869b"> 4853</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a696234c42b484a157724fba33138869b" title="Alias of parse_datetype()">parse_time</a>($value){</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;                <span class="keywordflow">return</span> $this-&gt;parse_datetype($value);</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;        }</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;        </div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;        <span class="keyword">function</span> isTimeStamp($value){</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;                $converter = <span class="keyword">new</span> <a class="code" href="class_dataface__converters__date.html">Dataface_converters_date</a>;</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;                <span class="keywordflow">return</span> $converter-&gt;isTimestamp($value);</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;        }</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;        </div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;        <span class="keyword">function</span> parse_datetype($value){</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;                $converter = <span class="keyword">new</span> <a class="code" href="class_dataface__converters__date.html">Dataface_converters_date</a>;</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;                <span class="keywordflow">return</span> $converter-&gt;<a class="code" href="class_dataface__converters__date.html#afb337458f2a1d6dfd4dcd1e58439df2c">parseDate</a>($value);</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;                </div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;        </div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;        }</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;        </div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;        </div>
<div class="line"><a name="l04887"></a><span class="lineno"><a class="code" href="class_dataface___table.html#adfe538d355464933a9a950253cce76c9"> 4887</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#adfe538d355464933a9a950253cce76c9" title="Takes a value a normalizes it to a string representation of the value as encoded for the specified fi...">normalize</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value){</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;        </div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;                <span class="keywordflow">return</span> $this-&gt;getValueAsString(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $this-&gt;parse(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value));</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;        }</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;        </div>
<div class="line"><a name="l04904"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab6bfb14ddb8e33f99aec5da3ae1d1092"> 4904</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab6bfb14ddb8e33f99aec5da3ae1d1092" title="Gets the values of this record as strings. Some records like dates and times, are stored as data stru...">getValueAsString</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value){</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; $this-&gt;getTableTableForField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;                $delegate =&amp; <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getDelegate();</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;                $rel_fieldname = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;relativeFieldName(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;                <span class="keywordflow">if</span> ( $delegate !== null and method_exists( $delegate, $rel_fieldname.<span class="stringliteral">&#39;__toString&#39;</span>) ){</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;                        $value = call_user_func( array(&amp;$delegate, $rel_fieldname.<span class="stringliteral">&#39;__toString&#39;</span>), $value);</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;                } <span class="keywordflow">else</span> </div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;                </div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;                </div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;                <span class="keywordflow">if</span> ( is_array($value) ){</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;                        <span class="keywordflow">if</span> ( method_exists( $this, $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>).<span class="stringliteral">&quot;_to_string&quot;</span>) ){</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;                                $value = call_user_func( array( &amp;$this, $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>).<span class="stringliteral">&quot;_to_string&quot;</span>), $value );</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;                                $value = implode(<span class="stringliteral">&#39;, &#39;</span>, $value);</div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;                        }</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;                }</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;                $evt = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;                $evt-&gt;table = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>;</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;                $evt-&gt;field =&amp; <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getField($rel_fieldname);</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;                $evt-&gt;value = $value;</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;                $evt-&gt;type = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getType($rel_fieldname);</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;                $this-&gt;app-&gt;fireEvent(<span class="stringliteral">&#39;after_getValueAsString&#39;</span>, $evt);</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;                $value = $evt-&gt;value;</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;                <span class="keywordflow">return</span> $value;</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;        }</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;        </div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;        </div>
<div class="line"><a name="l04951"></a><span class="lineno"><a class="code" href="class_dataface___table.html#afccaffb87f8a483ff9ba6e8bbfe279af"> 4951</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#afccaffb87f8a483ff9ba6e8bbfe279af" title="Formats a value for a particular field to prepare it for display. This will delegate to the DelegateC...">format</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value){</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;                $isEmpty =  ( !isset($value) or <span class="stringliteral">&#39;&#39;</span> === <span class="stringliteral">&#39;&#39;</span>.$value );</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = $value;</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;                <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = $this-&gt;getTableTableForField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, <span class="charliteral">&#39;.&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;                        list($rel, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;                }</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;                $delegate = <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getDelegate();</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>) ){</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Could not load field &#39;</span>.<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;: &#39;</span>.<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>-&gt;getMessage(), <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>-&gt;getCode());</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;                }</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;                $method = <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__format&#39;</span>;</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;                <span class="keywordflow">if</span> ( isset($delegate) and method_exists($delegate, $method) ){</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;                        <span class="keywordflow">return</span> $delegate-&gt;$method($value);</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;                }</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;                <span class="comment">// If this is a number, let&#39;s format it!!</span></div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;isInt(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) or <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;isFloat(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) ){</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;                        <span class="keywordflow">if</span> ( !$isEmpty and isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;number_format&#39;</span>]) ){</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;                                $locale_data = localeconv();</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;                                $decimal = $locale_data[<span class="stringliteral">&#39;decimal_point&#39;</span>];</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;                                $sep = $locale_data[<span class="stringliteral">&#39;thousands_sep&#39;</span>];</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;                                $places = intval(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;number_format&#39;</span>]);</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;                                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = number_format(floatval(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>), $places, $decimal, $sep); </div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !$isEmpty and isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;money_format&#39;</span>]) ){</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;                                </div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                                $fieldLocale = null;</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;                                <span class="keywordflow">if</span> ( method_exists($delegate, <span class="stringliteral">&#39;getFieldLocale&#39;</span>) ){</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;                                        $fieldLocale = $delegate-&gt;getFieldLocale($this, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;                                        </div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;                                }</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;                                <span class="keywordflow">if</span> ( !isset($fieldLocale) and @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;locale&#39;</span>] ){</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;                                        $fieldLocale = $field[<span class="stringliteral">&#39;locale&#39;</span>];</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;                                }</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;                                </div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                                <span class="keywordflow">if</span> ( isset($fieldLocale) ){</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;                                        $oldLocale = setlocale(LC_MONETARY, <span class="charliteral">&#39;0&#39;</span>);</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;                                        <span class="keywordflow">if</span> ( $oldLocale != $fieldLocale ){</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;                                                setlocale(LC_MONETARY, $fieldLocale);</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                                        }</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;                                }</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;                                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = money_format($field[<span class="stringliteral">&#39;money_format&#39;</span>], floatval(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>));</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;                                <span class="keywordflow">if</span> ( isset($fieldLocale) ){</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;                                        setlocale(LC_MONETARY, $oldLocale);</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;                                }</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;                        </div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;                        }</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !$isEmpty and <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;isDate(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) ){</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;                </div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;                        <span class="comment">// If this is a date field, we will do some date formatting</span></div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;                </div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;                        $fmt = null;</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;                        <span class="keywordflow">switch</span> ( strtolower(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>)) ){</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;                        </div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;                                <span class="keywordflow">case</span> <span class="stringliteral">&#39;date&#39;</span>:</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;                                        $fmt = <span class="stringliteral">&#39;%x&#39;</span>;<span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;                                <span class="keywordflow">case</span> <span class="stringliteral">&#39;time&#39;</span>:</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;                                        $fmt = <span class="stringliteral">&#39;%r&#39;</span>;<span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;                                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;                                        $fmt = <span class="stringliteral">&#39;%c&#39;</span>;</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;                        </div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;                        }</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;                        </div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;                        </div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;                        $fieldLocale = null;</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;                        <span class="keywordflow">if</span> ( method_exists($delegate, <span class="stringliteral">&#39;getFieldLocale&#39;</span>) ){</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;                                $fieldLocale = $delegate-&gt;getFieldLocale($this, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;                                </div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;                        }</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;                        <span class="keywordflow">if</span> ( !isset($fieldLocale) and @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;locale&#39;</span>] ){</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;                                $fieldLocale = $field[<span class="stringliteral">&#39;locale&#39;</span>];</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;                        }</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;                        </div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;                        <span class="keywordflow">if</span> ( isset($fieldLocale) ){</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;                                $oldLocale = setlocale(LC_TIME, <span class="charliteral">&#39;0&#39;</span>);</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;                                <span class="keywordflow">if</span> ( $oldLocale != $fieldLocale ){</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;                                        setlocale(LC_TIME, $fieldLocale);</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;                                }</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;                        }</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;                        </div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;                        <span class="keywordflow">if</span> ( isset($field[<span class="stringliteral">&#39;date_format&#39;</span>]) ){</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;                                $fmt = $field[<span class="stringliteral">&#39;date_format&#39;</span>];</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;                        }</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;                        </div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;                        <span class="keywordflow">if</span> ( !strtotime(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>) ) <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;                        <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = strftime($fmt, strtotime(<a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>));</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;                        </div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;                        <span class="keywordflow">if</span> ( isset($fieldLocale) ){</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;                                setlocale(LC_TIME, $oldLocale);</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                        }</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;                        </div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;                        </div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;                </div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;                }</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;                </div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;                </div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;                <span class="comment">// If A display format was set for this field, let&#39;s apply it</span></div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;                <span class="keywordflow">if</span> ( !$isEmpty and isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;display_format&#39;</span>]) ){</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;                        <span class="keywordflow">if</span> ( isset(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;display_format_i18n&#39;</span>]) ){</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                                $fmt = df_translate(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;display_format_18n&#39;</span>], <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;display_format&#39;</span>]);</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;                                $fmt = <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;display_format&#39;</span>];</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;                        }</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;                        </div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;                        <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = sprintf($fmt, <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>);</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;                }</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>;</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;        }</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;        </div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;        </div>
<div class="line"><a name="l05071"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a98c8787f04b394e799a2f9621b992b78"> 5071</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a98c8787f04b394e799a2f9621b992b78" title="Parses a value so that it conforms with the value stored in the given field.">parse</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value, $parseRepeat=<span class="keyword">true</span>){</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;                <span class="keywordflow">if</span> ( strpos(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, <span class="charliteral">&#39;.&#39;</span>) !== <span class="keyword">false</span> ){</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;                        <span class="comment">// If this is a related field, we allow the related table to do the </span></div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;                        <span class="comment">// parsing</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;                        <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> =&amp; $this-&gt;getTableTableForField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>) ){</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception( <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;toString(), E_USER_ERROR);</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;                        }</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;                        list($rel, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) = explode(<span class="charliteral">&#39;.&#39;</span>, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>-&gt;parse(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value, $parseRepeat);</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;                }</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;                $type = $this-&gt;getType(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;                </div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;getField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;                </div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;                </div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;                $delegate =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;                <span class="keywordflow">if</span> ( $delegate !== null and method_exists( $delegate, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__parse&#39;</span>) ){</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;                        $value = call_user_func( array( &amp;$delegate, <a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>.<span class="stringliteral">&#39;__parse&#39;</span>), $value);</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;                }</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;                </div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $parseRepeat and <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;repeat&#39;</span>]  and ($this-&gt;isText(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) or $this-&gt;isChar(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) ) ){</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;                        </div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;                        $value = $this-&gt;parse_repeated(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value, @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;separator&#39;</span>]);</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;                }</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;                </div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( method_exists( $this, <span class="stringliteral">&#39;parse_&#39;</span>.strtolower($type) ) ){</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;                        </div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;                        $value = call_user_func( array(&amp;$this, <span class="stringliteral">&#39;parse_&#39;</span>.strtolower($type)), $value);</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;                } </div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;        </div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( in_array(<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>], array(<span class="stringliteral">&#39;group&#39;</span>,<span class="stringliteral">&#39;table&#39;</span>) )  and is_string($value) ){</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;                        <span class="comment">//error_log(&quot;\nAbout to parse $fieldname for value $value&quot;,3,&#39;log.txt&#39;);</span></div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;                        <span class="comment">//if ( is_string($value) and strlen($value)&gt; 10){</span></div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;                                <span class="comment">//error_log(&#39;About to serialize &#39;.$fieldname, 3, &#39;log.txt&#39;);</span></div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;                                <span class="keyword">import</span>( <span class="stringliteral">&#39;XML/Unserializer.php&#39;</span>);</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;                                $unserializer = <span class="keyword">new</span> XML_Unserializer();</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;                                $parsed = $unserializer-&gt;unserialize($value);</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;                                </div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;                                <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($parsed) ){</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;                                        $value = $unserializer-&gt;getUnserializedData();</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;                                } </div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;                                </div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;                        <span class="comment">//}</span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;                        </div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;                        </div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( $value === <span class="stringliteral">&quot;&quot;</span> and ($this-&gt;isInt(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>) or $this-&gt;isFloat(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>)) ){</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;                        $value = null;</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;                }</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;                </div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;                $evt = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;                $evt-&gt;table = $this;</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;                $evt-&gt;field =&amp; <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;                $evt-&gt;value = $value;</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;                $evt-&gt;type = $type;</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;                $evt-&gt;parseRepeat = $parseRepeat;</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;                $this-&gt;app-&gt;fireEvent(<span class="stringliteral">&#39;after_parse&#39;</span>, $evt);</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;                $value = $evt-&gt;value;</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;                <span class="keywordflow">return</span> $value;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;        </div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;        }</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;        </div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;        </div>
<div class="line"><a name="l05142"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a82f025949ca407ac0a3c4c974fbc882c"> 5142</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a82f025949ca407ac0a3c4c974fbc882c" title="Parses a value for a repeated field.">parse_repeated</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value, $separator=<span class="stringliteral">&quot;\n&quot;</span>){</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;                <span class="keywordflow">if</span> ( !$separator ) $separator = <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;                <span class="keywordflow">if</span> ( !is_array($value) ){</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;                        $value = explode($separator, $value);</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;                }</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;                <span class="keywordflow">foreach</span> (array_keys($value) as $key) {</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;                        $value[$key] = $this-&gt;parse(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value[$key], <span class="keyword">false</span>);</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;                }</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;                </div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;                <span class="keywordflow">return</span> $value;</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;        }</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;        </div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;        </div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        <span class="keyword">function</span> parseString( $str, $values ){</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;                <span class="keywordflow">if</span> ( !is_string($str) ) <span class="keywordflow">return</span> $str;</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;                $matches = array();</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;                $blackString = $str;</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;                <span class="keywordflow">while</span> ( preg_match( <span class="stringliteral">&#39;/(?&lt;!\\\)\$([0-9a-zA-Z\._\-]+)/&#39;</span>, $blackString, $matches ) ){</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;                        <span class="keywordflow">if</span> ( $this-&gt;hasField($matches[1]) ){</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;                                $replacement = $this-&gt;normalize($matches[1], $values[$matches[1]]);</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;                                </div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;                                $replacement = <span class="stringliteral">&#39;\$0&#39;</span>;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;                        }</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;                        $str = preg_replace( <span class="stringliteral">&#39;/(?&lt;!\\\)\$&#39;</span>.$matches[1].<span class="charliteral">&#39;/&#39;</span>, $replacement, $str);</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;                        $blackString = preg_replace( <span class="stringliteral">&#39;/(?&lt;!\\\)\$&#39;</span>.$matches[1].<span class="charliteral">&#39;/&#39;</span>, <span class="stringliteral">&quot;&quot;</span>, $blackString);</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;                        </div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;                }</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;                <span class="keywordflow">return</span> $str;</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;        }</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;        </div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        </div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;        </div>
<div class="line"><a name="l05193"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a4fb85c18914a8362c8d00d23e076c014"> 5193</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a4fb85c18914a8362c8d00d23e076c014" title="Validates against a field of this table. This checks if a value is valid for this a field of this tab...">validate</a>(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>, $value, &amp;$params){</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;                <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a> =&amp; $this-&gt;getField(<a class="code" href="blob_8php.html#a6f57b00c360f3bd8c95e1b281ce9d900">$fieldname</a>);</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;widget&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;file&#39;</span> and is_uploaded_file(@$value[<span class="stringliteral">&#39;tmp_name&#39;</span>]) and is_array($value)){</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;                        <span class="comment">// This bit of validation code is executed for files that have just been uploaded from the form.</span></div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;                        <span class="comment">// It expects the value to be an array of the form:</span></div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;                        <span class="comment">// eg: array(&#39;tmp_name&#39;=&gt;&#39;/path/to/uploaded/file&#39;, &#39;name&#39;=&gt;&#39;filename.txt&#39;, &#39;type&#39;=&gt;&#39;image/gif&#39;).</span></div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;                        </div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;                        <span class="keywordflow">if</span> ( !is_array(@<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]) and @<a class="code" href="blob_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]){</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;                                $field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>] = explode(<span class="charliteral">&#39;,&#39;</span>,@$field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]);</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;                        }</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;                        <span class="keywordflow">if</span> ( !is_array(@$field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]) and @$field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>] ){</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;                                $field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>] = explode(<span class="charliteral">&#39;,&#39;</span>,@$field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]);</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;                        }</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;                        <span class="keywordflow">if</span> ( !is_array(@$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>]) and @$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>] ){</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;                                $field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>] = explode(<span class="charliteral">&#39;,&#39;</span>,@$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>]);</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;                        }</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;                        <span class="keywordflow">if</span> ( !is_array(@$field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>]) and @$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>]){</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;                                $field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>] = explode(<span class="charliteral">&#39;,&#39;</span>,@$field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>]);</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;                        }</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;                        </div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;                        $field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>] = @array_map(<span class="stringliteral">&#39;strtolower&#39;</span>, @$field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]);</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;                        $field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>] = @array_map(<span class="stringliteral">&#39;strtolower&#39;</span>, @$field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]);</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;                        $field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>] = @array_map(<span class="stringliteral">&#39;strtolower&#39;</span>, @$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>]);</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;                        $field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>] = @array_map(<span class="stringliteral">&#39;strtolower&#39;</span>, @$field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>]);</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;                        <span class="comment">// We do some special validation for file uploads</span></div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;                        <span class="comment">// Validate -- make sure that it is the proper mimetype and extension.</span></div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;                        <span class="keywordflow">if</span> ( is_array( @$field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>] ) and count($field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]) &gt; 0 ){</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;                                <span class="keywordflow">if</span> ( !in_array($value[<span class="stringliteral">&#39;type&#39;</span>], $field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]) ){</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;                                        $params[<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;The file submitted in field &#39;&quot;</span>.$field[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;&#39; is not the correct type.  Received &#39;&quot;</span>.$value[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&#39; but require one of (&quot;</span>.implode(<span class="charliteral">&#39;,&#39;</span>, $field[<span class="stringliteral">&#39;allowed_mimetypes&#39;</span>]).<span class="stringliteral">&quot;).&quot;</span>;</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;                                        </div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;                                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;                                }</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;                        }</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;                        </div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;                        <span class="keywordflow">if</span> ( @is_array(@$field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>]) and in_array($value[<span class="stringliteral">&#39;type&#39;</span>], $field[<span class="stringliteral">&#39;disallowed_mimetypes&#39;</span>]) ){</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;                                $params[<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;The file submitted in field &#39;&quot;</span>.$fieldname.<span class="stringliteral">&quot;&#39; has a restricted mime type.  The mime type received was &#39;&quot;</span>.$value[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&#39;.&quot;</span>;</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;                        }</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;                        </div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;                        $extension = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;                        $matches = array();</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;                        <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/\.([^\.]+)$/&#39;</span>, $value[<span class="stringliteral">&#39;name&#39;</span>], $matches) ){</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;                                $extension = $matches[1];</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;                        }</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;                        $extension = strtolower($extension);</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;                        </div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;                        </div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;                        <span class="keywordflow">if</span> ( is_array( @$field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>] ) and count($field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]) &gt; 0 ){</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;                                <span class="keywordflow">if</span> ( !in_array($extension, $field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]) ){</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;                                        $params[<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;The file submitted does not have the correct extension.  Received file has extension &#39;&quot;</span>.$extension.<span class="stringliteral">&quot;&#39; but the field requires either &quot;</span>.implode(<span class="stringliteral">&#39; or &#39;</span>, $field[<span class="stringliteral">&#39;allowed_extensions&#39;</span>]).<span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;                                        </div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;                                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;                                }</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;                        }</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;        </div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;                        <span class="keywordflow">if</span> ( @is_array( @$field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>] ) and in_array($extension, $field[<span class="stringliteral">&#39;disallowed_extensions&#39;</span>]) ){</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;                                $params[<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;The file submitted in field &#39;&quot;</span>.$fieldname.<span class="stringliteral">&quot;&#39; has a restricted extension.  Its extension was &#39;&quot;</span>.$extension.<span class="stringliteral">&quot;&#39; which is disallowed for this form.&quot;</span>;</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;                        }</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;                        </div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;                        <span class="keywordflow">if</span> ( @$field[<span class="stringliteral">&#39;max_size&#39;</span>] and intval($field[<span class="stringliteral">&#39;max_size&#39;</span>]) &lt; intval(@$value[<span class="stringliteral">&#39;size&#39;</span>]) ){</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;                                $params[<span class="stringliteral">&#39;message&#39;</span>] = <span class="stringliteral">&quot;The file submitted in field &#39;&quot;</span>.$fieldname.<span class="stringliteral">&quot;&#39; is {$value[&#39;size&#39;]} bytes which exceeds the limit of {$field[&#39;max_size&#39;]} bytes for this field.&quot;</span>;</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;                        }</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;                }</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;                </div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;                <span class="comment">//$delegate =&amp; $this-&gt;getDelegate();</span></div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;                <span class="comment">//if ( $delegate !== null and method_exists($delegate, $fieldname.&quot;__validate&quot;) ){</span></div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;                <span class="comment">//      /*</span></div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;                <span class="comment">//       *</span></div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;                <span class="comment">//       * The delegate defines a custom validation method for this field.  Use it.</span></div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;                <span class="comment">//       *</span></div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;                <span class="comment">//       */</span></div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;                <span class="comment">//      return call_user_func(array(&amp;$delegate, $fieldname.&quot;__validate&quot;), $this, $value, $params);</span></div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;                <span class="comment">//}</span></div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        }</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;         </div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;         </div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        <span class="comment">// End Field Data Manipulation</span></div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;        </div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;        </div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;        </div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l05295"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a2f6c94651644a298a937ffd14eb14100"> 5295</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a2f6c94651644a298a937ffd14eb14100" title="Displays a block from the delegate class. Blocks are defined in the delegate class by defining method...">displayBlock</a>($blockName, $params=array()){</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;                <span class="keywordflow">if</span> ( @$this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;debug&#39;</span>] ) echo <span class="stringliteral">&quot;&lt;div class=\&quot;debug_marker\&quot;&gt;Block &amp;quot;$blockName&amp;quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;                $delegate =&amp; $this-&gt;getDelegate();</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;                <span class="comment">//echo &quot;Checking for block $blockName&quot;;</span></div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;                $res = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;                </div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;                <span class="comment">// Add the ability for Modules to define blocks without conflicting with</span></div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;                <span class="comment">// defined blocks in the application.</span></div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;                <span class="comment">// Added Feb. 28, 2007 by Steve Hannah for 0.6.14 release.</span></div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;                $mres = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;                <span class="keywordflow">if</span> ( isset($this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) and count($this-&gt;app-&gt;_conf[<span class="stringliteral">&#39;_modules&#39;</span>]) &gt; 0){</div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;                        $mtool =&amp; <a class="code" href="class_dataface___module_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ModuleTool::getInstance</a>();</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;                        $mres = $mtool-&gt;displayBlock($blockName, $params);</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;                }</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;                <span class="keywordflow">if</span> ( isset($delegate) and method_exists($delegate, <span class="stringliteral">&#39;block__&#39;</span>.$blockName) ){</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;                        $methodname = <span class="stringliteral">&#39;block__&#39;</span>.$blockName;</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;                        $fres = $delegate-&gt;$methodname($params);</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;                        <span class="comment">//$fres = call_user_func(array(&amp;$delegate, &#39;block__&#39;.$blockName), $params);</span></div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;                        <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($fres) ) </div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;                                $res = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;                </div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;                        $appDelegate =&amp; $this-&gt;app-&gt;getDelegate();</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;                        <span class="keywordflow">if</span> (isset($appDelegate) and method_exists($appDelegate, <span class="stringliteral">&#39;block__&#39;</span>.$blockName) ){</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;                                $methodname = <span class="stringliteral">&#39;block__&#39;</span>.$blockName;</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;                                $fres = $appDelegate-&gt;$methodname($params);</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;                                <span class="comment">//$fres = call_user_func(array(&amp;$appDelegate, &#39;block__&#39;.$blockName), $params);</span></div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;                                <span class="keywordflow">if</span> ( !<a class="code" href="class_p_e_a_r.html#ae59587d5f701115ff0ae38bd852789db">PEAR::isError</a>($fres) )</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;                                        $res = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;                        }</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;                }</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;                <span class="keywordflow">return</span> ($res or $mres);</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;                </div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;        }</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;        </div>
<div class="line"><a name="l05336"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aaaa6c2bd542e4dfc3965b2e4651ce926"> 5336</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#aaaa6c2bd542e4dfc3965b2e4651ce926" title="Returns the content of a given block as a string.">getBlockContent</a>($blockName, $params=array()){</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;                ob_start();</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;                $res = $this-&gt;displayBlock($blockName, $params);</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;                <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a> = ob_get_contents();</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;                ob_end_clean();</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;                <span class="keywordflow">if</span> ( !$res ) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="ini2csv_8php.html#a48cb304902320d173a4eaa41543327b9">$out</a>;</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;        }</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;         </div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;         </div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;        <span class="comment">// End Templates</span></div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        </div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        </div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;                        </div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l05367"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a4991ab724c8a322d4c666e87173a2fb4"> 5367</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a4991ab724c8a322d4c666e87173a2fb4" title="Returns a new blank Dataface_Record object for this table.">newRecord</a>($vals=null){</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a>($this-&gt;tablename, $vals);</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;        }</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;        </div>
<div class="line"><a name="l05377"></a><span class="lineno"><a class="code" href="class_dataface___table.html#aa3bd0124b303072bd7284dc461b96a12"> 5377</a></span>&#160;        <span class="keyword">function</span> &amp;<a class="code" href="class_dataface___table.html#aa3bd0124b303072bd7284dc461b96a12" title="Gets a record from the database that matches the given query.">getRecord</a>($query=null){</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;                <span class="keywordflow">return</span> df_get_record($this-&gt;tablename, $query);</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;        }</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;         </div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;        <span class="comment">// End Factory Methods</span></div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        </div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;        </div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;<span class="comment"></span>        <span class="keyword">function</span> baseUrl(){</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;                <span class="keywordflow">return</span> DATAFACE_SITE_URL;</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;                <span class="comment">//return $GLOBALS[&#39;Dataface_Globals_BaseUrl&#39;];</span></div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;        </div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;        }</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;        </div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;        </div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> $basePaths = array();</div>
<div class="line"><a name="l05410"></a><span class="lineno"><a class="code" href="class_dataface___table.html#a2cc6873e75ff773816de1b8429d73e63"> 5410</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#a2cc6873e75ff773816de1b8429d73e63">setBasePath</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>){</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;                self::$basePaths[<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>] = <a class="code" href="css_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>;</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;        }</div>
<div class="line"><a name="l05413"></a><span class="lineno"><a class="code" href="class_dataface___table.html#adc197cb28172c1a23bb0e603250ceb90"> 5413</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#adc197cb28172c1a23bb0e603250ceb90">getBasePath</a>(<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>){</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;                <span class="keywordflow">if</span> ( isset(self::$basePaths[<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>]) ){</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;                        <span class="keywordflow">return</span> self::$basePaths[<a class="code" href="blob_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>];</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;                        <span class="keywordflow">return</span> DATAFACE_SITE_PATH;</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;                }</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;        }</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;        </div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;        <span class="keyword">function</span> basePath(){</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;                </div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;                <span class="keywordflow">return</span> self::getBasePath($this-&gt;tablename);</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;                <span class="comment">//return realpath($GLOBALS[&#39;Dataface_Globals_BasePath&#39;]);</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;        }</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;        </div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;        </div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;        </div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;        </div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;        </div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;        <span class="keyword">function</span> getIniFile(){</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_iniFile;</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;        }</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;        </div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;        <span class="keyword">function</span> setIniFile($file){</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;                $this-&gt;_iniFile = $file;</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;        }</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;        </div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;        </div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;        </div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;        </div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        </div>
<div class="line"><a name="l05462"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ac01828cae86291d0bc8a78b24de6089f"> 5462</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ac01828cae86291d0bc8a78b24de6089f" title="Clears the table&#39;s cache. This is generally handled automatically but if you want to ensure that valu...">clearCache</a>(){</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;                $this-&gt;_cache = array();</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;        }</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;</div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;        </div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;        </div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;        </div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;        </div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;        </div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        </div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;        <span class="keyword">function</span> date_to_string($value){</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;        </div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface__converters__date.html#a456ce720de2df84b1b4d8135d7bded99">Dataface_converters_date::date_to_string</a>($value);</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;                </div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;        </div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;        }</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;        </div>
<div class="line"><a name="l05490"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ab4d80bb351431827d2ef1a4c288c5c5a"> 5490</a></span>&#160;        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ab4d80bb351431827d2ef1a4c288c5c5a" title="Gets the serializer object that is used to serialize data in this table.">getSerializer</a>(){</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;                <span class="keywordflow">if</span> ( !isset( $this-&gt;_serializer ) ){</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;                        $this-&gt;_serializer = <span class="keyword">new</span> <a class="code" href="class_dataface___serializer.html">Dataface_Serializer</a>($this-&gt;tablename);</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;                }</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;                <span class="keywordflow">return</span> $this-&gt;_serializer;</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;        }</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;        </div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;        <span class="keyword">function</span> datetime_to_string($value){ </div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_dataface__converters__date.html#a8590e6e5c1c2262c84879d3454cee9c1">Dataface_converters_date::datetime_to_string</a>($value);</div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;        }</div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;        </div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;        <span class="keyword">function</span> time_to_string($value){ <span class="keywordflow">return</span> <a class="code" href="class_dataface__converters__date.html#a0da8a4c086fe7dac3075bd43cd766baf">Dataface_converters_date::time_to_string</a>($value); }</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;        </div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;        <span class="keyword">function</span> timestamp_to_string($value){ <span class="keywordflow">return</span> <a class="code" href="class_dataface__converters__date.html#ad77f4c1fa858f923e2e4871999510976">Dataface_converters_date::timestamp_to_string</a>($value); }</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;        </div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;        </div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;        </div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;         </div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;        <span class="comment">// End Utility Methods</span></div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;        </div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;        </div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;        <span class="comment">// @{</span></div>
<div class="line"><a name="l05551"></a><span class="lineno"><a class="code" href="class_dataface___table.html#ace4c64661ffa184e4f89fa1346c9e763"> 5551</a></span>&#160;<span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_dataface___table.html#ace4c64661ffa184e4f89fa1346c9e763" title="Returns the actions for this table.">getActions</a>(&amp;$params,$noreturn=<span class="keyword">false</span>){</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;                <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ActionTool.php&#39;</span>);</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;                $actionsTool =&amp; <a class="code" href="class_dataface___action_tool.html#a9eb606fdb589cab3ae9edc96dce15972">Dataface_ActionTool::getInstance</a>();</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;                <span class="keywordflow">if</span> ( !$this-&gt;_actionsLoaded  ){</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;                        $this-&gt;_actionsLoaded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;                        <span class="keyword">import</span>( <span class="stringliteral">&#39;Dataface/ConfigTool.php&#39;</span>);</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;                        $configTool =&amp; <a class="code" href="class_dataface___config_tool.html#a940c46dff92c1704a1d43d2926a72ba0">Dataface_ConfigTool::getInstance</a>();</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;                        $actions =&amp; $configTool-&gt;loadConfig(<span class="stringliteral">&#39;actions&#39;</span>,$this-&gt;tablename);</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;                        <span class="comment">//print_r($actions);</span></div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;                        <span class="comment">//$singularLabel = $this-&gt;getSingularLabel();</span></div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;                        <span class="comment">//$pluralLabel = $this-&gt;getLabel();</span></div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;                        <span class="keywordflow">foreach</span> ($actions as $key=&gt;$action){</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;                                $action[<span class="stringliteral">&#39;table&#39;</span>] = <a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;                                $action[<span class="stringliteral">&#39;name&#39;</span>] = $key;</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;                                <span class="keywordflow">if</span> ( !isset($action[<span class="stringliteral">&#39;id&#39;</span>]) ) $action[<span class="stringliteral">&#39;id&#39;</span>] = $action[<span class="stringliteral">&#39;name&#39;</span>];</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;                                <span class="keywordflow">if</span> ( !isset($action[<span class="stringliteral">&#39;label&#39;</span>]) ) $action[<span class="stringliteral">&#39;label&#39;</span>] = str_replace(<span class="charliteral">&#39;_&#39;</span>,<span class="charliteral">&#39; &#39;</span>,ucfirst($action[<span class="stringliteral">&#39;name&#39;</span>]));</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;                                <span class="keywordflow">if</span> ( !isset($action[<span class="stringliteral">&#39;accessKey&#39;</span>])) $action[<span class="stringliteral">&#39;accessKey&#39;</span>] = substr($action[<span class="stringliteral">&#39;name&#39;</span>],0,1);</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;                                <span class="keywordflow">if</span> ( !isset($action[<span class="stringliteral">&#39;label_i18n&#39;</span>]) ) $action[<span class="stringliteral">&#39;label_i18n&#39;</span>] = <span class="stringliteral">&#39;action:&#39;</span>.$action[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39; label&#39;</span>;</div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;                                <span class="keywordflow">if</span> ( !isset($action[<span class="stringliteral">&#39;description_i18n&#39;</span>])) $action[<span class="stringliteral">&#39;description_i18n&#39;</span>] = <span class="stringliteral">&#39;action:&#39;</span>.$action[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39; description&#39;</span>;</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;                                <span class="keywordflow">if</span> ( isset($action[<span class="stringliteral">&#39;description&#39;</span>]) ){</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;                                        $action[<span class="stringliteral">&#39;description&#39;</span>] = df_translate(<span class="stringliteral">&#39;actions.&#39;</span>.$action[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39;.description&#39;</span>, $action[<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;                                }</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;                                <span class="keywordflow">if</span> ( isset($action[<span class="stringliteral">&#39;label&#39;</span>]) ){</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;                                        <span class="comment">//$action[&#39;label&#39;] = df_translate(&#39;actions.&#39;.$action[&#39;name&#39;].&#39;.label&#39;,$action[&#39;label&#39;], array(&#39;table_label_singular&#39;=&gt;$singularLabel, &#39;table_label_plural&#39;=&gt;$pluralLabel));</span></div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;                                    $action[<span class="stringliteral">&#39;label&#39;</span>] = df_translate(<span class="stringliteral">&#39;actions.&#39;</span>.$action[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&#39;.label&#39;</span>,$action[<span class="stringliteral">&#39;label&#39;</span>]);</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;                                }</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;                                </div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;                                $actionsTool-&gt;addAction($key, $action);</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;                        }</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;                        </div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;                        </div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;                }</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;                </div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;                $params[<span class="stringliteral">&#39;table&#39;</span>] = <a class="code" href="blob_8php.html#ab55152af3e5453213c2891ba55a0c6d5">$this-&gt;tablename</a>;</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;                <span class="keywordflow">if</span> ( $noreturn ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;                <span class="keywordflow">return</span> $actionsTool-&gt;getActions($params);</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;                        </div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;        }</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;        </div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;        </div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;        <span class="comment">// @}</span></div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;        <span class="comment">// End Actions</span></div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 5 2014 09:52:18 for Xataface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
