<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Xataface: Dataface_HistoryTool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xataface-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xataface
   &#160;<span id="projectnumber">2.0alpha2</span>
   </div>
   <div id="projectbrief">Xataface Application Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">Dataface_HistoryTool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a20eb5996ee886b3be8bb151283327ddf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a20eb5996ee886b3be8bb151283327ddf">logRecord</a> (&amp;$record, $comments='', $lang=null, $state=null)</td></tr>
<tr class="separator:a20eb5996ee886b3be8bb151283327ddf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eea3536087dac06901abeab905823f7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a9eea3536087dac06901abeab905823f7">logField</a> (&amp;$record, $fieldname, $history_id)</td></tr>
<tr class="separator:a9eea3536087dac06901abeab905823f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d3bd51da7e9ed1d06ad060c6c9276a8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a0d3bd51da7e9ed1d06ad060c6c9276a8">logTableName</a> ($tablename)</td></tr>
<tr class="separator:a0d3bd51da7e9ed1d06ad060c6c9276a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49f9b5616860d46f80272b279c831c81"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a49f9b5616860d46f80272b279c831c81">updateHistoryTable</a> ($tablename)</td></tr>
<tr class="separator:a49f9b5616860d46f80272b279c831c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa32bc806408bb9d0dde14df1902e2c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#aaa32bc806408bb9d0dde14df1902e2c2">createHistoryTable</a> ($tablename)</td></tr>
<tr class="separator:aaa32bc806408bb9d0dde14df1902e2c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cd43ce1cec2f00ae4e9f7d879f976e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a4cd43ce1cec2f00ae4e9f7d879f976e6">getDiffs</a> ($tablename, $id1, $id2=null, $fieldname=null)</td></tr>
<tr class="separator:a4cd43ce1cec2f00ae4e9f7d879f976e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6df1ebba98d0df2a96df652642f32bef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a6df1ebba98d0df2a96df652642f32bef">getDiffsByDate</a> (&amp;$record, $date1, $date2=null, $lang=null, $fieldname=null)</td></tr>
<tr class="separator:a6df1ebba98d0df2a96df652642f32bef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5a12a786338a85db5f077ecaaddb9fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#aa5a12a786338a85db5f077ecaaddb9fb">restore</a> (&amp;$record, $id, $fieldname=null, $secure=false)</td></tr>
<tr class="separator:aa5a12a786338a85db5f077ecaaddb9fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed314a780b88e87e3bc89ab8b974a535"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#aed314a780b88e87e3bc89ab8b974a535">restoreField</a> (&amp;$record, &amp;$old_record, $id, $fieldname)</td></tr>
<tr class="separator:aed314a780b88e87e3bc89ab8b974a535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09709a261f06de775f739ba09d8fa288"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a09709a261f06de775f739ba09d8fa288">restoreToDate</a> (&amp;$record, $date, $lang=null, $fieldname=null)</td></tr>
<tr class="separator:a09709a261f06de775f739ba09d8fa288"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57c2e76c52fccca4b4bc3d546b88a324"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a57c2e76c52fccca4b4bc3d546b88a324">getPreviousVersion</a> (&amp;$record, $date, $lang=null, $fieldname=null, $idonly=false)</td></tr>
<tr class="separator:a57c2e76c52fccca4b4bc3d546b88a324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ba94fef14abbcf131d73aaf6a535e26"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a8ba94fef14abbcf131d73aaf6a535e26">getRecordById</a> ($tablename, $id)</td></tr>
<tr class="separator:a8ba94fef14abbcf131d73aaf6a535e26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3159a06d0d593a8f4c9734b8fa21f10"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#ab3159a06d0d593a8f4c9734b8fa21f10">getHistoryLog</a> (&amp;$record, $lang=null, $limit=100)</td></tr>
<tr class="separator:ab3159a06d0d593a8f4c9734b8fa21f10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21eff515f08607a6739fbba5057b7ec9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a21eff515f08607a6739fbba5057b7ec9">findMatchingSnapshots</a> ($record, $query, $idsOnly=true)</td></tr>
<tr class="separator:a21eff515f08607a6739fbba5057b7ec9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a03f94c8e2cc32ad2d98bfc28a10e1e63"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_dataface___history_tool.html#a03f94c8e2cc32ad2d98bfc28a10e1e63">$meta_fields</a></td></tr>
<tr class="separator:a03f94c8e2cc32ad2d98bfc28a10e1e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manages the history of records. This class will record the state of each record in the database by copying it to a 'history' table. A separate history table is created for each table in the database.</p>
<p>In addition to storing all of the information in the subject table (the table that is being backed up), the history table stores the language of the record, the username of the user performing the update, some optional state information, a comments field and a modified timestamp to track when the record is from.</p>
<p>This class can be used to restore records to a previous state.</p>
<p>Usage:</p>
<p><code> $ht = new Dataface_HistoryTool(); $record = df_get_record('Profiles', array('id'=&gt;10)); // get the profile with ID 10. $ht-&gt;restoreToDate($record, '2004-5-10'); // restores the record to the way it was on 2004-5-10</code></p>
<p><code> </code></p>
<p>History tables are created to follow the following naming convention. The history table for the table named 'Foo' would be called 'Foo__history'. If Foo contains a container field whose files are saved in the folder /path/to/foo then their history files (the backups for the history table) will be stored in /path/to/foo/.dataface_history/ with the file name the same as the history id (The value of the history__id column for that entry.</p>
<p>History is automatically stored if the [history] section is present in the conf.ini file. If it is not, you can manually record the history for a record using the logRecord method as follows:</p>
<p><code> $ht = new Dataface_HistoryTool(); $hid = $ht-&gt;logRecord($record); // $hid is the id of the history record.</code></p>
<p><code>$historyRecord = $ht-&gt;getRecordById($record-&gt;_table-&gt;tablename, $hid); // obtains the <a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> for the corresponding record of the history // table. // $historyRecord and $record should contain nearly identical values, // except that $historyRecord contains extra history information // like timestamps etc. </code></p>
<p>You can obtain a previous version of a record without actually restoring the database record to that version using the <a class="el" href="class_dataface___history_tool.html#a57c2e76c52fccca4b4bc3d546b88a324">getPreviousVersion()</a> method:</p>
<p><code> $historyTool = new Dataface_HistoryTool(); $record = df_get_record('Profiles', array('id'=&gt;10)); $old_record = $ht-&gt;getPreviousVersion($record, '2004-10-10'); // Now $old_record is a <a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> object for the "Profiles" table //representing the status of $record on 2004-10-10. </code></p>
<dl class="section author"><dt>Author</dt><dd>Steve Hannah (<a href="#" onclick="location.href='mai'+'lto:'+'sha'+'nn'+'ah@'+'sf'+'u.c'+'a'; return false;">shann<span style="display: none;">.nosp@m.</span>ah@s<span style="display: none;">.nosp@m.</span>fu.ca</a>)  September 2006 </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00064">64</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aaa32bc806408bb9d0dde14df1902e2c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">createHistoryTable </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tablename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a history table corresponding to the given table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$tablename</td><td>The name of the table whose history table is to be created. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00288">288</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a21eff515f08607a6739fbba5057b7ec9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">findMatchingSnapshots </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$idsOnly</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns an array of history ids of history records that match the given query. </p>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00687">687</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a4cd43ce1cec2f00ae4e9f7d879f976e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getDiffs </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tablename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id2</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets an HTML diff output between the records at $id1 and $id2 respectively, where $id1 and $id2 are history ids from the history__id column of the history table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$tablename</td><td>The name of the base table. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$id1</td><td>The id number of the first record (from the history__id column) </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$id2</td><td>The id of the second record (from the history__id column) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>Optional name of a field to return. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed Either the value of the specified field name if $fieldname is specified, or a <a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> object whose field values are formatted diffs. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00336">336</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a6df1ebba98d0df2a96df652642f32bef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getDiffsByDate </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$date1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$date2</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lang</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets the changes for a given record between dates. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record we are checking for changes on. This is a record of the base table, and not its history table. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$date1</td><td>The start date as an SQL date string (e.g. YYYY-MM-DD) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$date2</td><td>The end date as an SQL date string (e.g. YYYY-MM-DD) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$lang</td><td>The 2-digit language code of the language we are using. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>Optional fieldname </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed Either a <a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> object from the history table, whose values are the formatted diffs - or the formatted diff for the specified $fieldname. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00393">393</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="ab3159a06d0d593a8f4c9734b8fa21f10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getHistoryLog </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lang</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$limit</em> = <code>100</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns an array of the meta fields from the history table in descending order of modified date. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record we wish to obtain history for. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$lang</td><td>The 2-digit language code. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$limit</td><td>The maximum number of records to return. null for unlimited. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Array of Associative arrays. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00654">654</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a57c2e76c52fccca4b4bc3d546b88a324"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getPreviousVersion </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$date</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lang</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$idonly</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns a previous version of the given record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record whose previous version we are interested in. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$date</td><td>The MySQL date to obtain. Returns the most recent record on or before this date. (e.g. YYYY-MM-DD HH:MM:SS) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>If we only want the previous version of a single field we can include it here. </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$idonly</td><td>If this is set to true then only the history id of the appropriate record will be returned. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed If $idonly is true then an integer is returned corresponding to the value of the history__id field for the matching record. If The $fieldname field was specified then the value of that field will be returned. Otherwise a <a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> will be returned. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00587">587</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a8ba94fef14abbcf131d73aaf6a535e26"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getRecordById </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tablename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Obtains a record from the history table given the value in the history__id column. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$tablename</td><td>The name of the base table. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$id</td><td>The id (history__id column value). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a> from the history table. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00631">631</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a9eea3536087dac06901abeab905823f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logField </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$history_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performs extra logging steps for fields. This method is called by <a class="el" href="class_dataface___history_tool.html#a20eb5996ee886b3be8bb151283327ddf">logRecord()</a>. In particular for container fields, this will copy the container's files into the hidden .dataface_history subdirectory of the container field's save path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record whose field is being logged. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>The name of the field to perform extra steps for. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$history_id</td><td>The id of the history record for the record that is being logged. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00166">166</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a20eb5996ee886b3be8bb151283327ddf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logRecord </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$comments</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lang</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$state</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Backs up a record to the history table. This will automatically happen when using Dataface_IO::save() if the [history] section exists in the conf.ini file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record that is being backed up. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$comments</td><td>Comments about this version to be stored. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$lang</td><td>The 2-digit language code of which language to use to back up this record. If none is specified then the current language of the system will be used. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$state</td><td>Unused as yet. Was intended to store state/workflow information.. but .. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>integer The history id of the resulting history record. </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00094">94</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a0d3bd51da7e9ed1d06ad060c6c9276a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logTableName </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tablename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a table name - this returns the name of the table's history table.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$tablename</td><td>The name of the table whose history we want. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00226">226</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="aa5a12a786338a85db5f077ecaaddb9fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">restore </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$secure</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Restores an old version of the given record, from the history table. </p>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00462">462</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="aed314a780b88e87e3bc89ab8b974a535"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">restoreField </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$old_record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performs extra steps to restore particular fields. Any steps outside of copying the field values form the history table back to the main table. In particular container fields need to have their files copied back from the history subdirectory into the container field's save path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record whose field we are restoring. </td></tr>
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$old_record</td><td>The record as is was before the restore. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$id</td><td>The History id (The value in the history__id column) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>The name of the field to restore. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00515">515</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a09709a261f06de775f739ba09d8fa288"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">restoreToDate </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$date</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lang</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fieldname</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Restores a record to a particular date. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_dataface___record.html" title="Represents a single record from a table.">Dataface_Record</a></td><td class="paramname">&amp;$record</td><td>The record to be restored. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$date</td><td>The date to restore to as a MySQL date string (e.g. YYYY-MM-DD HH:MM:SS) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$lang</td><td>The 2-digit language code of the version to restore. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$fieldname</td><td>If we are only restoring a single field we include the name here. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00550">550</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<a class="anchor" id="a49f9b5616860d46f80272b279c831c81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">updateHistoryTable </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tablename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates the history table for a particular table so that it exists and contains all of the correct columns. </p>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00234">234</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a class="anchor" id="a03f94c8e2cc32ad2d98bfc28a10e1e63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$meta_fields</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= array(</div>
<div class="line">                <span class="stringliteral">&#39;history__id&#39;</span>=&gt;array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;int(11)&#39;</span>, <span class="stringliteral">&#39;Extra&#39;</span>=&gt;<span class="stringliteral">&#39;auto_increment&#39;</span>),</div>
<div class="line">                        <span class="stringliteral">&#39;history__language&#39;</span>=&gt; array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;varchar(2)&#39;</span>),</div>
<div class="line">                        <span class="stringliteral">&#39;history__comments&#39;</span>=&gt; array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;text&#39;</span>),</div>
<div class="line">                        <span class="stringliteral">&#39;history__user&#39;</span>=&gt;array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;varchar(32)&#39;</span>),</div>
<div class="line">                        <span class="stringliteral">&#39;history__state&#39;</span>=&gt;array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;int(5)&#39;</span>),</div>
<div class="line">                        <span class="stringliteral">&#39;history__modified&#39;</span>=&gt;array(<span class="stringliteral">&#39;Type&#39;</span>=&gt;<span class="stringliteral">&#39;datetime&#39;</span>)</div>
<div class="line">                        )</div>
</div><!-- fragment --><p>The fields that should appear in every history table. </p>

<p>Definition at line <a class="el" href="_history_tool_8php_source.html#l00069">69</a> of file <a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Dataface/<a class="el" href="_history_tool_8php_source.html">HistoryTool.php</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 5 2014 09:52:19 for Xataface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
