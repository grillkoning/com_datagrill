<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Effect</span><span class="PUNC">==</span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"dragdrop.js requires including script.aculo.us' effects.js library"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Droppables</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">drops</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">remove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drops</span><span class="PUNC">=</span><span class="NAME">this.drops.reject</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.element</span><span class="PUNC">==</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">add</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">greedy</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">hoverclass</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">tree</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.containment</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options._containers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containment</span><span class="PUNC">=</span><span class="NAME">options.containment</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">containment</span><span class="PUNC">==</span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">containment.constructor</span><span class="PUNC">==</span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">containment.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options._containers.push</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">options._containers.push</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">containment</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.accept</span><span class="PUNC">)</span><span class="NAME">options.accept</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">options.accept</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flatten</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Element.makePositioned</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">options.element</span><span class="PUNC">=</span><span class="NAME">element</span><span class="PUNC">;</span><span class="NAME">this.drops.push</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">findDeepestChild</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">drops</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">deepest</span><span class="PUNC">=</span><span class="NAME">drops</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">drops.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Element.isParent</span><span class="PUNC">(</span><span class="NAME">drops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">deepest.element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="NAME">deepest</span><span class="PUNC">=</span><span class="NAME">drops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deepest</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isContained</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containmentNode</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drop.tree</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">containmentNode</span><span class="PUNC">=</span><span class="NAME">element.treeNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">containmentNode</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">drop._containers.detect</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">containmentNode</span><span class="PUNC">==</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isAffected</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">drop.element</span><span class="PUNC">!=</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">drop._containers</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.isContained</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">drop.accept</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">Element.classNames</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">detect</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">drop.accept.include</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">Position.within</span><span class="PUNC">(</span><span class="NAME">drop.element</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drop.hoverclass</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="NAME">Element.removeClassName</span><span class="PUNC">(</span><span class="NAME">drop.element</span><span class="PUNC">,</span><span class="NAME">drop.hoverclass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.last_active</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drop.hoverclass</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="NAME">Element.addClassName</span><span class="PUNC">(</span><span class="NAME">drop.element</span><span class="PUNC">,</span><span class="NAME">drop.hoverclass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.last_active</span><span class="PUNC">=</span><span class="NAME">drop</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.drops.length</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">affected</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="NAME">this.deactivate</span><span class="PUNC">(</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.drops.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Droppables.isAffected</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="NAME">affected.push</span><span class="PUNC">(</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">affected.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">drop</span><span class="PUNC">=</span><span class="NAME">Droppables.findDeepestChild</span><span class="PUNC">(</span><span class="NAME">affected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Position.within</span><span class="PUNC">(</span><span class="NAME">drop.element</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drop.onHover</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="NAME">drop.onHover</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">drop.element</span><span class="PUNC">,</span><span class="NAME">Position.overlap</span><span class="PUNC">(</span><span class="NAME">drop.overlap</span><span class="PUNC">,</span><span class="NAME">drop.element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Droppables.activate</span><span class="PUNC">(</span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">fire</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">Position.prepare</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isAffected</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">Event.pointerX</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Event.pointerY</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.last_active.onDrop</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="NAME">this.last_active.onDrop</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">this.last_active.element</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">reset</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="NAME">this.deactivate</span><span class="PUNC">(</span><span class="NAME">this.last_active</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Draggables</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">drags</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">observers</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">register</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.drags.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eventMouseUp</span><span class="PUNC">=</span><span class="NAME">this.endDrag.bindAsEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eventMouseMove</span><span class="PUNC">=</span><span class="NAME">this.updateDrag.bindAsEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eventKeypress</span><span class="PUNC">=</span><span class="NAME">this.keyPress.bindAsEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.observe</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseUp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.observe</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseMove</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.observe</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"keypress"</span><span class="PUNC">,</span><span class="NAME">this.eventKeypress</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="NAME">this.drags.push</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unregister</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drags</span><span class="PUNC">=</span><span class="NAME">this.drags.reject</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">==</span><span class="NAME">draggable</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.drags.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseUp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseMove</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"keypress"</span><span class="PUNC">,</span><span class="NAME">this.eventKeypress</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">draggable.options.delay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._timeout</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Draggables._timeout</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">window.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.activeDraggable</span><span class="PUNC">=</span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">draggable.options.delay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">window.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.activeDraggable</span><span class="PUNC">=</span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.activeDraggable</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.activeDraggable</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointer</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">Event.pointerX</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Event.pointerY</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._lastPointer</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this._lastPointer.inspect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">pointer.inspect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this._lastPointer</span><span class="PUNC">=</span><span class="NAME">pointer</span><span class="PUNC">;</span><span class="NAME">this.activeDraggable.updateDrag</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">pointer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">endDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._timeout</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this._timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._timeout</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.activeDraggable</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this._lastPointer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.activeDraggable.endDrag</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.activeDraggable</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">keyPress</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.activeDraggable</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="NAME">this.activeDraggable.keyPress</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addObserver</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.observers.push</span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._cacheObserverCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeObserver</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.observers</span><span class="PUNC">=</span><span class="NAME">this.observers.reject</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o.element</span><span class="PUNC">==</span><span class="NAME">element</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._cacheObserverCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">notify</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">+</span><span class="STRN">'Count'</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="NAME">this.observers.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">draggable.options</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="NAME">draggable.options</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_cacheObserverCallbacks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">[</span><span class="STRN">'onStart'</span><span class="PUNC">,</span><span class="STRN">'onEnd'</span><span class="PUNC">,</span><span class="STRN">'onDrag'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Draggables</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">+</span><span class="STRN">'Count'</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Draggables.observers.select</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Draggable</span><span class="PUNC">=</span><span class="NAME">Class.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggable._dragging</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Draggable.prototype</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">handle</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">reverteffect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">top_offset</span><span class="PUNC">,</span><span class="NAME">left_offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dur</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">top_offset</span><span class="PUNC">^</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">left_offset</span><span class="PUNC">^</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">0.02</span><span class="PUNC">;</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Effect.Move</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">left_offset</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">top_offset</span><span class="PUNC">,</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="NAME">dur</span><span class="PUNC">,</span><span class="NAME">queue</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'_draggable'</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="STRN">'end'</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">endeffect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toOpacity</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">element._opacity</span><span class="PUNC">==</span><span class="STRN">'number'</span><span class="PUNC">?</span><span class="NAME">element._opacity</span><span class="PUNC">:</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Effect.Opacity</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">from</span><span class="PUNC">:</span><span class="NUMB">0.7</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">:</span><span class="NAME">toOpacity</span><span class="PUNC">,</span><span class="NAME">queue</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'_draggable'</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="STRN">'end'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">afterFinish</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Draggable._dragging</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zindex</span><span class="PUNC">:</span><span class="NUMB">1000</span><span class="PUNC">,</span><span class="NAME">revert</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">scroll</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">scrollSensitivity</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NAME">scrollSpeed</span><span class="PUNC">:</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="NAME">snap</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">delay</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endeffect</span><span class="PUNC">==</span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">starteffect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element._opacity</span><span class="PUNC">=</span><span class="NAME">Element.getOpacity</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggable._dragging</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Effect.Opacity</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">from</span><span class="PUNC">:</span><span class="NAME">element._opacity</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">:</span><span class="NUMB">0.7</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.handle</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options.handle</span><span class="PUNC">==</span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="NAME">this.handle</span><span class="PUNC">=</span><span class="NAME">this.element.down</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">+</span><span class="NAME">options.handle</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.handle</span><span class="PUNC">)</span><span class="NAME">this.handle</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">options.handle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.handle</span><span class="PUNC">)</span><span class="NAME">this.handle</span><span class="PUNC">=</span><span class="NAME">this.element</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.scroll</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">options.scroll.scrollTo</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">options.scroll.outerHTML</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.scroll</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">options.scroll</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._isScrollChild</span><span class="PUNC">=</span><span class="NAME">Element.childOf</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="NAME">options.scroll</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="NAME">Element.makePositioned</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.delta</span><span class="PUNC">=</span><span class="NAME">this.currentDelta</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">;</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.eventMouseDown</span><span class="PUNC">=</span><span class="NAME">this.initDrag.bindAsEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.observe</span><span class="PUNC">(</span><span class="NAME">this.handle</span><span class="PUNC">,</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseDown</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.register</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">this.handle</span><span class="PUNC">,</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="NAME">this.eventMouseDown</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.unregister</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">currentDelta</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">'0'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="STRN">'top'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">'0'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Draggable._dragging</span><span class="PUNC">[</span><span class="NAME">this.element</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="STRN">'undefined'</span><span class="PUNC">&&</span><span class="NAME">Draggable._dragging</span><span class="PUNC">[</span><span class="NAME">this.element</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">Event.element</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tag_name</span><span class="PUNC">=</span><span class="NAME">src.tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'INPUT'</span><span class="PUNC">||</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'SELECT'</span><span class="PUNC">||</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'OPTION'</span><span class="PUNC">||</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'BUTTON'</span><span class="PUNC">||</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'TEXTAREA'</span><span class="PUNC">||</span><span class="NAME">tag_name</span><span class="PUNC">==</span><span class="STRN">'IMG'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointer</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">Event.pointerX</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">Event.pointerY</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="PUNC">=</span><span class="NAME">Position.cumulativeOffset</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.offset</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.activate</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stop</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">startDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.zindex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.originalZ</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="STRN">'z-index'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.element.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.options.zindex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.ghosting</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._clone</span><span class="PUNC">=</span><span class="NAME">this.element.cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Position.absolutize</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.element.parentNode.insertBefore</span><span class="PUNC">(</span><span class="NAME">this._clone</span><span class="PUNC">,</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">==</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">where</span><span class="PUNC">=</span><span class="NAME">this._getWindowScroll</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.originalScrollLeft</span><span class="PUNC">=</span><span class="NAME">where.left</span><span class="PUNC">;</span><span class="NAME">this.originalScrollTop</span><span class="PUNC">=</span><span class="NAME">where.top</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.originalScrollLeft</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollLeft</span><span class="PUNC">;</span><span class="NAME">this.originalScrollTop</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollTop</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="NAME">Draggables.notify</span><span class="PUNC">(</span><span class="STRN">'onStart'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.starteffect</span><span class="PUNC">)</span><span class="NAME">this.options.starteffect</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">pointer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.dragging</span><span class="PUNC">)</span><span class="NAME">this.startDrag</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Position.prepare</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Droppables.show</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">,</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.notify</span><span class="PUNC">(</span><span class="STRN">'onDrag'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.change</span><span class="PUNC">)</span><span class="NAME">this.options.change</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.stopScrolling</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">==</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">with</span><span class="PUNC">(</span><span class="NAME">this._getWindowScroll</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">Position.page</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollLeft</span><span class="PUNC">+</span><span class="NAME">Position.deltaX</span><span class="PUNC">;</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollTop</span><span class="PUNC">+</span><span class="NAME">Position.deltaY</span><span class="PUNC">;</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scroll.offsetWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scroll.offsetHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">speed</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">></span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">></span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.options.scrollSensitivity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.startScrolling</span><span class="PUNC">(</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">navigator.appVersion.indexOf</span><span class="PUNC">(</span><span class="STRN">'AppleWebKit'</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">window.scrollBy</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stop</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">finishDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">success</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.ghosting</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Position.relativize</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Element.remove</span><span class="PUNC">(</span><span class="NAME">this._clone</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._clone</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">success</span><span class="PUNC">)</span><span class="NAME">Droppables.fire</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.notify</span><span class="PUNC">(</span><span class="STRN">'onEnd'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">revert</span><span class="PUNC">=</span><span class="NAME">this.options.revert</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">revert</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">revert</span><span class="PUNC">==</span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="NAME">revert</span><span class="PUNC">=</span><span class="NAME">revert</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.currentDelta</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">revert</span><span class="PUNC">&&</span><span class="NAME">this.options.reverteffect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.options.reverteffect</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.delta</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.delta</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.delta</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.zindex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="NAME">this.element.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.originalZ</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.endeffect</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="NAME">this.options.endeffect</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.deactivate</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Droppables.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">keyPress</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.keyCode</span><span class="PUNC">!=</span><span class="NAME">Event.KEY_ESC</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.finishDrag</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stop</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">endDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.dragging</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.stopScrolling</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.finishDrag</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Event.stop</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="PUNC">=</span><span class="NAME">Position.cumulativeOffset</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.ghosting</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">Position.realOffset</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">Position.deltaX</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">Position.deltaY</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.currentDelta</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">!=</span><span class="NAME">window</span><span class="PUNC">&&</span><span class="NAME">this._isScrollChild</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollLeft</span><span class="PUNC">-</span><span class="NAME">this.originalScrollLeft</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">this.options.scroll.scrollTop</span><span class="PUNC">-</span><span class="NAME">this.originalScrollTop</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.offset</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.snap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.options.snap</span><span class="PUNC">==</span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">this.options.snap</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.snap</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">p.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">/</span><span class="NAME">this.options.snap</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.options.snap</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">p.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">/</span><span class="NAME">this.options.snap</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.options.snap</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.element.style</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.options.constraint</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.options.constraint</span><span class="PUNC">==</span><span class="STRN">'horizontal'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="NAME">style.left</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.options.constraint</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.options.constraint</span><span class="PUNC">==</span><span class="STRN">'vertical'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="NAME">style.top</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.visibility</span><span class="PUNC">==</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="NAME">style.visibility</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stopScrolling</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.scrollInterval</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clearInterval</span><span class="PUNC">(</span><span class="NAME">this.scrollInterval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.scrollInterval</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">startScrolling</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.options.scrollSpeed</span><span class="PUNC">,</span><span class="NAME">speed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.options.scrollSpeed</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.lastScrolled</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.scrollInterval</span><span class="PUNC">=</span><span class="NAME">setInterval</span><span class="PUNC">(</span><span class="NAME">this.scroll.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scroll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="PUNC">=</span><span class="NAME">current</span><span class="PUNC">-</span><span class="NAME">this.lastScrolled</span><span class="PUNC">;</span><span class="NAME">this.lastScrolled</span><span class="PUNC">=</span><span class="NAME">current</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">==</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">with</span><span class="PUNC">(</span><span class="NAME">this._getWindowScroll</span><span class="PUNC">(</span><span class="NAME">this.options.scroll</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">delta</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="NAME">this.options.scroll.scrollTo</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.options.scroll.scrollLeft</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">delta</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="NAME">this.options.scroll.scrollTop</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">delta</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="NAME">Position.prepare</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Droppables.show</span><span class="PUNC">(</span><span class="NAME">Draggables._lastPointer</span><span class="PUNC">,</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables.notify</span><span class="PUNC">(</span><span class="STRN">'onDrag'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isScrollChild</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">=</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">||</span><span class="NAME">$A</span><span class="PUNC">(</span><span class="NAME">Draggables._lastPointer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">delta</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.scrollSpeed</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">delta</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="NAME">Draggables._lastScrollPointer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.change</span><span class="PUNC">)</span><span class="NAME">this.options.change</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_getWindowScroll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">T</span><span class="PUNC">,</span><span class="NAME">L</span><span class="PUNC">,</span><span class="NAME">W</span><span class="PUNC">,</span><span class="NAME">H</span><span class="PUNC">;</span><span class="KEYW">with</span><span class="PUNC">(</span><span class="NAME">w.document</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">w.document.documentElement</span><span class="PUNC">&&</span><span class="NAME">documentElement.scrollTop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">T</span><span class="PUNC">=</span><span class="NAME">documentElement.scrollTop</span><span class="PUNC">;</span><span class="NAME">L</span><span class="PUNC">=</span><span class="NAME">documentElement.scrollLeft</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">w.document.body</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">T</span><span class="PUNC">=</span><span class="NAME">body.scrollTop</span><span class="PUNC">;</span><span class="NAME">L</span><span class="PUNC">=</span><span class="NAME">body.scrollLeft</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">w.innerWidth</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">W</span><span class="PUNC">=</span><span class="NAME">w.innerWidth</span><span class="PUNC">;</span><span class="NAME">H</span><span class="PUNC">=</span><span class="NAME">w.innerHeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">w.document.documentElement</span><span class="PUNC">&&</span><span class="NAME">documentElement.clientWidth</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">W</span><span class="PUNC">=</span><span class="NAME">documentElement.clientWidth</span><span class="PUNC">;</span><span class="NAME">H</span><span class="PUNC">=</span><span class="NAME">documentElement.clientHeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">W</span><span class="PUNC">=</span><span class="NAME">body.offsetWidth</span><span class="PUNC">;</span><span class="NAME">H</span><span class="PUNC">=</span><span class="NAME">body.offsetHeight</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">T</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">L</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">W</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">H</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SortableObserver</span><span class="PUNC">=</span><span class="NAME">Class.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">SortableObserver.prototype</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.observer</span><span class="PUNC">=</span><span class="NAME">observer</span><span class="PUNC">;</span><span class="NAME">this.lastValue</span><span class="PUNC">=</span><span class="NAME">Sortable.serialize</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onStart</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lastValue</span><span class="PUNC">=</span><span class="NAME">Sortable.serialize</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Sortable.unmark</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastValue</span><span class="PUNC">!=</span><span class="NAME">Sortable.serialize</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="NAME">this.observer</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Sortable</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">SERIALIZE_RULE</span><span class="PUNC">:</span><span class="REGX">/^[^_\-](?:[A-Za-z0-9\-\_]*?)[_](.*)$/</span><span class="PUNC">,</span><span class="NAME">sortables</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_findRootElement</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">element.tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"BODY"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.id</span><span class="PUNC">&&</span><span class="NAME">Sortable.sortables</span><span class="PUNC">[</span><span class="NAME">element.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">Sortable._findRootElement</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">element</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Sortable.sortables</span><span class="PUNC">[</span><span class="NAME">element.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Draggables.removeObserver</span><span class="PUNC">(</span><span class="NAME">s.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">s.droppables.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Droppables.remove</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">s.draggables.invoke</span><span class="PUNC">(</span><span class="STRN">'destroy'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">Sortable.sortables</span><span class="PUNC">[</span><span class="NAME">s.element.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">create</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">:</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">tag</span><span class="PUNC">:</span><span class="STRN">'li'</span><span class="PUNC">,</span><span class="NAME">dropOnEmpty</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">tree</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">treeTag</span><span class="PUNC">:</span><span class="STRN">'ul'</span><span class="PUNC">,</span><span class="NAME">overlap</span><span class="PUNC">:</span><span class="STRN">'vertical'</span><span class="PUNC">,</span><span class="NAME">constraint</span><span class="PUNC">:</span><span class="STRN">'vertical'</span><span class="PUNC">,</span><span class="NAME">containment</span><span class="PUNC">:</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">handle</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">only</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">delay</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">hoverclass</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">ghosting</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">scroll</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">scrollSensitivity</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NAME">scrollSpeed</span><span class="PUNC">:</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="NAME">format</span><span class="PUNC">:</span><span class="NAME">this.SERIALIZE_RULE</span><span class="PUNC">,</span><span class="NAME">onChange</span><span class="PUNC">:</span><span class="NAME">Prototype.emptyFunction</span><span class="PUNC">,</span><span class="NAME">onUpdate</span><span class="PUNC">:</span><span class="NAME">Prototype.emptyFunction</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.destroy</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options_for_draggable</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">revert</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">scroll</span><span class="PUNC">:</span><span class="NAME">options.scroll</span><span class="PUNC">,</span><span class="NAME">scrollSpeed</span><span class="PUNC">:</span><span class="NAME">options.scrollSpeed</span><span class="PUNC">,</span><span class="NAME">scrollSensitivity</span><span class="PUNC">:</span><span class="NAME">options.scrollSensitivity</span><span class="PUNC">,</span><span class="NAME">delay</span><span class="PUNC">:</span><span class="NAME">options.delay</span><span class="PUNC">,</span><span class="NAME">ghosting</span><span class="PUNC">:</span><span class="NAME">options.ghosting</span><span class="PUNC">,</span><span class="NAME">constraint</span><span class="PUNC">:</span><span class="NAME">options.constraint</span><span class="PUNC">,</span><span class="NAME">handle</span><span class="PUNC">:</span><span class="NAME">options.handle</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.starteffect</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="NAME">options_for_draggable.starteffect</span><span class="PUNC">=</span><span class="NAME">options.starteffect</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.reverteffect</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="NAME">options_for_draggable.reverteffect</span><span class="PUNC">=</span><span class="NAME">options.reverteffect</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.ghosting</span><span class="PUNC">)</span><span class="NAME">options_for_draggable.reverteffect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.top</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">element.style.left</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.endeffect</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="NAME">options_for_draggable.endeffect</span><span class="PUNC">=</span><span class="NAME">options.endeffect</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.zindex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="NAME">options_for_draggable.zindex</span><span class="PUNC">=</span><span class="NAME">options.zindex</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options_for_droppable</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">overlap</span><span class="PUNC">:</span><span class="NAME">options.overlap</span><span class="PUNC">,</span><span class="NAME">containment</span><span class="PUNC">:</span><span class="NAME">options.containment</span><span class="PUNC">,</span><span class="NAME">tree</span><span class="PUNC">:</span><span class="NAME">options.tree</span><span class="PUNC">,</span><span class="NAME">hoverclass</span><span class="PUNC">:</span><span class="NAME">options.hoverclass</span><span class="PUNC">,</span><span class="NAME">onHover</span><span class="PUNC">:</span><span class="NAME">Sortable.onHover</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options_for_tree</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">onHover</span><span class="PUNC">:</span><span class="NAME">Sortable.onEmptyHover</span><span class="PUNC">,</span><span class="NAME">overlap</span><span class="PUNC">:</span><span class="NAME">options.overlap</span><span class="PUNC">,</span><span class="NAME">containment</span><span class="PUNC">:</span><span class="NAME">options.containment</span><span class="PUNC">,</span><span class="NAME">hoverclass</span><span class="PUNC">:</span><span class="NAME">options.hoverclass</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="NAME">Element.cleanWhitespace</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">options.draggables</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">options.droppables</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.dropOnEmpty</span><span class="PUNC">||</span><span class="NAME">options.tree</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Droppables.add</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options_for_tree</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">options.droppables.push</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="PUNC">(</span><span class="NAME">this.findElements</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handle</span><span class="PUNC">=</span><span class="NAME">options.handle</span><span class="PUNC">?</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">down</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">+</span><span class="NAME">options.handle</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">options.draggables.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Draggable</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">options_for_draggable</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">handle</span><span class="PUNC">:</span><span class="NAME">handle</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Droppables.add</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">options_for_droppable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.tree</span><span class="PUNC">)</span><span class="NAME">e.treeNode</span><span class="PUNC">=</span><span class="NAME">element</span><span class="PUNC">;</span><span class="NAME">options.droppables.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.tree</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">(</span><span class="NAME">Sortable.findTreeElements</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Droppables.add</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">options_for_tree</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e.treeNode</span><span class="PUNC">=</span><span class="NAME">element</span><span class="PUNC">;</span><span class="NAME">options.droppables.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="NAME">this.sortables</span><span class="PUNC">[</span><span class="NAME">element.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">;</span><span class="NAME">Draggables.addObserver</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SortableObserver</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options.onUpdate</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">findElements</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Element.findChildren</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options.only</span><span class="PUNC">,</span><span class="NAME">options.tree</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">options.tag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">findTreeElements</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Element.findChildren</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options.only</span><span class="PUNC">,</span><span class="NAME">options.tree</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">options.treeTag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onHover</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">overlap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Element.isParent</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">overlap</span><span class="PUNC">></span><span class="PUNC">.</span><span class="NUMB">33</span><span class="PUNC">&&</span><span class="NAME">overlap</span><span class="PUNC">&lt;</span><span class="PUNC">.</span><span class="NUMB">66</span><span class="PUNC">&&</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tree</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">overlap</span><span class="PUNC">></span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Sortable.mark</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="STRN">'before'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dropon.previousSibling</span><span class="PUNC">!=</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldParentNode</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="NAME">element.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="NAME">dropon.parentNode.insertBefore</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">dropon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dropon.parentNode</span><span class="PUNC">!=</span><span class="NAME">oldParentNode</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">oldParentNode</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">dropon.parentNode</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">Sortable.mark</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="STRN">'after'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextElement</span><span class="PUNC">=</span><span class="NAME">dropon.nextSibling</span><span class="PUNC">||</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextElement</span><span class="PUNC">!=</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldParentNode</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="NAME">element.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="NAME">dropon.parentNode.insertBefore</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">nextElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dropon.parentNode</span><span class="PUNC">!=</span><span class="NAME">oldParentNode</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">oldParentNode</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">dropon.parentNode</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onEmptyHover</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">overlap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldParentNode</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">droponOptions</span><span class="PUNC">=</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Element.isParent</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">=</span><span class="NAME">Sortable.findElements</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tag</span><span class="PUNC">:</span><span class="NAME">droponOptions.tag</span><span class="PUNC">,</span><span class="NAME">only</span><span class="PUNC">:</span><span class="NAME">droponOptions.only</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NAME">Element.offsetSize</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">droponOptions.overlap</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1.0</span><span class="PUNC">-</span><span class="NAME">overlap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">&lt;</span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">offset</span><span class="PUNC">-</span><span class="NAME">Element.offsetSize</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">droponOptions.overlap</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">offset</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">Element.offsetSize</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">droponOptions.overlap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">offset</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">Element.offsetSize</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">droponOptions.overlap</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">&lt;</span><span class="NAME">children.length</span><span class="PUNC">?</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="NAME">dropon.insertBefore</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">oldParentNode</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">droponOptions.onChange</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unmark</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sortable._marker</span><span class="PUNC">)</span><span class="NAME">Sortable._marker.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mark</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortable</span><span class="PUNC">=</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">dropon.parentNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sortable</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">sortable.ghosting</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Sortable._marker</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Sortable._marker</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'dropmarker'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">Element.extend</span><span class="PUNC">(</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'DIV'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClassName</span><span class="PUNC">(</span><span class="STRN">'dropmarker'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setStyle</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">position</span><span class="PUNC">:</span><span class="STRN">'absolute'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"body"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">item</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">Sortable._marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">=</span><span class="NAME">Position.cumulativeOffset</span><span class="PUNC">(</span><span class="NAME">dropon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Sortable._marker.setStyle</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">==</span><span class="STRN">'after'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sortable.overlap</span><span class="PUNC">==</span><span class="STRN">'horizontal'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">Sortable._marker.setStyle</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">dropon.clientWidth</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="NAME">Sortable._marker.setStyle</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">dropon.clientHeight</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Sortable._marker.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_tree</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">=</span><span class="NAME">Sortable.findElements</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">=</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id.match</span><span class="PUNC">(</span><span class="NAME">options.format</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">match</span><span class="PUNC">)</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">?</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">:</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="NAME">children</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="NAME">parent.children.length</span><span class="PUNC">,</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">down</span><span class="PUNC">(</span><span class="NAME">options.treeTag</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">child.container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="NAME">this._tree</span><span class="PUNC">(</span><span class="NAME">child.container</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">child</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="NAME">parent.children.push</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">tree</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortableOptions</span><span class="PUNC">=</span><span class="NAME">this.options</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">tag</span><span class="PUNC">:</span><span class="NAME">sortableOptions.tag</span><span class="PUNC">,</span><span class="NAME">treeTag</span><span class="PUNC">:</span><span class="NAME">sortableOptions.treeTag</span><span class="PUNC">,</span><span class="NAME">only</span><span class="PUNC">:</span><span class="NAME">sortableOptions.only</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">:</span><span class="NAME">element.id</span><span class="PUNC">,</span><span class="NAME">format</span><span class="PUNC">:</span><span class="NAME">sortableOptions.format</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">children</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Sortable._tree</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_constructIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.id</span><span class="PUNC">)</span><span class="NAME">index</span><span class="PUNC">=</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="NAME">node.position</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">+</span><span class="NAME">index</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">node.parent</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">sequence</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">this.findElements</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item.id.match</span><span class="PUNC">(</span><span class="NAME">options.format</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">item.id.match</span><span class="PUNC">(</span><span class="NAME">options.format</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSequence</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">new_sequence</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeMap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.findElements</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n.id.match</span><span class="PUNC">(</span><span class="NAME">options.format</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="NAME">nodeMap</span><span class="PUNC">[</span><span class="NAME">n.id.match</span><span class="PUNC">(</span><span class="NAME">options.format</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">n.parentNode</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">n.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">new_sequence.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ident</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">nodeMap</span><span class="PUNC">[</span><span class="NAME">ident</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">nodeMap</span><span class="PUNC">[</span><span class="NAME">ident</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">serialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">Object.extend</span><span class="PUNC">(</span><span class="NAME">Sortable.options</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">=</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">:</span><span class="NAME">element.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.tree</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Sortable.tree</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">children.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">+</span><span class="NAME">Sortable._constructIndex</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"[id]="</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">item.id</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">item.children.map</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">flatten</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'&'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Sortable.sequence</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"[]="</span><span class="PUNC">+</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">'&'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="NAME">Element.isParent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">child.parentNode</span><span class="PUNC">||</span><span class="NAME">child</span><span class="PUNC">==</span><span class="NAME">element</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">child.parentNode</span><span class="PUNC">==</span><span class="NAME">element</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Element.isParent</span><span class="PUNC">(</span><span class="NAME">child.parentNode</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="NAME">Element.findChildren</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">only</span><span class="PUNC">,</span><span class="NAME">recursive</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">element.hasChildNodes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">tagName</span><span class="PUNC">=</span><span class="NAME">tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">only</span><span class="PUNC">)</span><span class="NAME">only</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">only</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flatten</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">$A</span><span class="PUNC">(</span><span class="NAME">element.childNodes</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e.tagName</span><span class="PUNC">&&</span><span class="NAME">e.tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">tagName</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">only</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">Element.classNames</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">detect</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">only.include</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="NAME">elements.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">recursive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">grandchildren</span><span class="PUNC">=</span><span class="NAME">Element.findChildren</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">only</span><span class="PUNC">,</span><span class="NAME">recursive</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">grandchildren</span><span class="PUNC">)</span><span class="NAME">elements.push</span><span class="PUNC">(</span><span class="NAME">grandchildren</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">elements.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">elements.flatten</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="NAME">Element.offsetSize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">[</span><span class="STRN">'offset'</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'vertical'</span><span class="PUNC">||</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'height'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">'Height'</span><span class="PUNC">:</span><span class="STRN">'Width'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span></pre></body></html>